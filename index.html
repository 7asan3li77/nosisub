<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #f8fafc;
            --text: #1e293b;
            --card: #ffffff;
            --border: #e2e8f0;
            --blue: #2563eb;
            --purple: #7c3aed;
            --danger: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --info: #3b82f6;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --finalGreen: #dcfce7;
            --curr-color: #1e40af;
        }



        html,
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', 'Segoe UI', Tahoma, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100%;
            transition: all 0.3s;
        }

        button {
            touch-action: manipulation;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .page-title {
            padding: 25px 20px;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            position: relative;
            z-index: 500;
            overflow: hidden;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            min-height: 90px;
        }
        
        .page-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }
        
        @keyframes shine {
            0% { left: -100%; }
            50%, 100% { left: 100%; }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor; }
            50% { box-shadow: 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor; }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .page-title .main-title {
            padding: 16px 40px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            color: white;
            font-size: 22px;
            font-weight: 800;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5), 0 0 30px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255,255,255,0.3);
            border: 2px solid rgba(147, 197, 253, 0.5);
            position: relative;
            overflow: hidden;
            animation: glow 2s ease-in-out infinite, pulse 2s ease-in-out infinite;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
            margin-left: auto;
            margin-right: 70px;
        }
        
        .page-title .main-title::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(45deg);
            animation: titleShine 3s linear infinite;
        }
        
        @keyframes titleShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .page-title .info-group {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .page-title .designer-info,
        .page-title .department-info {
            padding: 14px 30px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            font-size: 17px;
            font-weight: 700;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.4), 0 0 25px rgba(16, 185, 129, 0.2), inset 0 1px 0 rgba(255,255,255,0.25);
            border: 2px solid rgba(110, 231, 183, 0.4);
            position: relative;
            overflow: hidden;
            animation: glow 2.5s ease-in-out infinite;
            text-shadow: 0 1px 8px rgba(0,0,0,0.3);
            letter-spacing: 0.3px;
        }
        
        .page-title .designer-info::before,
        .page-title .department-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.15), transparent);
            transform: rotate(45deg);
            animation: infoShine 4s linear infinite;
        }
        
        @keyframes infoShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .menu-toggle {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: 2px solid rgba(251, 191, 36, 0.5);
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            padding: 14px 18px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.4), 0 0 20px rgba(245, 158, 11, 0.2);
            z-index: 501;
        }

        .menu-toggle:hover {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            transform: translateY(-50%) scale(1.08);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.6), 0 0 30px rgba(245, 158, 11, 0.3);
        }

        .menu-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }

        .dropdown-menu {
            position: absolute;
            top: 90px;
            right: 10px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.2);
            width: 260px;
            max-width: calc(100vw - 20px);
            display: none;
            flex-direction: column;
            z-index: 1000;
            overflow: hidden;
            max-height: calc(100vh - 110px);
            overflow-y: auto;
        }

        .dropdown-menu.show {
            display: flex;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-menu button {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            border: none;
            padding: 14px 18px;
            text-align: right;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            margin: 4px 6px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3);
            position: relative;
            overflow: hidden;
        }

        .dropdown-menu button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .dropdown-menu button:hover::before {
            left: 100%;
        }

        .dropdown-menu button:hover {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .dropdown-menu button:active {
            transform: translateY(0);
        }

        .dropdown-menu button i {
            width: 24px;
            height: 24px;
            text-align: center;
            color: #fbbf24;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.15);
            border-radius: 6px;
            padding: 4px;
        }

        .dropdown-menu button.dragging {
            opacity: 0.5;
            background: #e2e8f0;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .summary-wrapper {
            padding: 10px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            z-index: 490;
            box-shadow: var(--shadow);
        }

        .summary-row {
            display: contents;
        }

        .summary-box {
            background: #fefce8;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-size: 12px;
            font-weight: bold;
            color: #7c2d12;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            min-height: 40px;
        }

        .summary-box .label {
            flex: 0 0 auto;
            white-space: nowrap;
            font-size: 12px;
        }

        .summary-box span {
            font-weight: 900;
            font-size: 15px;
            color: var(--text);
            text-align: left;
            flex: 0 0 auto;
        }

        .summary-box.curr {
            background: #e0f2fe;
            color: var(--curr-color);
        }

        .period-info-banner {
            padding: 8px 12px;
            margin-bottom: 8px;
            text-align: right;
            font-size: 16px;
            font-weight: 900;
            color: #15803d;
            background: transparent;
            direction: rtl;
        }

        .period-info-banner .dates {
            color: #166534;
            font-weight: 900;
            font-size: 17px;
        }

        .final-box {
            background: var(--finalGreen);
            border: 2px solid #86efac;
            border-radius: 8px;
            font-weight: 900;
            font-size: 13px;
            color: #b91c1c;
            padding: 8px 12px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            min-height: 40px;
            grid-column: 1 / -1;
        }

        .final-box .item {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .final-box span {
            font-size: 16px;
            color: var(--text);
            font-weight: 900;
        }

        @media (max-width: 768px) {
            .summary-wrapper {
                grid-template-columns: 1fr;
            }
            
            .summary-box {
                flex-direction: row;
                align-items: center;
                text-align: right;
                gap: 8px;
                padding: 8px 10px;
                justify-content: space-between;
            }

            .summary-box .label {
                font-size: 11px;
                white-space: nowrap;
            }

            .summary-box span {
                font-size: 13px;
                font-weight: 900;
            }

            .final-box {
                flex-direction: row;
                gap: 6px;
                flex-wrap: wrap;
                justify-content: center;
                padding: 10px;
            }

            .final-box .item {
                justify-content: center;
                font-size: 12px;
            }
            
            .final-box span {
                font-size: 14px;
            }
        }

        .filter-wrapper {
            padding: 10px;
            background: var(--card);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            position: sticky;
            top: 66px;
            z-index: 490;
            box-shadow: var(--shadow);
        }

        .filter-wrapper select,
        .filter-wrapper input,
        .filter-wrapper button {
            flex: 1;
            min-width: 100px;
            padding: 8px;
            border-radius: 6px;
            font-weight: bold;
            border: 1px solid var(--border);
        }

        .filter-wrapper button {
            background: var(--info);
            color: #fff;
            border: 0;
        }

        .filter-wrapper button.danger {
            background: var(--danger);
        }
        
        #showDistributionBtn:hover {
            background: linear-gradient(135deg, #047857, #059669) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.5) !important;
        }
        
        #showDistributionBtn:active {
            transform: translateY(0) !important;
        }
        
        #exportDistributionPDF:hover {
            background: linear-gradient(135deg, #b91c1c, #dc2626) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(220, 38, 38, 0.5) !important;
        }
        
        #closeDistribution:hover {
            background: linear-gradient(135deg, #4b5563, #6b7280) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 114, 128, 0.5) !important;
        }

        #filterDate2 {
            display: none;
        }

        .table-wrapper {
            flex: 1;
            padding: 12px;
            overflow: auto;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: visible;
            box-shadow: var(--shadow);
            table-layout: fixed;
        }

        thead th {
            background: #e0e7ff;
            color: #1e40af;
            position: sticky;
            top: 0;
            padding: 10px;
            border: 1px solid var(--border);
            font-size: 14px;
            font-weight: bold;
            z-index: 900;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }



        td,
        th {
            padding: 8px;
            border: 1px solid var(--border);
            text-align: center;
            vertical-align: middle;
            word-break: break-word;
            font-weight: bold;
        }

        input,
        select {
            width: 100%;
            box-sizing: border-box;
            padding: 6px;
            text-align: center;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            font-weight: bold;
            font-size: 14px;
            background: #fff;
            transition: 0.2s;
        }



        input:focus,
        select:focus {
            border-color: var(--blue);
            outline: none;
            box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.2);
        }

        input[readonly] {
            background: #f1f5f9;
            color: #64748b;
        }


        
        /* ØªØ­Ø³ÙŠÙ† ÙˆØ¶ÙˆØ­ Ø§Ù„Ø®Ø· ÙÙŠ PDF */
        #distributionTableBody td {
            color: #000000 !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
        }
        
        #distributionTableBody tr:nth-last-child(2) td {
            color: #78350f !important;
        }
        
        #distributionTableBody tr:last-child td {
            color: #ffffff !important;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card);
            padding: 24px;
            border-radius: 12px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.25);
            animation: modalIn .3s;
        }

        @keyframes modalIn {
            from {
                transform: scale(0.8);
                opacity: 0
            }

            to {
                transform: scale(1);
                opacity: 1
            }
        }

        .modal-content h3 {
            margin: 0 0 16px;
            color: var(--blue);
            font-size: 18px;
            text-align: center;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ */
        button[id^="close"]:hover,
        button[id^="unlock"]:hover,
        button[id^="lock"]:hover,
        button[id^="enable"]:hover,
        button[id^="disable"]:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }
        
        button[id^="close"]:active,
        button[id^="unlock"]:active,
        button[id^="lock"]:active,
        button[id^="enable"]:active,
        button[id^="disable"]:active {
            transform: scale(0.95);
        }



        .bulk-rate-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            padding: 10px 12px;
            margin-bottom: 10px;
            background: white;
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .bulk-rate-row:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        .bulk-rate-row input {
            padding: 8px 10px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
        }

        .bulk-rate-row input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .bulk-rate-row .remove-row {
            background: #ef4444;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bulk-rate-row .remove-row:hover {
            background: #dc2626;
            transform: scale(1.1) rotate(90deg);
        }

        #addBulkRateRow:hover,
        #addBulkRow:hover {
            background: linear-gradient(135deg, #2563eb, #3b82f6) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4) !important;
        }

        #addBulkRateRow:active,
        #addBulkRow:active {
            transform: translateY(0) !important;
        }

        #add10BulkRows:hover {
            background: linear-gradient(135deg, #6d28d9, #7c3aed) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4) !important;
        }

        #add10BulkRows:active {
            transform: translateY(0) !important;
        }

        @media (max-width: 768px) {
            .bulk-rate-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .bulk-rate-row .remove-row {
                width: 100%;
                border-radius: 6px;
                height: 40px;
            }
        }

        .bulk-table-wrapper {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .bulk-row {
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .bulk-row-checkboxes {
            display: none;
        }





        .rates-detail-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }

        .rates-detail-content {
            background: var(--card);
            padding: 24px;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalIn .3s;
            position: relative;
        }

        .rates-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .rates-detail-header h3 {
            margin: 0;
            color: var(--blue);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rates-detail-close {
            background: var(--danger);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .rates-detail-close:hover {
            background: #dc2626;
            transform: rotate(90deg);
        }

        .rates-info-box {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-right: 4px solid #3b82f6;
        }

        .rates-info-box p {
            margin: 5px 0;
            font-size: 14px;
            color: #1e40af;
        }

        .rates-info-box strong {
            color: #1e3a8a;
        }

        .rates-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .rates-table th {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
        }

        .rates-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid var(--border);
            font-size: 13px;
        }

        .rates-table tbody tr:nth-child(even) {
            background: #f8fafc;
        }

        .rates-table tbody tr:hover {
            background: #e0f2fe;
        }

        .rates-table .type-name {
            text-align: right;
            font-weight: bold;
            color: #1e40af;
        }

        .rates-table .total-row {
            background: #dcfce7;
            font-weight: bold;
            color: #166534;
        }

        .rate-value {
            font-weight: bold;
            color: #0369a1;
        }

        .rate-selected {
            background: #fef3c7 !important;
            border: 2px solid #f59e0b;
        }

        .modal-ins-type {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #22c55e;
        }

        .apply-rates-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4) !important;
        }

        .apply-rates-btn:active {
            transform: translateY(0);
        }

        .discounts-section {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: 12px;
            border: 2px solid #f59e0b;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
        }

        .discounts-title {
            font-size: 18px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .discounts-title i {
            color: #f59e0b;
            font-size: 22px;
        }

        .discounts-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .discounts-table thead {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .discounts-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .discounts-table td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-size: 14px;
        }

        .discounts-table tbody tr:hover {
            background: #fffbeb;
        }

        .discount-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #f59e0b;
        }

        .discount-name {
            text-align: right;
            color: #1f2937;
            font-weight: 500;
        }

        .discount-rate {
            font-weight: bold;
            color: #dc2626;
            font-size: 15px;
        }

        .no-discounts-msg {
            text-align: center;
            padding: 20px;
            color: #6b7280;
            font-style: italic;
            background: white;
            border-radius: 8px;
            border: 1px dashed #d1d5db;
        }

        .conflict-warning {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border: 3px solid #dc2626;
            border-radius: 16px;
            padding: 0;
            box-shadow: 0 10px 40px rgba(220, 38, 38, 0.4);
            z-index: 10001;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            25% { transform: translate(-50%, -50%) rotate(-2deg); }
            75% { transform: translate(-50%, -50%) rotate(2deg); }
        }

        .conflict-warning-icon {
            text-align: center;
            font-size: 60px;
            color: #dc2626;
            margin-bottom: 15px;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .conflict-warning-title {
            font-size: 22px;
            font-weight: bold;
            color: #7f1d1d;
            text-align: center;
            margin-bottom: 15px;
        }

        .conflict-warning-message {
            font-size: 16px;
            color: #991b1b;
            text-align: center;
            line-height: 1.8;
            margin-bottom: 20px;
            max-height: 50vh;
            overflow-y: auto;
            padding: 0 10px;
        }

        .conflict-warning-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            border: none;
            border-radius: 0 0 13px 13px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.3s;
        }

        .conflict-warning-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 38, 38, 0.3);
        }

        .conflict-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        @media (min-width: 769px) {
            .bulk-row-inputs {
                grid-template-columns: 1.3fr 1.3fr 1.1fr 0.9fr 1fr 1fr auto auto;
                gap: 10px;
            }
        }

        .bulk-row input,
        .bulk-row select {
            padding: 8px;
            font-size: 13px;
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .bulk-row .remove-row {
            background: var(--danger);
            color: #fff;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }

        #addBulkRow {
            margin: 12px 0;
            padding: 10px;
            background: var(--info);
            color: #fff;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            font-weight: bold;
            border-radius: 8px;
            border: 0;
            color: #fff;
        }

        .modal-buttons button#bulkFill {
            background: #22c55e !important;
        }

        .ins-rates-display {
            background: #f0f9ff;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 2px solid #bae6fd;
        }

        .ins-rates-display h4 {
            margin: 0 0 10px 0;
            color: #0369a1;
            font-size: 15px;
        }

        .rate-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
        }

        .rate-item {
            background: white;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e0e7ff;
            font-size: 12px;
        }

        .rate-item strong {
            color: #1e40af;
            display: block;
            margin-bottom: 3px;
        }

        .rate-item .rate-detail {
            color: #64748b;
            font-size: 11px;
        }

        .bulk-options label {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 5px 10px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: white;
            border: 2px solid #e2e8f0;
        }

        .bulk-options label:hover {
            background: #f0f9ff;
            border-color: #bae6fd;
        }

        .bulk-options label input[type="checkbox"] {
            width: auto;
            cursor: pointer;
            transform: scale(1.2);
        }

        .bulk-options label input[type="checkbox"]:checked + span,
        .bulk-options label:has(input[type="checkbox"]:checked) {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
            font-weight: bold;
        }

        #toast {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #1e293b;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            opacity: 0;
            transition: opacity .3s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        @media print {
            body * {
                visibility: hidden;
            }

            .page-title,
            .page-title *,
            .summary-wrapper,
            .summary-wrapper *,
            .table-wrapper,
            .table-wrapper *,
            .print-content * {
                visibility: visible;
            }

            .page-title,
            .summary-wrapper,
            .table-wrapper {
                position: relative;
                top: 0;
            }

            .page-title {
                font-size: 24px !important;
                padding: 10px !important;
                margin-bottom: 10px !important;
            }

            table,
            th,
            td {
                border: 1px solid #000 !important;
            }

            thead {
                display: table-header-group;
            }

            .menu-toggle,
            .dropdown-menu,
            .modal,
            #toast {
                display: none !important;
            }

            .print-content {
                page-break-inside: avoid;
            }
        }

        @media (max-width: 768px) {
            .page-title {
                padding: 20px 15px 20px 75px;
                flex-direction: column;
                gap: 15px;
                min-height: 120px;
            }
            
            .page-title .main-title {
                font-size: 19px;
                padding: 14px 28px;
                margin-right: 0;
                margin-left: 0;
                text-align: center;
                width: 100%;
            }
            
            .page-title .info-group {
                width: 100%;
                justify-content: center;
                gap: 10px;
            }
            
            .page-title .designer-info,
            .page-title .department-info {
                font-size: 15px;
                padding: 11px 20px;
                flex: 1;
                text-align: center;
                min-width: 0;
            }
            
            .menu-toggle {
                left: 15px;
                font-size: 22px;
                padding: 12px 16px;
                border-radius: 50%;
                width: 50px;
                height: 50px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .summary-wrapper {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                padding: 9px;
            }
            
            .summary-box {
                font-size: 11px;
                padding: 7px 11px;
            }
        }

        @media (max-width:480px) {
            .page-title {
                padding: 18px 12px 18px 70px;
                min-height: 140px;
            }

            .page-title .main-title {
                font-size: 17px;
                padding: 12px 22px;
            }
            
            .page-title .info-group {
                flex-direction: column;
                width: 100%;
                gap: 10px;
                align-items: center;
            }
            
            .page-title .designer-info,
            .page-title .department-info {
                font-size: 14px;
                padding: 10px 18px;
                width: 100%;
                text-align: center;
            }
            
            .menu-toggle {
                /* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø²Ø± Ù„Ø²Ø± Ø¹Ø§Ø¦Ù… (FAB) Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ ÙÙ‚Ø· */
                position: fixed;
                top: 20px;
                right: 20px;
                bottom: auto;
                left: auto;
                transform: none;
                font-size: 22px;
                padding: 0;
                border-radius: 50%;
                width: 56px;
                height: 56px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 4px 20px rgba(245, 158, 11, 0.5), 0 8px 40px rgba(245, 158, 11, 0.3);
                z-index: 1000;
            }
            
            .menu-toggle:hover {
                transform: scale(1.1);
                box-shadow: 0 6px 25px rgba(245, 158, 11, 0.6), 0 10px 50px rgba(245, 158, 11, 0.4);
            }
            
            .menu-toggle:active {
                transform: scale(1.05);
            }
            
            /* ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ù„Ù„Ù‡ÙˆØ§ØªÙ */
            .dropdown-menu {
                top: 90px;
                right: 20px;
                left: auto;
                bottom: auto;
            }

            .page-title .designer-info {
                font-size: 15px;
            }

            .page-title .department-info {
                font-size: 15px;
            }

            .modal-content {
                width: 98%;
                padding: 16px;
            }

            .dropdown-menu {
                width: calc(100vw - 20px);
                right: 10px;
            }

            .dropdown-menu button {
                padding: 12px 14px;
                font-size: 13px;
                margin: 3px 4px;
            }

            .summary-wrapper {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
                padding: 8px;
            }
            
            .summary-box {
                font-size: 11px;
                padding: 6px 10px;
            }
            
            .summary-box .label {
                font-size: 10px;
            }

            .bulk-row-inputs {
                grid-template-columns: 1fr 1fr;
            }

            .bulk-row-inputs .remove-row {
                grid-column: 1/-1;
            }

            .bulk-row-checkboxes label {
                font-size: 11px;
                padding: 3px 6px;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .page-title .main-title {
                font-size: 20px;
                padding: 13px 26px;
            }
            
            .page-title .designer-info,
            .page-title .department-info {
                font-size: 16px;
                padding: 12px 22px;
            }

            .dropdown-menu {
                width: 280px;
            }

            .summary-wrapper {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .summary-box {
                font-size: 11px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="page-title">
            <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
            <div class="main-title">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</div>
            <div class="info-group">
                <div class="designer-info">ØªØµÙ…ÙŠÙ…: Ø­Ø³Ù† Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯</div>
                <div class="department-info">Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠØ©</div>
            </div>
        </h1>
        <div class="dropdown-menu" id="dropdownMenu">
            <button id="updateBtn" draggable="true"><i class="fas fa-sync-alt"></i><span>ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§Ø¦Ø¯Ø©</span></button>
            <button id="toggleLockBtn" draggable="true"><i class="fas fa-lock"></i><span>Ù‚ÙÙ„ Ø§Ù„ÙÙˆØ§Ø¦Ø¯</span></button>
            <button id="changePassBtn" draggable="true"><i class="fas fa-key"></i><span>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø©
                    Ø§Ù„Ù…Ø±ÙˆØ±</span></button>
            <button id="clearSubsBtn" draggable="true"><i class="fas fa-trash-alt"></i><span>ØªÙØ±ÙŠØº
                    Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span></button>
            <button id="exportPDFBtn" draggable="true"><i class="fas fa-file-pdf"></i><span>Ø­ÙØ¸ PDF</span></button>
            <button id="exportJSONBtn" draggable="true"><i class="fas fa-download"></i><span>ØªØµØ¯ÙŠØ± JSON</span></button>
            <button id="importJSONBtn" draggable="true"><i class="fas fa-upload"></i><span>Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</span></button>
            <button id="bulkInsertBtn" draggable="true"><i class="fas fa-fill-drip"></i><span>Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ø´ØªØ±Ø§Ùƒ
                    Ù„Ù…Ø¯Ø©</span></button>
            <button id="bulkRateInsertBtn" draggable="true" style="display:none;"><i class="fas fa-percent"></i><span>Ø¥Ø¯Ø±Ø§Ø¬ ÙØ§Ø¦Ø¯Ø© Ù„Ù…Ø¯Ø¯ Ù…ØªØ¹Ø¯Ø¯Ø©</span></button>
            <button id="transportWorkersBtn" draggable="true"><i class="fas fa-truck"></i><span>Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ</span></button>
            <button id="contractorsWorkersBtn" draggable="true"><i class="fas fa-hard-hat"></i><span>Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</span></button>
            <button id="treasuryYieldBtn" draggable="true"><i class="fas fa-chart-line"></i><span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø£Ø°ÙˆÙ† ÙˆØ³Ù†Ø¯Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†Ø©</span></button>
            <button id="irregularWorkersBtn" draggable="true"><i class="fas fa-users"></i><span>Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©</span></button>
            <button id="presumptiveSubsBtn" draggable="true"><i class="fas fa-calculator"></i><span>Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ©</span></button>
            <button id="wageLimitsBtn" draggable="true"><i class="fas fa-money-check-alt"></i><span>Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‚ 148 Ù„ 2019</span></button>
            <button id="undoBtn" draggable="true"><i class="fas fa-undo"></i><span>ØªØ±Ø§Ø¬Ø¹</span></button>
        </div>
        <main class="main-content">
            <div class="summary-wrapper">
                <div class="summary-row">
                    <div class="summary-box">
                        <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</span>
                        <span id="prevSubs">0.00</span>
                    </div>
                    <div class="summary-box">
                        <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©:</span>
                        <span id="prevInterest">0.00</span>
                    </div>
                </div>
                <div class="summary-row">
                    <div class="summary-box curr">
                        <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                        <span id="currSubs">0.00</span>
                    </div>
                    <div class="summary-box curr">
                        <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                        <span id="currInterest">0.00</span>
                    </div>
                </div>
                <div class="final-box">
                    <div class="item" style="color: #15803d; font-weight: 900;">ğŸ“Š Ø§Ù„ÙØªØ±Ø©: Ù…Ù† <span id="periodStartDate">-</span> Ø¥Ù„Ù‰ <span id="periodEndDate">-</span></div>
                    <div class="item">|</div>
                    <div class="item">Ø¬Ù…Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©: <span id="totalPayments">0.00</span></div>
                    <div class="item">|</div>
                    <div class="item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯: <span id="totalInterest">0.00</span></div>
                    <div class="item">|</div>
                    <div class="item">Ø§Ù„ØªØ³ÙˆÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="finalTotal">0.00</span></div>
                    <div class="item" id="creditBalanceItem" style="display: none; color: #16a34a; font-weight: bold;">|</div>
                    <div class="item" id="creditBalanceValue" style="display: none; color: #16a34a; font-weight: bold;">Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†: <span id="creditBalance">0.00</span></div>
                </div>
            </div>
            <div class="filter-wrapper">
                <select id="filterType">
                    <option value="year">ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª</option>
                    <option value="month">ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø´Ù‡ÙˆØ±</option>
                </select>
                <select id="filterCondition">
                    <option value="gte">Ø£ÙƒØ¨Ø± Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ</option>
                    <option value="lte">Ø£Ù‚Ù„ Ù…Ù† Ø£Ùˆ ÙŠØ³Ø§ÙˆÙŠ</option>
                    <option value="between">Ø¨ÙŠÙ† ØªØ§Ø±ÙŠØ®ÙŠÙ†</option>
                </select>
                <input type="number" id="filterDate1" placeholder="Ø§Ù„Ø³Ù†Ø© (Ù…Ø«Ø§Ù„: 2025)">
                <input type="number" id="filterDate2" placeholder="Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©">
                <button id="applyFilter">ÙÙ„ØªØ±Ø©</button>
                <button id="clearFilter" class="danger">Ø¥Ù„ØºØ§Ø¡</button>
                <button id="showDistributionBtn" style="background: linear-gradient(135deg, #059669, #10b981); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3); transition: all 0.3s ease;">
                    <i class="fas fa-chart-pie"></i> Ø¹Ø±Ø¶ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
                </button>
            </div>
            <div class="print-content" style="display:none;">
                <h2 style="text-align:center;margin:20px 0;color:var(--blue);font-size:24px;">Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
                    Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</h2>
                <div id="printSummary"
                    style="margin:15px 0;padding:10px;background:#f9fafb;border:1px solid #ddd;border-radius:8px;font-weight:bold;">
                </div>
                <table id="printTable" style="width:100%;border-collapse:collapse;margin-top:15px;">
                    <thead style="background:#e0e7ff;">
                        <tr>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</th>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</th>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ø¨Ø¹Ø¯ 15ØŸ</th>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ø§Ù„ÙØ§Ø¦Ø¯Ø© (%)</th>
                            <th style="padding:10px;border:1px solid #000;font-size:12px;">Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø¦Ø¯Ø©</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</th>
                            <th>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</th>
                            <th>Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø¨Ø¹Ø¯ 15ØŸ</th>
                            <th>Ø§Ù„ÙØ§Ø¦Ø¯Ø© (%)</th>
                            <th>Ù…Ø¨Ù„Øº Ø§Ù„ÙØ§Ø¦Ø¯Ø©</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </main>
    </div>
    <div class="modal" id="bulkModal">
        <div class="modal-content">
            <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ù…Ø¯Ø¯ Ù…ØªØ¹Ø¯Ø¯Ø©</h3>
            <div class="bulk-options" style="margin-bottom:15px;padding:10px;background:#f1f5f9;border-radius:8px;">
                <div style="font-weight:bold;margin-bottom:10px;color:var(--blue);font-size:15px;">
                    ï¿½ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ù…Ø¯Ø¯ Ù…ØªØ¹Ø¯Ø¯Ø©
                </div>
                <div style="padding:8px;background:#dbeafe;border-right:3px solid #2563eb;border-radius:4px;font-size:12px;color:#1e40af;">
                    ğŸ’¡ <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„ÙƒÙ„ Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø­Ø¯Ø©
                </div>
            </div>
            <div id="bulkRows"></div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin: 12px 0;">
                <button id="addBulkRow" style="padding: 10px 12px; background: linear-gradient(135deg, #1e3a8a, #1e40af); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; min-height: 42px;">
                    <i class="fas fa-plus-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø© Ø£Ø®Ø±Ù‰</span>
                </button>
                <button id="add10BulkRows" style="padding: 10px 12px; background: linear-gradient(135deg, #7c3aed, #8b5cf6); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; min-height: 42px;">
                    <i class="fas fa-layer-group" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ø¥Ø¶Ø§ÙØ© 10 Ù…Ø¯Ø¯</span>
                </button>
                <button id="bulkFill" style="padding: 10px 12px; background: #22c55e; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; min-height: 42px;">
                    <i class="fas fa-check-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ØªØ¹Ø¨Ø¦Ø©</span>
                </button>
                <button id="bulkCancel" style="padding: 10px 12px; background: var(--danger); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(248, 113, 113, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px; min-height: 42px;">
                    <i class="fas fa-times-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ø¥Ù„ØºØ§Ø¡</span>
                </button>
            </div>
        </div>
    </div>
    <div class="modal" id="bulkRateModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 15px; color: var(--blue); display: flex; align-items: center; justify-content: center; gap: 10px;">
                <i class="fas fa-percent"></i> Ø¥Ø¯Ø®Ø§Ù„ Ù†Ø³Ø¨ ÙØ§Ø¦Ø¯Ø© Ù„Ù…Ø¯Ø¯ Ù…ØªØ¹Ø¯Ø¯Ø©
            </h3>
            <div style="background: #f0f9ff; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-right: 4px solid #3b82f6;">
                <div style="font-size: 13px; color: #1e40af; line-height: 1.6;">
                    ğŸ’¡ <strong>Ø¥Ø±Ø´Ø§Ø¯Ø§Øª:</strong> Ø£Ø¯Ø®Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ù„ÙƒÙ„ Ù…Ø¯Ø©. ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¯Ø¯ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ Ù…Ù† Ø§Ù„Ù…Ø¯Ø¯.
                </div>
            </div>
            <div id="bulkRateRows" style="max-height: 400px; overflow-y: auto; margin-bottom: 15px;">
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; margin: 12px 0;">
                <button id="addBulkRateRow" style="padding: 12px 6px; background: linear-gradient(135deg, #1e3a8a, #1e40af); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(30, 58, 138, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <i class="fas fa-plus-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø© Ø£Ø®Ø±Ù‰</span>
                </button>
                <button id="bulkRateFill" style="padding: 12px 6px; background: #22c55e; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <i class="fas fa-check-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">ØªØ¹Ø¨Ø¦Ø©</span>
                </button>
                <button id="bulkRateCancel" style="padding: 12px 6px; background: var(--danger); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 2px 8px rgba(248, 113, 113, 0.3); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <i class="fas fa-times-circle" style="color: #fbbf24; font-size: 15px;"></i> <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ø¥Ù„ØºØ§Ø¡</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
    <div class="modal" id="distributionModal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 style="text-align: center; color: var(--blue); margin-bottom: 25px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-chart-pie" style="font-size: 28px;"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª
            </h3>
            <div style="overflow-x: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-radius: 12px;">
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px; border-radius: 12px; overflow: hidden;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white;">
                            <th style="padding: 16px; border: none; text-align: right; font-size: 15px; font-weight: bold; width: 40%;">Ø§Ù„Ø¨ÙŠØ§Ù†</th>
                            <th style="padding: 16px; border: none; text-align: center; font-size: 15px; font-weight: bold; width: 20%;">Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
                            <th style="padding: 16px; border: none; text-align: center; font-size: 15px; font-weight: bold; width: 20%;">Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                            <th style="padding: 16px; border: none; text-align: center; font-size: 15px; font-weight: bold; width: 20%;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody id="distributionTableBody">
                        <tr style="background: #f8fafc;">
                            <td style="padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a8a;">
                                <i class="fas fa-user-shield" style="color: #3b82f6; margin-left: 8px;"></i>ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø´ÙŠØ®ÙˆØ®Ø© ÙˆØ§Ù„Ø¹Ø¬Ø² ÙˆØ§Ù„ÙˆÙØ§Ø©
                            </td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-oldAge-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-oldAge-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 800; color: #1e3a8a;" id="dist-oldAge-total">0.00</td>
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a8a;">
                                <i class="fas fa-award" style="color: #f59e0b; margin-left: 8px;"></i>ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©
                            </td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-reward-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-reward-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 800; color: #1e3a8a;" id="dist-reward-total">0.00</td>
                        </tr>
                        <tr style="background: #f8fafc;">
                            <td style="padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a8a;">
                                <i class="fas fa-heartbeat" style="color: #ef4444; margin-left: 8px;"></i>ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶
                            </td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-sickness-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-sickness-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 800; color: #1e3a8a;" id="dist-sickness-total">0.00</td>
                        </tr>
                        <tr style="background: white;">
                            <td style="padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a8a;">
                                <i class="fas fa-hard-hat" style="color: #f97316; margin-left: 8px;"></i>ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„
                            </td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-injury-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-injury-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 800; color: #1e3a8a;" id="dist-injury-total">0.00</td>
                        </tr>
                        <tr style="background: #f8fafc;">
                            <td style="padding: 14px 16px; border-bottom: 1px solid #e2e8f0; font-weight: 700; color: #1e3a8a;">
                                <i class="fas fa-briefcase" style="color: #8b5cf6; margin-left: 8px;"></i>ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù„Ø©
                            </td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-unemployment-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 700; color: #1e293b;" id="dist-unemployment-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 1px solid #e2e8f0; text-align: center; font-size: 15px; font-weight: 800; color: #1e3a8a;" id="dist-unemployment-total">0.00</td>
                        </tr>
                        <tr style="background: linear-gradient(135deg, #fef3c7, #fde68a);">
                            <td style="padding: 14px 16px; border-bottom: 2px solid #f59e0b; font-weight: bold; color: #92400e; font-size: 15px;">
                                <i class="fas fa-percentage" style="color: #f59e0b; margin-left: 8px;"></i>Ø§Ù„ÙÙˆØ§Ø¦Ø¯
                            </td>
                            <td style="padding: 14px; border-bottom: 2px solid #f59e0b; text-align: center; font-size: 15px; font-weight: bold; color: #92400e;" id="dist-interest-prev">0.00</td>
                            <td style="padding: 14px; border-bottom: 2px solid #f59e0b; text-align: center; font-size: 15px; font-weight: bold; color: #92400e;" id="dist-interest-curr">0.00</td>
                            <td style="padding: 14px; border-bottom: 2px solid #f59e0b; text-align: center; font-size: 15px; font-weight: bold; color: #92400e;" id="dist-interest-total">0.00</td>
                        </tr>
                        <tr style="background: linear-gradient(135deg, #064e3b, #047857); color: white; font-weight: bold; font-size: 17px;">
                            <td style="padding: 16px; border: none;">
                                <i class="fas fa-calculator" style="margin-left: 8px;"></i>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                            </td>
                            <td style="padding: 16px; border: none; text-align: center;" id="dist-grand-prev">0.00</td>
                            <td style="padding: 16px; border: none; text-align: center;" id="dist-grand-curr">0.00</td>
                            <td style="padding: 16px; border: none; text-align: center;" id="dist-grand-total">0.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button id="exportDistributionPDF" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-file-pdf" style="font-size: 18px;"></i> <span>ØªØµØ¯ÙŠØ± PDF</span>
                </button>
                <button id="closeDistribution" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #6b7280, #9ca3af); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4); transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-times" style="font-size: 18px;"></i> <span>Ø¥ØºÙ„Ø§Ù‚</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ -->
    <div class="modal" id="transportWorkersModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <button id="closeTransportModal" style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <h3 style="text-align: center; color: var(--blue); margin-bottom: 20px; margin-top: 10px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-truck" style="font-size: 28px;"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ
            </h3>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div style="position: absolute; top: 15px; right: 15px; z-index: 1000;">
                <button id="unlockTransportTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #34d399); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5); display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-unlock"></i> ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button id="lockTransportTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444, #f87171); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5); display: none; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-lock"></i> Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>

            <div style="max-height: 500px; overflow-y: auto; overflow-x: auto; box-shadow: 0 6px 20px rgba(236, 72, 153, 0.2); border-radius: 12px; position: relative; border: 2px solid #f9a8d4;">
                <table id="transportWorkersTable" style="width: 100%; border-collapse: separate; border-spacing: 0;">
                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #f9a8d4, #fbcfe8);">
                        <tr style="background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843;">
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†ÙŠ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 120px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„ØªØ¨Ø§Ø¹ - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 120px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„ØªØ¨Ø§Ø¹ - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø© - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #f9a8d4; text-align: center; font-size: 15px; font-weight: 700; min-width: 100px; display: none; background: linear-gradient(135deg, #f9a8d4, #fbcfe8); color: #831843; text-shadow: 0 1px 2px rgba(255,255,255,0.5);" class="actions-column">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="transportWorkersTableBody">
                    </tbody>
                </table>
            </div>

            <button id="addTransportRowBtn" style="margin-top: 15px; padding: 12px 24px; background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); display: none; align-items: center; gap: 8px; margin-left: auto; margin-right: auto;">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª -->
    <div class="modal" id="contractorsWorkersModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <button id="closeContractorsModal" style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <h3 style="text-align: center; color: var(--blue); margin-bottom: 20px; margin-top: 10px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-hard-hat" style="font-size: 28px;"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª
            </h3>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div style="position: absolute; top: 15px; right: 15px; z-index: 1000;">
                <button id="unlockContractorsTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #34d399); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5); display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-unlock"></i> ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button id="lockContractorsTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444, #f87171); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5); display: none; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-lock"></i> Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>

            <div style="max-height: 500px; overflow-y: auto; overflow-x: auto; box-shadow: 0 6px 20px rgba(168, 85, 247, 0.2); border-radius: 12px; position: relative; border: 2px solid #ddd6fe;">
                <table id="contractorsWorkersTable" style="width: 100%; border-collapse: separate; border-spacing: 0;">
                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #ddd6fe, #e9d5ff);">
                        <tr style="background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6;">
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 140px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†ÙŠ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 160px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 160px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 160px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ù‡Ø§Ø±Ø© - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 160px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ù‡Ø§Ø±Ø© - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…Ø§Ù‡Ø± - Ø£Ø¬Ø±</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 130px; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¹Ø§Ù…Ù„ Ù…Ø§Ù‡Ø± - Ù‚ÙŠÙ…Ø©</th>
                            <th style="padding: 16px; border: 1px solid #ddd6fe; text-align: center; font-size: 15px; font-weight: 700; min-width: 100px; display: none; background: linear-gradient(135deg, #ddd6fe, #e9d5ff); color: #5b21b6; text-shadow: 0 1px 2px rgba(255,255,255,0.5);" class="contractors-actions-column">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="contractorsWorkersTableBody">
                    </tbody>
                </table>
            </div>

            <button id="addContractorsRowBtn" style="margin-top: 15px; padding: 12px 24px; background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); display: none; align-items: center; gap: 8px; margin-left: auto; margin-right: auto;">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø£Ø°ÙˆÙ† ÙˆØ³Ù†Ø¯Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†Ø© -->
    <div class="modal" id="treasuryYieldModal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <button id="closeTreasuryYieldModal" style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <h3 style="text-align: center; color: var(--blue); margin-bottom: 20px; margin-top: 10px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-chart-line" style="font-size: 28px;"></i> Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø£Ø°ÙˆÙ† ÙˆØ³Ù†Ø¯Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†Ø©
            </h3>

            <div style="max-height: 550px; overflow-y: auto; overflow-x: auto; box-shadow: 0 6px 20px rgba(34, 197, 94, 0.2); border-radius: 12px; position: relative; border: 2px solid #86efac;">
                <table id="treasuryYieldTable" style="width: 100%; border-collapse: separate; border-spacing: 0;">
                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #86efac, #bbf7d0);">
                        <tr style="background: linear-gradient(135deg, #86efac, #bbf7d0); color: #14532d;">
                            <th style="padding: 16px; border: 1px solid #86efac; text-align: center; font-size: 15px; font-weight: 700; min-width: 60px; background: linear-gradient(135deg, #86efac, #bbf7d0); color: #14532d; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ù…</th>
                            <th style="padding: 16px; border: 1px solid #86efac; text-align: center; font-size: 15px; font-weight: 700; min-width: 150px; background: linear-gradient(135deg, #86efac, #bbf7d0); color: #14532d; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø´Ù‡Ø±</th>
                            <th style="padding: 16px; border: 1px solid #86efac; text-align: center; font-size: 15px; font-weight: 700; min-width: 150px; background: linear-gradient(135deg, #86efac, #bbf7d0); color: #14532d; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø£Ø°ÙˆÙ† ÙˆØ³Ù†Ø¯Ø§Øª</th>
                            <th style="padding: 16px; border: 1px solid #86efac; text-align: center; font-size: 15px; font-weight: 700; min-width: 150px; background: linear-gradient(135deg, #86efac, #bbf7d0); color: #14532d; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø£Ø°ÙˆÙ†</th>
                        </tr>
                    </thead>
                    <tbody id="treasuryYieldTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø© -->
    <div class="modal" id="irregularWorkersModal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto; position: relative;">
            <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <button id="closeIrregularModal" style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <h3 style="text-align: center; color: var(--blue); margin-bottom: 20px; margin-top: 10px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-users" style="font-size: 28px;"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©
            </h3>
            
            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div style="position: absolute; top: 15px; right: 15px; z-index: 1000;">
                <button id="unlockIrregularTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #34d399); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5); display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-unlock"></i> ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button id="lockIrregularTableBtn" style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444, #f87171); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5); display: none; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-lock"></i> Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>

            <div style="max-height: 500px; overflow-y: auto; overflow-x: auto; box-shadow: 0 6px 20px rgba(251, 146, 60, 0.2); border-radius: 12px; position: relative; border: 2px solid #fed7aa;">
                <table id="irregularWorkersTable" style="width: 100%; border-collapse: separate; border-spacing: 0;">
                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #fed7aa, #fdba74);">
                        <tr style="background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412;">
                            <th style="padding: 18px; border: 1px solid #fed7aa; text-align: center; font-size: 15px; font-weight: 700; min-width: 200px; background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 18px; border: 1px solid #fed7aa; text-align: center; font-size: 15px; font-weight: 700; min-width: 200px; background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 18px; border: 1px solid #fed7aa; text-align: center; font-size: 15px; font-weight: 700; min-width: 200px; background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 18px; border: 1px solid #fed7aa; text-align: center; font-size: 15px; font-weight: 700; min-width: 120px; display: none; background: linear-gradient(135deg, #fed7aa, #fdba74); color: #9a3412; text-shadow: 0 1px 2px rgba(255,255,255,0.5);" class="irregular-actions-column">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="irregularWorkersTableBody">
                    </tbody>
                </table>
            </div>

            <button id="addIrregularRowBtn" style="margin-top: 15px; padding: 12px 24px; background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); display: none; align-items: center; gap: 8px; margin-left: auto; margin-right: auto;">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ -->
    <div class="modal" id="wageLimitsModal">
        <div class="modal-content" style="max-width: 900px; position: relative;">
            <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø± -->
            <button id="closeWageLimitsModal" style="position: absolute; top: 15px; left: 15px; width: 40px; height: 40px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 20px; font-weight: bold; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; transition: all 0.3s;">
                <i class="fas fa-times"></i>
            </button>

            <h3 style="text-align: center; color: var(--blue); margin-bottom: 20px; margin-top: 10px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-money-check-alt" style="font-size: 28px;"></i> Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù‚ 148 Ù„Ø³Ù†Ø© 2019
            </h3>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† -->
            <div style="position: absolute; top: 15px; right: 15px; z-index: 1000;">
                <button id="enableWageLimitsEdit" style="padding: 10px 20px; background: linear-gradient(135deg, #10b981, #34d399); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.5); display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-unlock"></i> ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
                <button id="disableWageLimitsEdit" style="padding: 10px 20px; background: linear-gradient(135deg, #ef4444, #f87171); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.5); display: none; align-items: center; gap: 8px; transition: all 0.3s;">
                    <i class="fas fa-lock"></i> Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
                </button>
            </div>

            <div style="max-height: 500px; overflow-y: auto; position: relative; box-shadow: 0 6px 20px rgba(6, 182, 212, 0.2); border-radius: 12px; border: 2px solid #a5f3fc;">
                <table id="wageLimitsTable" style="width: 100%; border-collapse: separate; border-spacing: 0; background: white;">
                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, #a5f3fc, #67e8f9);">
                        <tr style="background: linear-gradient(135deg, #a5f3fc, #67e8f9); color: #164e63;">
                            <th style="padding: 16px; text-align: center; font-size: 15px; font-weight: 700; border: 1px solid #a5f3fc; background: linear-gradient(135deg, #a5f3fc, #67e8f9); color: #164e63; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th style="padding: 16px; text-align: center; font-size: 15px; font-weight: 700; border: 1px solid #a5f3fc; background: linear-gradient(135deg, #a5f3fc, #67e8f9); color: #164e63; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 16px; text-align: center; font-size: 15px; font-weight: 700; border: 1px solid #a5f3fc; background: linear-gradient(135deg, #a5f3fc, #67e8f9); color: #164e63; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th id="wageLimitsActionsHeader" style="padding: 16px; text-align: center; font-size: 15px; font-weight: 700; border: 1px solid #a5f3fc; width: 140px; display: none; background: linear-gradient(135deg, #a5f3fc, #67e8f9); color: #164e63; text-shadow: 0 1px 2px rgba(255,255,255,0.5);">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="wageLimitsTableBody">
                        <!-- Ø§Ù„ØµÙÙˆÙ Ø³ØªØ¶Ø§Ù Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </tbody>
                </table>
            </div>

            <button id="addWageLimitRow" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4); margin-top: 20px; display: none;">
                <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            </button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ© -->
    <div class="modal" id="presumptiveSubsModal">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh; overflow-y: auto;">
            <h3 style="text-align: center; color: var(--blue); margin-bottom: 15px; font-size: 22px; display: flex; align-items: center; justify-content: center; gap: 12px;">
                <i class="fas fa-calculator" style="font-size: 28px;"></i> Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ©
            </h3>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ -->
            <div id="presumptiveErrorsContainer" style="display: none; background: #fee2e2; border: 2px solid #ef4444; border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                <div style="display: flex; align-items: start; gap: 10px;">
                    <i class="fas fa-exclamation-triangle" style="color: #dc2626; font-size: 20px; margin-top: 2px;"></i>
                    <div style="flex: 1;">
                        <h4 style="color: #dc2626; margin: 0 0 8px 0; font-size: 15px;">ØªÙ†Ø¨ÙŠÙ‡: ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                        <ul id="presumptiveErrorsList" style="margin: 0; padding-right: 20px; color: #991b1b; font-size: 13px; line-height: 1.6;">
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Ø¬Ù…Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø© Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
            <div style="display: flex; justify-content: flex-start; margin-bottom: 10px;">
                <div style="background: linear-gradient(135deg, #dcfce7, #86efac); padding: 12px 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); display: inline-flex; align-items: center; gap: 10px; white-space: nowrap;">
                    <i class="fas fa-coins" style="font-size: 18px; color: #065f46;"></i>
                    <span style="font-weight: bold; font-size: 14px; color: #065f46;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                    <span id="presumptiveTotalSubs" style="font-weight: bold; font-size: 18px; color: #065f46;">0.00</span>
                </div>
            </div>

            <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
            <div style="overflow-x: auto; margin-bottom: 15px;">
                <table id="presumptiveTable" style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #1e40af, #3b82f6); color: white;">
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af;">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af;">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af;">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø© Ø§Ù„Ø­ÙƒÙ…ÙŠØ©</th>
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</th>
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            <th style="padding: 10px; text-align: center; font-size: 13px; border: 1px solid #1e40af; width: 140px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="presumptiveRowsContainer">
                        <!-- Ø§Ù„ØµÙÙˆÙ Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </tbody>
                </table>
            </div>

            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ -->
            <div style="display: flex; gap: 10px;">
                <button id="addPresumptiveRowBtn" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 3px 8px rgba(124, 58, 237, 0.4); display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙØªØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
                </button>
                <button id="exportPresumptivePDF" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 3px 8px rgba(220, 38, 38, 0.4); display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                </button>
                <button id="closePresumptiveModal" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #6b7280, #9ca3af); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 3px 8px rgba(107, 114, 128, 0.4); display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <div class="modal" id="presumptiveDetailsModal" style="z-index: 10000;" onclick="if(event.target === this) { event.stopPropagation(); closePresumptiveDetailsModal(); }">
        <div class="modal-content" style="max-width: 95%; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation();">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0;">
                <h3 style="color: #0891b2; font-size: 20px; display: flex; align-items: center; gap: 10px; margin: 0;">
                    <i class="fas fa-table" style="font-size: 24px;"></i> 
                    <span id="detailsModalTitle">ØªÙØ§ØµÙŠÙ„ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</span>
                </h3>
                <button onclick="event.stopPropagation(); closePresumptiveDetailsModal();" style="background: transparent; border: none; font-size: 28px; color: #64748b; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; transition: all 0.2s;">
                    Ã—
                </button>
            </div>

            <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª -->
            <div id="detailsModalSummary" style="background: linear-gradient(135deg, #f0f9ff, #e0f2fe); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #0891b2;">
            </div>

            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
            <div id="detailsModalContent" style="overflow-x: auto;">
            </div>

            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div style="display: flex; gap: 12px; margin-top: 20px;">
                <button onclick="event.stopPropagation(); exportDetailsModalToPDF();" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);">
                    <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                </button>
                <button onclick="event.stopPropagation(); closePresumptiveDetailsModal();" style="flex: 1; padding: 14px; background: linear-gradient(135deg, #6b7280, #9ca3af); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4);">
                    <i class="fas fa-times"></i> Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>
    
    <div id="toast">ØªÙ… Ø§Ù„Ø­ÙØ¸</div>
    
    <div class="rates-detail-modal" id="ratesDetailModal">
        <div class="rates-detail-content">
            <div class="rates-detail-header">
                <h3><i class="fas fa-calculator"></i> ØªÙØ§ØµÙŠÙ„ Ù†Ø³Ø¨ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª</h3>
                <button class="rates-detail-close" onclick="closeRatesDetailModal()">Ã—</button>
            </div>
            <div id="ratesDetailBody"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js" 
            onerror="this.onerror=null; this.src='https://unpkg.com/html2pdf.js@0.10.2/dist/html2pdf.bundle.min.js'"></script>
    <script>
        // ğŸ” Ø­Ù…Ø§ÙŠØ© Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©
        (function() {
            const designer1 = document.querySelector('.designer-info');
            const designer2 = document.querySelector('.department-info');
            
            const expectedText1 = "ØªØµÙ…ÙŠÙ…: Ø­Ø³Ù† Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯";
            const expectedText2 = "Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠØ©";
            
            if (!designer1 || !designer2 || 
                designer1.textContent.trim() !== expectedText1 || 
                designer2.textContent.trim() !== expectedText2) {
                
                // Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                localStorage.clear();
                sessionStorage.clear();
                
                // Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ±
                document.body.innerHTML = `
                    <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#7f1d1d,#991b1b);display:flex;align-items:center;justify-content:center;font-family:Arial;z-index:999999">
                        <div style="text-align:center;max-width:600px;padding:50px;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.5)">
                            <div style="font-size:80px;margin-bottom:20px">âš ï¸</div>
                            <h1 style="color:#991b1b;margin-bottom:20px;font-size:32px">ØªØ­Ø°ÙŠØ±: ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØµÙ…Ù…</h1>
                            <p style="color:#44403c;font-size:18px;line-height:1.8;margin-bottom:30px">
                                ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…ØµÙ…Ù… Ø£Ùˆ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠØ©<br><br>
                                <strong>ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</strong>
                            </p>
                            <div style="background:#fef3c7;padding:20px;border-radius:10px;border-right:4px solid #f59e0b">
                                <p style="color:#78350f;font-size:14px;margin:0">
                                    ğŸ“ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ø³Ø®Ø© Ø£ØµÙ„ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬<br>
                                    <strong>Ø§Ù„Ù…Ø·ÙˆØ±: Ø­Ø³Ù† Ø¹Ù„ÙŠ Ù…Ø­Ù…Ø¯</strong><br>
                                    Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠØ©
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                throw new Error("Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¹Ø·Ù„ Ø¨Ø³Ø¨Ø¨ ØªØ¹Ø¯ÙŠÙ„ ØºÙŠØ± Ù…ØµØ±Ø­");
            }
        })();

        // ğŸ”’ Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± ÙˆØ§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ØµØ¯Ø±ÙŠ
        (function() {
            let protectionBroken = false;
            
            // ÙˆØ¸ÙŠÙØ© Ø¥ØºÙ„Ø§Ù‚/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¹Ù†Ø¯ ÙƒØ³Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            function disableOnProtectionBreach() {
                if (protectionBroken) return;
                protectionBroken = true;
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                window.open('', '_self');
                window.close();
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙ†Ø¬Ø­ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ØŒ ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªÙ…Ø§Ù…Ø§Ù‹
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;right:0;bottom:0;background:#991b1b;display:flex;align-items:center;justify-content:center;color:white;font-size:24px;font-family:Arial;z-index:999999;"><div style="text-align:center;"><div style="font-size:60px;margin-bottom:20px;">âš ï¸</div><div>ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ù…Ø­Ø§ÙˆÙ„Ø© ÙƒØ³Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©</div><div style="font-size:18px;margin-top:10px;">ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</div></div></div>';
                
                throw new Error('ØªÙ… ÙƒØ³Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©');
            }

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ†
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ø®ØªØµØ§Ø±Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
            document.addEventListener('keydown', function(e) {
                // F12 - Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
                if (e.keyCode === 123) {
                    e.preventDefault();
                    return false;
                }
                
                // Ctrl+Shift+I - Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ±
                if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
                    e.preventDefault();
                    return false;
                }
                
                // Ctrl+Shift+J - Console
                if (e.ctrlKey && e.shiftKey && e.keyCode === 74) {
                    e.preventDefault();
                    return false;
                }
                
                // Ctrl+Shift+C - Inspect Element
                if (e.ctrlKey && e.shiftKey && e.keyCode === 67) {
                    e.preventDefault();
                    return false;
                }
                
                // Ctrl+U - View Source
                if (e.ctrlKey && e.keyCode === 85) {
                    e.preventDefault();
                    return false;
                }
                
                // Ctrl+S - Save Page
                if (e.ctrlKey && e.keyCode === 83) {
                    e.preventDefault();
                    return false;
                }
            });

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });

            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ØµÙŠ (Ø¥Ù„Ø§ ÙÙŠ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„)
            document.addEventListener('selectstart', function(e) {
                if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                    e.preventDefault();
                    return false;
                }
            });

            // ÙØ­Øµ Ù…Ø³ØªÙ…Ø±: Ø¥Ø°Ø§ ØªÙ… ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± Ø±ØºÙ… Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            setInterval(function() {
                const threshold = 160;
                const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                
                if (widthThreshold || heightThreshold) {
                    disableOnProtectionBreach();
                }
            }, 1000);

            // ÙØ­Øµ: Ø¥Ø°Ø§ ØªÙ… ØªØ¹Ø·ÙŠÙ„ JavaScript Ø£Ùˆ ÙƒØ³Ø± Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            (function() {
                const element = new Image();
                Object.defineProperty(element, 'id', {
                    get: function() {
                        disableOnProtectionBreach();
                    }
                });
                console.log(element);
            })();

            // ØªØ¹Ø·ÙŠÙ„ debugger
            setInterval(function() {
                (function() {
                    return false;
                }['constructor']('debugger')());
            }, 50);
        })();

        const STORAGE_KEY = "taswiyat_final_v7";
        const PASS_KEY = "taswiyat_pass_v7";
        const HISTORY_KEY = "taswiyat_history_v7";
        const ORDER_KEY = "taswiyat_dropdown_order_v7";
        let PASSWORD_HASH = "";
        let isLocked = true;
        let undoStack = [];
        let lastEnteredValue = "";
        let loginAttempts = 0;
        const MAX_ATTEMPTS = 5;

        async function hashPassword(p) {
            if (window.crypto && window.crypto.subtle) {
                const encoder = new TextEncoder();
                const data = encoder.encode(p);
                const hash = await crypto.subtle.digest('SHA-256', data);
                return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
            } else {
                let hash = 0;
                for (let i = 0; i < p.length; i++) {
                    const char = p.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return "simple_" + Math.abs(hash).toString(16);
            }
        }

        async function loadPassword() {
            const stored = localStorage.getItem(PASS_KEY);
            if (stored) PASSWORD_HASH = stored;
            else {
                PASSWORD_HASH = await hashPassword("H@ssan");
                localStorage.setItem(PASS_KEY, PASSWORD_HASH);
            }
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„ÙØ±Ø² Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„
        async function verifyPassword(input) {
            if (loginAttempts >= MAX_ATTEMPTS) { showToast("ØªÙ… Ø­Ø¸Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø¤Ù‚ØªÙ‹Ø§"); return false; }
            const inputHash = await hashPassword(input);
            if (inputHash === PASSWORD_HASH) { loginAttempts = 0; return true; }
            else { loginAttempts++; showToast(`ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø© (${loginAttempts}/${MAX_ATTEMPTS})`); return false; }
        }

        let saveTimeout;
        function debouncedSave() { clearTimeout(saveTimeout); saveTimeout = setTimeout(saveTableToStorage, 800); }

        function saveTableToStorage() {
            try {
                const rows = [];
                document.querySelectorAll("#tbody tr").forEach(tr => {
                    const rowData = {
                        date: tr.dataset.date,
                        sub: tr.querySelector(".sub").value,
                        payment: tr.querySelector(".payment").value,
                        after16: tr.querySelector(".after16").checked,
                        rate: tr.querySelector(".rate").value,
                        amount: tr.querySelector(".amount").value
                    };
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                    if (tr.dataset.detailedData) {
                        try {
                            rowData.detailedData = JSON.parse(tr.dataset.detailedData);
                        } catch (e) {}
                    }
                    
                    rows.push(rowData);
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(rows));
                localStorage.setItem(HISTORY_KEY, JSON.stringify(undoStack));
                localStorage.setItem(ORDER_KEY, JSON.stringify(getButtonOrder()));
                showToast("ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§");
            } catch (e) {
                console.error("Save error:", e);
                if (e.name === 'QuotaExceededError' || e.code === 22) showToast("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©!");
                else showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
            }
        }

        function getButtonOrder() { return Array.from(document.querySelectorAll("#dropdownMenu button")).map(btn => btn.id); }
        function pushUndo(description, callback) { undoStack.push({ description, callback }); if (undoStack.length > 1) undoStack.shift(); }

        function undoLast() {
            if (undoStack.length === 0) { showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡"); return; }
            const action = undoStack.pop();
            action.callback();
            showToast("ØªÙ… Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†: " + action.description);
            debouncedSave();
        }

        function buildRows() {
            const tbody = document.getElementById("tbody");
            const saved = loadStorage();
            const savedMap = new Map(saved.map(r => [r.date, r]));
            const firstDate = new Date(1976, 9, 1);
            const now = new Date();
            let cur = new Date(firstDate);
            while (cur <= now) {
                const yyyymm = cur.getFullYear() + "-" + String(cur.getMonth() + 1).padStart(2, "0");
                if (!savedMap.has(yyyymm)) {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
                    const defaultRate = DEFAULT_RATES[yyyymm] || "";
                    saved.push({ date: yyyymm, sub: "", rate: defaultRate, amount: "" });
                }
                cur.setMonth(cur.getMonth() + 1);
            }
            saved.sort((a, b) => a.date.localeCompare(b.date));
            tbody.innerHTML = "";
            const yearColors = ["#f7f1f0", "#eef7f1", "#f0eef7", "#fff8e6", "#e8f7ff", "#fef0f5", "#f3fff0", "#fff0f3"];
            saved.forEach((row, idx) => {
                const tr = document.createElement("tr");
                const year = parseInt(row.date.split("-")[0]);
                tr.style.background = yearColors[year % yearColors.length];
                tr.dataset.date = row.date;
                
                // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (row.detailedData) {
                    tr.dataset.detailedData = JSON.stringify(row.detailedData);
                }
                
                tr.innerHTML = `
      <td class="dateCell">${row.date}</td>
      <td><input type="number" step="0.01" class="sub" value="${row.sub || ''}" /></td>
      <td><input type="number" step="0.01" class="payment" value="${row.payment || ''}" /></td>
      <td style="text-align: center;"><input type="checkbox" class="after16" ${row.after16 ? 'checked' : ''} /></td>
      <td><input type="number" step="0.01" class="rate" value="${row.rate || ''}" readonly /></td>
      <td><input type="number" step="0.01" class="amount" readonly value="${row.amount || ''}" /></td>
    `;
                tbody.appendChild(tr);
            });
            wireRowEvents();
            applyAutoFillAmounts();
            updateTotals();
            lockRates();
            debouncedSave();
            applyFilter();
            restoreButtonOrder();
        }

        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù†Ø³Ø¨ Ø§Ù„ÙÙˆØ§Ø¦Ø¯
        const DEFAULT_RATES = {"1976-10":"0.5","1976-11":"0.5","1976-12":"0.5","1977-01":"0.5","1977-02":"0.5","1977-03":"0.5","1977-04":"0.5","1977-05":"0.5","1977-06":"0.5","1977-07":"0.5","1977-08":"0.5","1977-09":"0.5","1977-10":"0.5","1977-11":"0.5","1977-12":"0.5","1978-01":"0.5","1978-02":"0.5","1978-03":"0.5","1978-04":"0.5","1978-05":"0.5","1978-06":"0.5","1978-07":"0.5","1978-08":"0.5","1978-09":"0.5","1978-10":"0.5","1978-11":"0.5","1978-12":"0.5","1979-01":"0.5","1979-02":"0.5","1979-03":"0.5","1979-04":"0.5","1979-05":"0.5","1979-06":"0.5","1979-07":"0.5","1979-08":"0.5","1979-09":"0.5","1979-10":"0.5","1979-11":"0.5","1979-12":"0.5","1980-01":"0.5","1980-02":"0.5","1980-03":"0.5","1980-04":"0.5","1980-05":"0.5","1980-06":"0.5","1980-07":"0.5","1980-08":"0.5","1980-09":"0.5","1980-10":"0.5","1980-11":"0.5","1980-12":"0.5","1981-01":"0.5","1981-02":"0.5","1981-03":"0.5","1981-04":"0.5","1981-05":"0.5","1981-06":"0.5","1981-07":"0.5","1981-08":"0.5","1981-09":"0.5","1981-10":"0.5","1981-11":"0.5","1981-12":"0.5","1982-01":"0.5","1982-02":"0.5","1982-03":"0.5","1982-04":"0.5","1982-05":"0.5","1982-06":"0.5","1982-07":"0.5","1982-08":"0.5","1982-09":"0.5","1982-10":"0.5","1982-11":"0.5","1982-12":"0.5","1983-01":"0.5","1983-02":"0.5","1983-03":"0.5","1983-04":"0.5","1983-05":"0.5","1983-06":"0.5","1983-07":"0.5","1983-08":"0.5","1983-09":"0.5","1983-10":"0.5","1983-11":"0.5","1983-12":"0.5","1984-01":"0.5","1984-02":"0.5","1984-03":"0.5","1984-04":"01","1984-05":"01","1984-06":"01","1984-07":"01","1984-08":"01","1984-09":"01","1984-10":"01","1984-11":"01","1984-12":"01","1985-01":"01","1985-02":"01","1985-03":"01","1985-04":"01","1985-05":"01","1985-06":"01","1985-07":"01","1985-08":"01","1985-09":"01","1985-10":"01","1985-11":"01","1985-12":"01","1986-01":"01","1986-02":"01","1986-03":"01","1986-04":"01","1986-05":"01","1986-06":"01","1986-07":"01","1986-08":"01","1986-09":"01","1986-10":"01","1986-11":"01","1986-12":"01","1987-01":"01","1987-02":"01","1987-03":"01","1987-04":"01","1987-05":"01","1987-06":"01","1987-07":"01","1987-08":"01","1987-09":"01","1987-10":"01","1987-11":"01","1987-12":"01","1988-01":"01","1988-02":"01","1988-03":"01","1988-04":"01","1988-05":"01","1988-06":"01","1988-07":"01","1988-08":"01","1988-09":"01","1988-10":"01","1988-11":"01","1988-12":"01","1989-01":"01","1989-02":"01","1989-03":"01","1989-04":"01","1989-05":"01","1989-06":"01","1989-07":"01","1989-08":"01","1989-09":"01","1989-10":"01","1989-11":"01","1989-12":"01","1990-01":"01","1990-02":"1","1990-03":"1","1990-04":"1","1990-05":"1","1990-06":"1","1990-07":"1","1990-08":"1","1990-09":"1","1990-10":"1","1990-11":"1","1990-12":"1","1991-01":"1","1991-02":"1","1991-03":"1","1991-04":"1","1991-05":"1","1991-06":"1","1991-07":"1","1991-08":"1","1991-09":"1","1991-10":"1","1991-11":"1","1991-12":"1","1992-01":"1","1992-02":"1","1992-03":"1","1992-04":"1","1992-05":"1","1992-06":"1","1992-07":"1","1992-08":"1","1992-09":"1","1992-10":"1","1992-11":"1","1992-12":"1","1993-01":"1","1993-02":"1","1993-03":"1","1993-04":"1","1993-05":"1","1993-06":"1","1993-07":"1","1993-08":"1","1993-09":"1","1993-10":"1","1993-11":"1","1993-12":"1","1994-01":"1","1994-02":"1","1994-03":"1","1994-04":"1","1994-05":"1","1994-06":"1","1994-07":"1","1994-08":"1","1994-09":"1","1994-10":"1","1994-11":"1","1994-12":"1","1995-01":"1","1995-02":"1","1995-03":"1","1995-04":"1","1995-05":"1","1995-06":"1","1995-07":"1","1995-08":"1","1995-09":"1","1995-10":"1","1995-11":"1","1995-12":"1","1996-01":"1","1996-02":"1","1996-03":"1","1996-04":"1","1996-05":"1","1996-06":"1","1996-07":"1","1996-08":"1","1996-09":"1","1996-10":"1","1996-11":"1","1996-12":"1","1997-01":"1","1997-02":"1","1997-03":"1","1997-04":"1","1997-05":"1","1997-06":"1","1997-07":"1","1997-08":"1","1997-09":"1","1997-10":"1","1997-11":"1","1997-12":"1","1998-01":"1","1998-02":"1","1998-03":"1","1998-04":"1","1998-05":"1","1998-06":"1","1998-07":"1","1998-08":"1","1998-09":"1","1998-10":"1","1998-11":"1","1998-12":"1","1999-01":"1","1999-02":"1","1999-03":"1","1999-04":"1","1999-05":"1","1999-06":"1","1999-07":"1","1999-08":"1","1999-09":"1","1999-10":"1","1999-11":"1","1999-12":"1","2000-01":"1","2000-02":"1","2000-03":"1","2000-04":"1","2000-05":"1","2000-06":"1","2000-07":"1","2000-08":"1","2000-09":"1","2000-10":"1","2000-11":"1","2000-12":"1","2001-01":"1","2001-02":"1","2001-03":"1","2001-04":"1","2001-05":"1","2001-06":"1","2001-07":"1","2001-08":"1","2001-09":"1","2001-10":"1","2001-11":"1","2001-12":"1","2002-01":"1","2002-02":"1","2002-03":"1","2002-04":"1","2002-05":"1","2002-06":"1","2002-07":"1","2002-08":"1","2002-09":"1","2002-10":"1","2002-11":"1","2002-12":"1","2003-01":"1","2003-02":"1","2003-03":"1","2003-04":"1","2003-05":"1","2003-06":"1","2003-07":"1.5","2003-08":"1.5","2003-09":"1.5","2003-10":"1.5","2003-11":"1.5","2003-12":"1.5","2004-01":"1.5","2004-02":"1.5","2004-03":"1.5","2004-04":"1.5","2004-05":"1.5","2004-06":"1.5","2004-07":"2.5","2004-08":"2.5","2004-09":"2.5","2004-10":"2.5","2004-11":"2.5","2004-12":"2.5","2005-01":"2.5","2005-02":"2.5","2005-03":"2.5","2005-04":"2.5","2005-05":"2.5","2005-06":"2.5","2005-07":"2.5","2005-08":"2.5","2005-09":"2.5","2005-10":"2.5","2005-11":"2.5","2005-12":"2.5","2006-01":"2.5","2006-02":"2.5","2006-03":"2.5","2006-04":"2.5","2006-05":"2.5","2006-06":"2.5","2006-07":"2.5","2006-08":"2.5","2006-09":"2.5","2006-10":"2.5","2006-11":"2.5","2006-12":"2.5","2007-01":"0.91","2007-02":"0.91","2007-03":"0.91","2007-04":"0.91","2007-05":"0.91","2007-06":"0.91","2007-07":"0.91","2007-08":"0.91","2007-09":"0.91","2007-10":"0.91","2007-11":"0.91","2007-12":"0.91","2008-01":"0.91","2008-02":"0.91","2008-03":"0.91","2008-04":"0.91","2008-05":"0.91","2008-06":"01","2008-07":"1.08","2008-08":"1.125","2008-09":"1.125","2008-10":"1.125","2008-11":"1.125","2008-12":"1.125","2009-01":"1.042","2009-02":"01","2009-03":"1.010","2009-04":"0.958","2009-05":"0.920","2009-06":"0.920","2009-07":"0.875","2009-08":"0.875","2009-09":"0.875","2009-10":"0.875","2009-11":"0.875","2009-12":"0.875","2010-01":"0.875","2010-02":"0.875","2010-03":"0.875","2010-04":"0.875","2010-05":"0.875","2010-06":"0.875","2010-07":"0.875","2010-08":"0.875","2010-09":"0.875","2010-10":"0.875","2010-11":"0.875","2010-12":"0.875","2011-01":"0.875","2011-02":"0.875","2011-03":"0.875","2011-04":"0.875","2011-05":"0.875","2011-06":"0.875","2011-07":"0.875","2011-08":"0.875","2011-09":"0.875","2011-10":"0.875","2011-11":"0.875","2011-12":"0.958","2012-01":"0.958","2012-02":"0.958","2012-03":"0.958","2012-04":"0.958","2012-05":"0.958","2012-06":"0.958","2012-07":"0.958","2012-08":"0.958","2012-09":"0.958","2012-10":"0.958","2012-11":"0.958","2012-12":"0.958","2013-01":"0.958","2013-02":"0.958","2013-03":"1.020","2013-04":"1.020","2013-05":"1.020","2013-06":"1.020","2013-07":"0.980","2013-08":"0.980","2013-09":"0.937","2013-10":"0.937","2013-11":"0.895","2013-12":"0.895","2014-01":"0.895","2014-02":"0.895","2014-03":"0.895","2014-04":"0.895","2014-05":"0.895","2014-06":"0.895","2014-07":"0.98","2014-08":"0.98","2014-09":"0.98","2014-10":"0.98","2014-11":"0.98","2014-12":"0.94","2015-01":"0.94","2015-02":"0.94","2015-03":"0.94","2015-04":"0.94","2015-05":"0.94","2015-06":"0.94","2015-07":"0.94","2015-08":"0.94","2015-09":"0.94","2015-10":"0.94","2015-11":"0.94","2015-12":"0.94","2016-01":"0.94","2016-02":"0.94","2016-03":"0.94","2016-04":"0.94","2016-05":"1.19","2016-06":"1.19","2016-07":"1.19","2016-08":"1.19","2016-09":"1.19","2016-10":"1.44","2016-11":"1.44","2016-12":"1.44","2017-01":"1.44","2017-02":"1.44","2017-03":"1.44","2017-04":"1.44","2017-05":"1.6","2017-06":"1.77","2017-07":"1.77","2017-08":"1.77","2017-09":"1.77","2017-10":"1.77","2017-11":"1.77","2017-12":"1.77","2018-01":"1.77","2018-02":"1.690","2018-03":"1.6","2018-04":"1.6","2018-05":"1.6","2018-06":"1.6","2018-07":"1.6","2018-08":"1.6","2018-09":"1.6","2018-10":"1.6","2018-11":"1.6","2018-12":"1.6","2019-01":"1.6","2019-02":"1.52","2019-03":"1.52","2019-04":"1.52","2019-05":"1.52","2019-06":"1.52","2019-07":"1.52","2019-08":"1.4","2019-09":"1.3","2019-10":"1.23","2019-11":"1.23","2019-12":"1.23","2020-01":"1.23","2020-02":"1.23","2020-03":"1.23","2020-04":"1.23","2020-05":"1.23","2020-06":"1.23","2020-07":"1.23","2020-08":"1.23","2020-09":"1.25","2020-10":"1.34","2020-11":"1.34","2020-12":"1.34","2021-01":"1.34","2021-02":"1.34","2021-03":"1.34","2021-04":"1.34","2021-05":"1.34","2021-06":"1.34","2021-07":"1.34","2021-08":"1.34","2021-09":"1.34","2021-10":"1.34","2021-11":"1.34","2021-12":"1.34","2022-01":"1.34","2022-02":"1.34","2022-03":"1.34","2022-04":"1.34","2022-05":"1.34","2022-06":"1.34","2022-07":"1.34","2022-08":"1.34","2022-09":"1.34","2022-10":"1.34","2022-11":"1.58","2022-12":"1.58","2023-01":"1.58","2023-02":"1.58","2023-03":"1.58","2023-04":"1.58","2023-05":"1.58","2023-06":"1.58","2023-07":"1.58","2023-08":"2.2","2023-09":"2.2","2023-10":"2.32","2023-11":"2.32","2023-12":"2.32","2024-01":"2.36","2024-02":"2.4","2024-03":"2.57","2024-04":"2.31","2024-05":"2.31","2024-06":"2.29","2024-07":"2.33","2024-08":"2.43","2024-09":"2.43","2024-10":"2.44","2024-11":"2.46","2024-12":"2.48","2025-01":"2.450","2025-02":"2.270","2025-03":"2.280","2025-04":"2.250","2025-05":"2.220","2025-06":"2.250","2025-07":"2.276","2025-08":"2.299","2025-09":"2.300","2025-10":"2.230","2025-11":"2.210"};

        function loadStorage() { 
            try { 
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    return JSON.parse(stored);
                } else {
                    // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
                    return [];
                }
            } catch { 
                return []; 
            } 
        }

        function applyAutoFillAmounts() {
            let allRows = Array.from(document.querySelectorAll("#tbody tr")).sort((a, b) => a.dataset.date.localeCompare(b.dataset.date));
            
            let accumulatedSubs = 0; // Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…
            let accumulatedInterest = 0; // Ø±ØµÙŠØ¯ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…
            let creditBalance = 0; // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø§Ø¦Ù† (Ø¥Ù† ÙˆØ¬Ø¯)
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            allRows.forEach((tr, index) => {
                const sub = parseFloat(tr.querySelector(".sub").value) || 0;
                const rate = parseFloat(tr.querySelector(".rate").value) || 0;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ: Ù‡Ù„ ÙÙŠÙ‡ Ø³Ø¯Ø§Ø¯ØŸ
                let nextMonthPayment = 0;
                let nextMonthAfter16 = false;
                if (index < allRows.length - 1) {
                    const nextTr = allRows[index + 1];
                    nextMonthPayment = parseFloat(nextTr.querySelector(".payment").value) || 0;
                    nextMonthAfter16 = nextTr.querySelector(".after16").checked;
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…
                accumulatedSubs += sub;
                
                // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø§Ø¦Ù† Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹
                if (creditBalance > 0 && accumulatedSubs > 0) {
                    if (creditBalance >= accumulatedSubs) {
                        creditBalance -= accumulatedSubs;
                        accumulatedSubs = 0;
                    } else {
                        accumulatedSubs -= creditBalance;
                        creditBalance = 0;
                    }
                }
                
                // Ø®ØµÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ (Ù„Ø£Ù† Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙÙŠ Ø´Ù‡Ø± X ÙŠÙØ¹ØªØ¨Ø± ÙƒØ£Ù†Ù‡ ÙÙŠ Ø´Ù‡Ø± X-1)
                if (nextMonthPayment > 0 && !nextMonthAfter16) {
                    // Ø³Ø¯Ø§Ø¯ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ù‚Ø¨Ù„ ÙŠÙˆÙ… 16 â†’ ÙŠÙØ®ØµÙ… Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                    let remainingPayment = nextMonthPayment;
                    
                    // Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø£ÙˆÙ„Ø§Ù‹
                    if (remainingPayment >= accumulatedSubs) {
                        remainingPayment -= accumulatedSubs;
                        accumulatedSubs = 0;
                    } else {
                        accumulatedSubs -= remainingPayment;
                        remainingPayment = 0;
                    }
                    
                    // Ø«Ù… Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯
                    if (remainingPayment > 0 && accumulatedInterest > 0) {
                        if (remainingPayment >= accumulatedInterest) {
                            remainingPayment -= accumulatedInterest;
                            accumulatedInterest = 0;
                        } else {
                            accumulatedInterest -= remainingPayment;
                            remainingPayment = 0;
                        }
                    }
                    
                    // Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµØ¨Ø­ Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†
                    if (remainingPayment > 0) {
                        creditBalance += remainingPayment;
                    }
                }
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ… Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
                let interestForThisMonth = 0;
                if (accumulatedSubs > 0) {
                    interestForThisMonth = (accumulatedSubs * rate / 100);
                    accumulatedInterest += interestForThisMonth;
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø¯Ø§Ø¯ ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø¹Ø¯ ÙŠÙˆÙ… 15 â†’ ÙŠÙØ®ØµÙ… Ø¨Ø¹Ø¯ Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø¦Ø¯Ø©
                if (nextMonthPayment > 0 && nextMonthAfter16) {
                    let remainingPayment = nextMonthPayment;
                    
                    // Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø£ÙˆÙ„Ø§Ù‹
                    if (remainingPayment >= accumulatedSubs) {
                        remainingPayment -= accumulatedSubs;
                        accumulatedSubs = 0;
                    } else {
                        accumulatedSubs -= remainingPayment;
                        remainingPayment = 0;
                    }
                    
                    // Ø«Ù… Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯
                    if (remainingPayment > 0 && accumulatedInterest > 0) {
                        if (remainingPayment >= accumulatedInterest) {
                            remainingPayment -= accumulatedInterest;
                            accumulatedInterest = 0;
                        } else {
                            accumulatedInterest -= remainingPayment;
                            remainingPayment = 0;
                        }
                    }
                    
                    // Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµØ¨Ø­ Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†
                    if (remainingPayment > 0) {
                        creditBalance += remainingPayment;
                    }
                }
                
                // Ø¹Ø±Ø¶ Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
                tr.querySelector(".amount").value = interestForThisMonth.toFixed(2);
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ±Ø§ÙƒÙ…Ø© ÙÙŠ Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
            window.accumulatedSubs = accumulatedSubs;
            window.accumulatedInterest = accumulatedInterest;
            window.creditBalance = creditBalance;
        }

        function updateTotals() {
            let totalPayments = 0;
            let rawPrevSubs = 0, rawPrevInt = 0, rawCurrSubs = 0, rawCurrInt = 0;
            
            const now = new Date();
            const curY = now.getFullYear();
            const curM = now.getMonth() + 1;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©
            const fiscalYearStart = curM >= 7 ? curY : curY - 1;
            
            // Ø¬Ù…Ø¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø®Ø§Ù… Ù„ÙƒÙ„ ÙØªØ±Ø© (Ù„Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø·)
            document.querySelectorAll("#tbody tr").forEach(tr => {
                if (tr.style.display === "none") return;
                
                const [yy, mm] = tr.dataset.date.split("-").map(Number);
                const sub = parseFloat(tr.querySelector(".sub").value) || 0;
                const interest = parseFloat(tr.querySelector(".amount").value) || 0;
                const payment = parseFloat(tr.querySelector(".payment").value) || 0;
                
                totalPayments += payment;
                
                const isBeforeCurrentFiscalYear = yy < fiscalYearStart || (yy === fiscalYearStart && mm < 7);
                
                if (isBeforeCurrentFiscalYear) {
                    rawPrevSubs += sub;
                    rawPrevInt += interest;
                } else {
                    rawCurrSubs += sub;
                    rawCurrInt += interest;
                }
            });
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù…Ù† applyAutoFillAmounts
            const accumulatedSubs = Math.max(0, window.accumulatedSubs || 0);
            const accumulatedInterest = Math.max(0, window.accumulatedInterest || 0);
            const creditBalance = window.creditBalance || 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø±ØµØ¯Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„ÙƒÙ„ ÙØªØ±Ø© Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø®ØµÙ… ÙÙŠ Ø§Ù„Ù…Ù„Ø®Øµ ÙÙ‚Ø·:
            // 1. Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            // 2. Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            // 3. Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            // 4. Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            // 5. Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµØ¨Ø­ Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†
            
            let remainingPayment = totalPayments;
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            let netPrevSubs = rawPrevSubs;
            if (remainingPayment >= netPrevSubs) {
                remainingPayment -= netPrevSubs;
                netPrevSubs = 0;
            } else {
                netPrevSubs -= remainingPayment;
                remainingPayment = 0;
            }
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø®ØµÙ… Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let netCurrSubs = rawCurrSubs;
            if (remainingPayment >= netCurrSubs) {
                remainingPayment -= netCurrSubs;
                netCurrSubs = 0;
            } else {
                netCurrSubs -= remainingPayment;
                remainingPayment = 0;
            }
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            let netPrevInt = rawPrevInt;
            if (remainingPayment >= netPrevInt) {
                remainingPayment -= netPrevInt;
                netPrevInt = 0;
            } else {
                netPrevInt -= remainingPayment;
                remainingPayment = 0;
            }
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø®ØµÙ… Ù…Ù† Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let netCurrInt = rawCurrInt;
            if (remainingPayment >= netCurrInt) {
                remainingPayment -= netCurrInt;
                netCurrInt = 0;
            } else {
                netCurrInt -= remainingPayment;
                remainingPayment = 0;
            }
            
            // Ø§Ù„Ø®Ø·ÙˆØ© 5: Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµØ¨Ø­ Ø±ØµÙŠØ¯ Ø¯Ø§Ø¦Ù†
            const displayCreditBalance = remainingPayment;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¹Ø¯ ØªØ·Ø¨ÙŠÙ‚ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø®ØµÙ…
            document.getElementById("prevSubs").textContent = netPrevSubs.toFixed(2);
            document.getElementById("prevInterest").textContent = netPrevInt.toFixed(2);
            document.getElementById("currSubs").textContent = netCurrSubs.toFixed(2);
            document.getElementById("currInterest").textContent = netCurrInt.toFixed(2);
            document.getElementById("totalPayments").textContent = totalPayments.toFixed(2);
            
            // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            const totalInterestDisplay = netPrevInt + netCurrInt;
            const finalTotalDisplay = netPrevSubs + netCurrSubs + netPrevInt + netCurrInt;
            
            document.getElementById("totalInterest").textContent = totalInterestDisplay.toFixed(2);
            document.getElementById("finalTotal").textContent = finalTotalDisplay.toFixed(2);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø§Ø¦Ù† ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ­Ù‚Ø§Øª
            if (displayCreditBalance > 0 && finalTotalDisplay === 0) {
                document.getElementById("creditBalance").textContent = displayCreditBalance.toFixed(2);
                document.getElementById("creditBalanceItem").style.display = "block";
                document.getElementById("creditBalanceValue").style.display = "block";
            } else {
                document.getElementById("creditBalanceItem").style.display = "none";
                document.getElementById("creditBalanceValue").style.display = "none";
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙØªØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
            updatePeriodBanner();
        }
        
        function updatePeriodBanner() {
            const allRows = Array.from(document.querySelectorAll("#tbody tr")).filter(tr => tr.style.display !== "none");
            
            if (allRows.length === 0) {
                document.getElementById("periodStartDate").textContent = "-";
                document.getElementById("periodEndDate").textContent = "-";
                return;
            }
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø´Ù‡Ø± Ù„Ù‡ Ø§Ø´ØªØ±Ø§Ùƒ ÙØ¹Ù„ÙŠ
            let firstSubscriptionDate = null;
            for (const tr of allRows) {
                const sub = parseFloat(tr.querySelector(".sub").value) || 0;
                if (sub > 0) {
                    firstSubscriptionDate = tr.dataset.date;
                    break;
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø§Ø´ØªØ±Ø§Ùƒ Ù…ÙØ¯Ø®Ù„ØŒ Ù„Ø§ Ù†Ø¹Ø±Ø¶ ÙØªØ±Ø©
            if (!firstSubscriptionDate) {
                document.getElementById("periodStartDate").textContent = "-";
                document.getElementById("periodEndDate").textContent = "-";
                return;
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¢Ø®Ø± Ø´Ù‡Ø± Ù…Ø­Ø³ÙˆØ¨ Ø¹Ù†Ù‡ ÙØ§Ø¦Ø¯Ø© ÙØ¹Ù„ÙŠØ§Ù‹
            let lastInterestDate = null;
            for (let i = allRows.length - 1; i >= 0; i--) {
                const tr = allRows[i];
                const interest = parseFloat(tr.querySelector(".amount").value) || 0;
                
                // Ø¢Ø®Ø± Ø´Ù‡Ø± Ù„Ù‡ ÙØ§Ø¦Ø¯Ø© Ù…Ø­Ø³ÙˆØ¨Ø© (interest > 0)
                if (interest > 0) {
                    lastInterestDate = tr.dataset.date;
                    break;
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ø´Ù‡Ø± Ù„Ù‡ ÙØ§Ø¦Ø¯Ø©ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø± Ø´Ù‡Ø± Ù„Ù‡ Ø§Ø´ØªØ±Ø§Ùƒ
            if (!lastInterestDate) {
                for (let i = allRows.length - 1; i >= 0; i--) {
                    const sub = parseFloat(allRows[i].querySelector(".sub").value) || 0;
                    if (sub > 0) {
                        lastInterestDate = allRows[i].dataset.date;
                        break;
                    }
                }
            }
            
            // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
            const formatDate = (dateStr) => {
                if (!dateStr) return "-";
                const [year, month] = dateStr.split("-");
                const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];
                return `${months[parseInt(month) - 1]} ${year}`;
            };
            
            document.getElementById("periodStartDate").textContent = formatDate(firstSubscriptionDate);
            document.getElementById("periodEndDate").textContent = formatDate(lastInterestDate);
        }

        function applyFilter() {
            const type = document.getElementById("filterType").value;
            const condition = document.getElementById("filterCondition").value;
            let val1 = document.getElementById("filterDate1").value.trim();
            let val2 = document.getElementById("filterDate2").value.trim();
            
            if (condition === "between") {
                document.getElementById("filterDate2").style.display = "block";
                if (!val1 || !val2) { return; }
            } else { 
                document.getElementById("filterDate2").style.display = "none"; 
            }
            
            if (!val1) return applyFilterClear();
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„ÙÙ„ØªØ±Ø©
            if (type === "year") {
                // ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ù†Ø© ÙÙ‚Ø·
                val1 = val1; // Ø§Ù„Ø³Ù†Ø© ÙƒÙ…Ø§ Ù‡ÙŠ
                val2 = val2;
            } else {
                // ÙÙ„ØªØ±Ø© Ø¨Ø§Ù„Ø´Ù‡ÙˆØ± - ØªØ­ÙˆÙŠÙ„ Ù…Ù† YYYY-MM Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                // input type="month" ÙŠØ¹Ø·ÙŠ Ù‚ÙŠÙ…Ø© Ø¨ØµÙŠØºØ© "2025-11"
            }
            
            const oldDisplay = {};
            document.querySelectorAll("#tbody tr").forEach(tr => { oldDisplay[tr.dataset.date] = tr.style.display; });
            
            document.querySelectorAll("#tbody tr").forEach(tr => {
                const date = tr.dataset.date; // Ø¨ØµÙŠØºØ© "YYYY-MM"
                const year = date.split("-")[0];
                const target = type === "year" ? year : date;
                let show = true;
                
                if (condition === "gte" && val1) {
                    show = target >= val1;
                } else if (condition === "lte" && val1) {
                    show = target <= val1;
                } else if (condition === "between" && val1 && val2) {
                    show = target >= val1 && target <= val2;
                }
                
                tr.style.display = show ? "" : "none";
            });
            
            pushUndo("ÙÙ„ØªØ±Ø©", () => {
                document.querySelectorAll("#tbody tr").forEach(tr => { tr.style.display = oldDisplay[tr.dataset.date] || ""; });
                applyAutoFillAmounts(); updateTotals();
            });
            applyAutoFillAmounts(); updateTotals();
        }

        function applyFilterClear() {
            const oldDisplay = {};
            document.querySelectorAll("#tbody tr").forEach(tr => { oldDisplay[tr.dataset.date] = tr.style.display; tr.style.display = ""; });
            pushUndo("Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙÙ„ØªØ±Ø©", () => {
                document.querySelectorAll("#tbody tr").forEach(tr => { tr.style.display = oldDisplay[tr.dataset.date]; });
                applyAutoFillAmounts(); updateTotals();
            });
            document.getElementById("filterDate1").value = "";
            document.getElementById("filterDate2").value = "";
            document.getElementById("filterDate2").style.display = "none";
            applyAutoFillAmounts(); updateTotals();
        }

        function wireRowEvents() {
            document.querySelectorAll("#tbody tr").forEach((tr, idx) => {
                const sub = tr.querySelector(".sub");
                let oldValue = sub.value;
                const commitChange = () => {
                    if (sub.value !== oldValue) {
                        const prev = oldValue;
                        pushUndo(`ØªØ¹Ø¯ÙŠÙ„ ${tr.dataset.date}`, () => {
                            sub.value = prev;
                            applyAutoFillAmounts(); updateTotals(); debouncedSave();
                        });
                        oldValue = sub.value;
                        applyAutoFillAmounts(); updateTotals(); debouncedSave();
                    }
                };
                sub.addEventListener("input", () => { lastEnteredValue = sub.value; });
                sub.addEventListener("keydown", e => {
                    if (e.key === "Enter") { e.preventDefault(); commitChange(); const next = tr.nextElementSibling; if (next && next.style.display !== "none") next.querySelector(".sub").focus(); }
                    if (e.key === "ArrowUp" || e.key === "ArrowDown") { e.preventDefault(); const dir = e.key === "ArrowUp" ? -1 : 1; let next = tr; while ((next = next[dir === 1 ? "nextElementSibling" : "previousElementSibling"]) && next.style.display === "none"); if (next) next.querySelector(".sub").focus(); }
                });
                sub.addEventListener("blur", commitChange);
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹Ø§Øª Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³Ø¯Ø¯Ø© ÙˆØ§Ù„Ø³Ø¯Ø§Ø¯ Ø¨Ø¹Ø¯ 15)
                const payment = tr.querySelector(".payment");
                const after16 = tr.querySelector(".after16");
                
                payment.addEventListener("input", () => {
                    applyAutoFillAmounts(); updateTotals(); debouncedSave();
                });
                
                after16.addEventListener("change", () => {
                    applyAutoFillAmounts(); updateTotals(); debouncedSave();
                });
            });
        }

        function repeatValueDown() {
            if (!lastEnteredValue) return;
            const subs = Array.from(document.querySelectorAll(".sub")).filter(s => s.closest("tr").style.display !== "none");
            let currentIndex = subs.indexOf(document.activeElement);
            if (currentIndex === -1) currentIndex = subs.findIndex(s => s.value);
            if (currentIndex === -1) return;
            for (let i = currentIndex + 1; i < subs.length; i++) {
                if (!subs[i].value || subs[i].value === "") {
                    const oldVal = subs[i].value;
                    subs[i].value = lastEnteredValue;
                    pushUndo("ØªÙƒØ±Ø§Ø± Ø§Ù„Ù‚ÙŠÙ…Ø©", () => {
                        subs[i].value = oldVal;
                        applyAutoFillAmounts(); updateTotals(); debouncedSave();
                    });
                    applyAutoFillAmounts(); updateTotals(); debouncedSave();
                    subs[i].focus();
                    return;
                }
            }
        }

        async function toggleLock() {
            if (isLocked) {
                const p = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙØªØ­:");
                if (!p) return;
                if (await verifyPassword(p)) {
                    isLocked = false;
                    document.querySelectorAll(".rate").forEach(i => i.readOnly = false);
                    document.querySelector("#toggleLockBtn span").textContent = "Ù‚ÙÙ„ Ø§Ù„ÙÙˆØ§Ø¦Ø¯";
                    document.getElementById("bulkRateInsertBtn").style.display = "block";
                    showToast("ØªÙ… ÙØªØ­ Ø§Ù„ÙÙˆØ§Ø¦Ø¯");
                    pushUndo("ÙØªØ­ Ø§Ù„ÙÙˆØ§Ø¦Ø¯", () => { isLocked = true; document.querySelectorAll(".rate").forEach(i => i.readOnly = true); document.querySelector("#toggleLockBtn span").textContent = "ÙØªØ­ Ø§Ù„ÙÙˆØ§Ø¦Ø¯"; document.getElementById("bulkRateInsertBtn").style.display = "none"; });
                } else showToast("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©");
            } else {
                isLocked = true;
                document.querySelectorAll(".rate").forEach(i => i.readOnly = true);
                document.querySelector("#toggleLockBtn span").textContent = "ÙØªØ­ Ø§Ù„ÙÙˆØ§Ø¦Ø¯";
                document.getElementById("bulkRateInsertBtn").style.display = "none";
                showToast("ØªÙ… Ù‚ÙÙ„ Ø§Ù„ÙÙˆØ§Ø¦Ø¯");
                pushUndo("Ù‚ÙÙ„ Ø§Ù„ÙÙˆØ§Ø¦Ø¯", () => { isLocked = false; document.querySelectorAll(".rate").forEach(i => i.readOnly = false); document.querySelector("#toggleLockBtn span").textContent = "Ù‚ÙÙ„ Ø§Ù„ÙÙˆØ§Ø¦Ø¯"; document.getElementById("bulkRateInsertBtn").style.display = "block"; });
            }
        }

        function lockRates() {
            isLocked = true;
            document.querySelectorAll(".rate").forEach(i => i.readOnly = true);
            const span = document.querySelector("#toggleLockBtn span");
            if (span) span.textContent = "ÙØªØ­ Ø§Ù„ÙÙˆØ§Ø¦Ø¯";
            document.getElementById("bulkRateInsertBtn").style.display = "none";
        }

        async function changePassword() {
            const old = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©:");
            if (!old || !(await verifyPassword(old))) { showToast("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø®Ø§Ø·Ø¦Ø©"); return; }
            const p1 = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            const p2 = prompt("Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            if (p1 && p1 === p2) {
                const oldHash = PASSWORD_HASH;
                PASSWORD_HASH = await hashPassword(p1);
                localStorage.setItem(PASS_KEY, PASSWORD_HASH);
                showToast("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
                pushUndo("ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", () => { PASSWORD_HASH = oldHash; localStorage.setItem(PASS_KEY, oldHash); });
            } else if (p1 !== p2) showToast("ÙƒÙ„Ù…ØªØ§ Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ØªÙŠÙ†");
        }

        function exportPDF() {
            if (typeof html2pdf === 'undefined') { 
                showToast("âš ï¸ Ù…ÙƒØªØ¨Ø© PDF ØºÙŠØ± Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ Ø¢Ø®Ø±.", "error"); 
                console.error("html2pdf library not loaded. Check your internet connection or firewall settings.");
                return; 
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±
            applyAutoFillAmounts();
            updateTotals();
            
            pushUndo("ØªØµØ¯ÙŠØ± PDF", () => { });
            const printContent = document.querySelector('.print-content');
            const printTable = printContent.querySelector('#printTable tbody');
            printTable.innerHTML = '';
            printContent.style.display = 'block';
            document.querySelectorAll('#tbody tr').forEach(tr => {
                if (tr.style.display !== 'none') {
                    const cloned = tr.cloneNode(true);
                    cloned.querySelectorAll('input').forEach(input => {
                        const span = document.createElement('span');
                        
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø®Ø§ØµØ© Ù„Ù€ checkbox
                        if (input.type === 'checkbox') {
                            span.textContent = input.checked ? 'âœ“' : 'âœ—';
                            span.style.fontSize = '18px';
                            span.style.color = input.checked ? '#16a34a' : '#dc2626';
                        } else {
                            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†ØµÙŠØ© ÙˆØ§Ù„Ø±Ù‚Ù…ÙŠØ©
                            span.textContent = input.value || 'â€”';
                            span.style.color = '#1f2937';
                        }
                        
                        span.style.fontWeight = 'bold';
                        input.parentNode.replaceChild(span, input);
                    });
                    printTable.appendChild(cloned);
                }
            });
            const prevSubs = document.getElementById("prevSubs").textContent;
            const prevInterest = document.getElementById("prevInterest").textContent;
            const currSubs = document.getElementById("currSubs").textContent;
            const currInterest = document.getElementById("currInterest").textContent;
            const totalInterest = document.getElementById("totalInterest").textContent;
            const finalTotal = document.getElementById("finalTotal").textContent;
            const totalPayments = document.getElementById("totalPayments").textContent;
            const creditBalance = document.getElementById("creditBalance").textContent || '0.00';
            const periodStartDate = document.getElementById("periodStartDate").textContent;
            const periodEndDate = document.getElementById("periodEndDate").textContent;
            
            let summaryHTML = `
    <div style="padding: 10px; background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; text-align: center; margin-bottom: 12px; color: #065f46; font-weight: bold; font-size: 14px;">
      ğŸ“Š ÙØªØ±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: Ù…Ù† ${periodStartDate} Ø¥Ù„Ù‰ ${periodEndDate}
    </div>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin-bottom: 15px;">
      <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #fefce8; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©: <span style="color: #7c2d12; font-size: 14px;">${prevSubs}</span></div>
      <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #fefce8; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©: <span style="color: #7c2d12; font-size: 14px;">${prevInterest}</span></div>
      <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #e0f2fe; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span style="color: #1e40af; font-size: 14px;">${currSubs}</span></div>
      <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #e0f2fe; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span style="color: #1e40af; font-size: 14px;">${currInterest}</span></div>
      <div style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; background: #fef3c7; font-weight: bold;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª: <span style="color: #92400e; font-size: 14px;">${totalPayments}</span></div>`;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø§Ø¦Ù† Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            if (parseFloat(creditBalance) > 0) {
                summaryHTML += `
      <div style="padding: 8px; border: 1px solid #bbf7d0; border-radius: 6px; background: #d1fae5; font-weight: bold;">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¯Ø§Ø¦Ù†: <span style="color: #065f46; font-size: 14px;">${creditBalance}</span></div>`;
            }
            
            summaryHTML += `
      <div style="grid-column: 1 / -1; padding: 10px; border: 1px solid #bbf7d0; border-radius: 6px; background: #dcfce7; font-weight: bold; text-align: center; color: #b91c1c;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§Ø¦Ø¯: <span style="color: #1e293b; font-size: 15px;">${totalInterest}</span> | Ø§Ù„ØªØ³ÙˆÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span style="color: #1e293b; font-size: 15px;">${finalTotal}</span></div>
    </div>`;
            document.getElementById('printSummary').innerHTML = summaryHTML;
            showToast("Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ PDF...");
            const opt = { 
                margin: 1, 
                filename: 'taswiyat_report.pdf', 
                image: { type: 'jpeg', quality: 0.98 }, 
                html2canvas: { 
                    scale: 2, 
                    useCORS: false,  // ØªØ¹Ø·ÙŠÙ„ CORS Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§ØªØµØ§Ù„
                    allowTaint: true, // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©
                    logging: false    // ØªØ¹Ø·ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                }, 
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } 
            };
            html2pdf().set(opt).from(printContent).save()
                .then(() => { 
                    showToast("ØªÙ… Ø­ÙØ¸ PDF Ø¨Ù†Ø¬Ø§Ø­"); 
                    printContent.style.display = 'none'; 
                })
                .catch((error) => {
                    console.error("PDF Export Error:", error);
                    showToast("âš ï¸ ÙØ´Ù„ ØªØµØ¯ÙŠØ± PDF. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ù…ØªØµÙØ­ Ø¢Ø®Ø±.", "error");
                    printContent.style.display = 'none';
                });
        }

        function exportJSON() {
            pushUndo("ØªØµØ¯ÙŠØ± JSON", () => { });
            const data = loadStorage();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a"); a.href = url; a.download = "taswiyat_data.json"; a.click();
            URL.revokeObjectURL(url);
        }

        function importJSON() {
            const input = document.createElement("input"); input.type = "file"; input.accept = ".json";
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = evt => {
                    try {
                        const oldData = loadStorage();
                        const imported = JSON.parse(evt.target.result);
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(imported));
                        buildRows(); showToast("ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                        pushUndo("Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON", () => { localStorage.setItem(STORAGE_KEY, JSON.stringify(oldData)); buildRows(); });
                    } catch { showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù"); }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // === Calculation Logic ===
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª - ØªØ·Ø¨Ù‚ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª (Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØŒ Ø§Ù„Ø¹Ø§Ù…ØŒ Ø§Ù„Ø®Ø§Øµ) Ø¨Ø¹Ø¯ 1/1/2020
        const DISCOUNTS = {
            gov: [
                { id: 'gov_sickness_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 4.00, type: 'sickness' },
                { id: 'gov_injury_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 1.00, type: 'injury' },
                { id: 'gov_sickness_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 0.25, type: 'sickness' },
                { id: 'gov_injury_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 0.25, type: 'injury' }
            ],
            public: [
                { id: 'public_sickness_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 4.00, type: 'sickness' },
                { id: 'public_injury_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 1.00, type: 'injury' },
                { id: 'public_sickness_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 0.25, type: 'sickness' },
                { id: 'public_injury_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 0.25, type: 'injury' }
            ],
            private: [
                { id: 'private_sickness_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 4.00, type: 'sickness' },
                { id: 'private_injury_medical', name: 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø¹Ù„Ø§Ø¬ ÙˆØ§Ù„Ø±Ø¹Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ© Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 1.00, type: 'injury' },
                { id: 'private_sickness_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶', rate: 0.25, type: 'sickness' },
                { id: 'private_injury_compensation', name: 'ØªØ®ÙÙŠØ¶ ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„', rate: 0.25, type: 'injury' }
            ]
        };

        const RATES = {
            pre2020: {
                gov: { 
                    basic: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 2, employee: 3 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 1, employee: 0 } }, 
                    variable: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 1, employee: 0 } } 
                },
                public: { 
                    basic: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 2, employee: 3 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 2, employee: 0 }, injury: { employer: 2, employee: 0 } }, 
                    variable: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 2, employee: 0 }, injury: { employer: 2, employee: 0 } } 
                },
                private: { 
                    basic: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 2, employee: 3 }, sickness: { employer: 4, employee: 1 }, unemployment: { employer: 2, employee: 0 }, injury: { employer: 3, employee: 0 } }, 
                    variable: { oldAge: { employer: 15, employee: 10 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 4, employee: 1 }, unemployment: { employer: 2, employee: 0 }, injury: { employer: 3, employee: 0 } } 
                },
                owner: { 
                    unified: { oldAge: { employer: 0, employee: 15 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } },
                    basic: { oldAge: { employer: 0, employee: 15 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }, 
                    variable: { oldAge: { employer: 0, employee: 0 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } } 
                },
                expat: { 
                    unified: { oldAge: { employer: 0, employee: 22.5 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } },
                    basic: { oldAge: { employer: 0, employee: 22.5 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }, 
                    variable: { oldAge: { employer: 0, employee: 0 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } } 
                },
                irregular: { 
                    unified: { oldAge: { employer: 0, employee: 9 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }
                }
            },
            post2020: {
                gov: { 
                    unified: { oldAge: { employer: 12, employee: 9 }, reward: { employer: 1, employee: 1 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 1.25, employee: 0 } }
                },
                public: { 
                    unified: { oldAge: { employer: 12, employee: 9 }, reward: { employer: 1, employee: 1 }, sickness: { employer: 3, employee: 1 }, unemployment: { employer: 1, employee: 0 }, injury: { employer: 1.25, employee: 0 } }
                },
                private: { 
                    unified: { oldAge: { employer: 12, employee: 9 }, reward: { employer: 1, employee: 1 }, sickness: { employer: 3.25, employee: 1 }, unemployment: { employer: 1, employee: 0 }, injury: { employer: 1.5, employee: 0 } }
                },
                owner: { 
                    unified: { oldAge: { employer: 21, employee: 0 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 4, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }
                },
                expat: { 
                    unified: { oldAge: { employer: 21, employee: 0 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }
                },
                irregular: { 
                    unified: { oldAge: { employer: 0, employee: 9 }, reward: { employer: 0, employee: 0 }, sickness: { employer: 0, employee: 0 }, unemployment: { employer: 0, employee: 0 }, injury: { employer: 0, employee: 0 } }
                }
            }
        };

        function calculateRowAmount(row) {
            const start = row.querySelector(".bulk-start").value;
            const wage = parseFloat(row.querySelector(".bulk-wage").value) || 0;
            const sector = row.querySelector(".bulk-sector").value;
            const wageType = row.querySelector(".bulk-wage-type").value;

            // Ù…Ù†Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø³Ø§Ù„Ø¨Ø©
            if (wage < 0) {
                row.querySelector(".bulk-wage").value = 0;
                row.querySelector(".bulk-amount").value = "";
                return;
            }

            if (!start || wage <= 0) { row.querySelector(".bulk-amount").value = ""; return; }

            const year = parseInt(start.split("-")[0]);
            const isPre2020 = year < 2020;
            const periodRates = isPre2020 ? RATES.pre2020 : RATES.post2020;
            
            // Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø®Ø§ØµØ© (owner, expat, irregular) ØªØ³ØªØ®Ø¯Ù… unified Ø¯Ø§Ø¦Ù…Ø§Ù‹
            const specialSectors = ['owner', 'expat', 'irregular'];
            const rates = specialSectors.includes(sector) ? periodRates[sector]['unified'] : 
                         (isPre2020 ? (periodRates[sector][wageType] || periodRates[sector]['basic']) : periodRates[sector]['unified']);

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            let discountRates = { sickness: 0, injury: 0 };
            if (row.dataset.discountRates) {
                try {
                    discountRates = JSON.parse(row.dataset.discountRates);
                } catch (e) {}
            }

            let totalRate = 0;
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø·
            const rowCheckboxes = row.querySelectorAll('.row-ins-type');
            const checkedTypes = {
                oldAge: false,
                reward: false,
                sickness: false,
                unemployment: false,
                injury: false
            };

            rowCheckboxes.forEach(cb => {
                if (cb.checked) {
                    checkedTypes[cb.value] = true;
                }
            });

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø· Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª
            Object.keys(checkedTypes).forEach(type => {
                if (checkedTypes[type] && rates[type]) {
                    let typeRate = (rates[type].employer || 0) + (rates[type].employee || 0);
                    
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    if (discountRates[type] && discountRates[type] > 0) {
                        typeRate = Math.max(0, typeRate - discountRates[type]);
                    }
                    
                    totalRate += typeRate;
                }
            });

            const amount = (wage * totalRate / 100).toFixed(2);
            row.querySelector(".bulk-amount").value = amount;
        }

        function updateRatesDisplay() {
            // ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø£Ù† ÙƒÙ„ ØµÙ Ù„Ù‡ checkboxes Ø®Ø§ØµØ© Ø¨Ù‡
            // Ù„Ù… ØªØ¹Ø¯ Ù‡Ù†Ø§Ùƒ Ø­Ø§Ø¬Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø³Ø¨ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…
        }

        function openBulkModal() {
            const container = document.getElementById("bulkRows");
            container.innerHTML = "";
            addBulkRow();
            document.getElementById("bulkModal").style.display = "flex";
        }

        function addBulkRow() {
            const container = document.getElementById("bulkRows");
            
            // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·
            if (container.children.length === 0) {
                const tableWrapper = document.createElement("div");
                tableWrapper.className = "bulk-table-wrapper";
                tableWrapper.style.cssText = "background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 15px;";
                
                const header = document.createElement("div");
                header.className = "bulk-table-header";
                header.style.cssText = "display: grid; grid-template-columns: 1.2fr 1.2fr 1fr 0.9fr 1fr 1fr 80px 60px; gap: 8px; padding: 14px 12px; background: linear-gradient(135deg, #1e3a8a, #3b82f6); color: white; font-weight: bold; font-size: 13px; text-align: center; border-bottom: 2px solid #1e40af;";
                header.innerHTML = `
                    <div style="text-align: right;">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
                    <div style="text-align: right;">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
                    <div style="text-align: center;">ÙØ¦Ø© Ø§Ù„ØªØ£Ù…ÙŠÙ†</div>
                    <div style="text-align: center;">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±</div>
                    <div style="text-align: center;">Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
                    <div style="text-align: center;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</div>
                    <div style="text-align: center;">Ø§Ù„Ù†Ø³Ø¨</div>
                    <div style="text-align: center;">Ø­Ø°Ù</div>
                `;
                
                const tbody = document.createElement("div");
                tbody.className = "bulk-table-body";
                tbody.style.cssText = "background: #f8fafc;";
                tbody.id = "bulkTableBody";
                
                tableWrapper.appendChild(header);
                tableWrapper.appendChild(tbody);
                container.appendChild(tableWrapper);
            }
            
            const tbody = document.getElementById("bulkTableBody");
            const row = document.createElement("div");
            row.className = "bulk-row";
            row.style.cssText = "display: grid; grid-template-columns: 1.2fr 1.2fr 1fr 0.9fr 1fr 1fr 80px 60px; gap: 8px; padding: 10px 12px; background: white; border-bottom: 1px solid #e2e8f0; align-items: center; transition: all 0.2s;";
            
            row.innerHTML = `
                <input type="month" class="bulk-start" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; text-align: right;">
                <input type="month" class="bulk-end" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; text-align: right;">
                <select class="bulk-sector" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; background: white;">
                    <option value="gov">Ø­ÙƒÙˆÙ…ÙŠ</option>
                    <option value="public">Ø¹Ø§Ù…</option>
                    <option value="private">Ø®Ø§Øµ</option>
                    <option value="owner">ØµØ§Ø­Ø¨ Ø¹Ù…Ù„</option>
                    <option value="expat">Ø¹Ø§Ù…Ù„ Ø¨Ø§Ù„Ø®Ø§Ø±Ø¬</option>
                    <option value="irregular">Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©</option>
                </select>
                <select class="bulk-wage-type" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; background: white;" title="Ø£Ø³Ø§Ø³ÙŠ Ø£Ùˆ Ù…ØªØºÙŠØ± (Ù‚Ø¨Ù„ 2020 ÙÙ‚Ø·)">
                    <option value="basic">Ø£Ø³Ø§Ø³ÙŠ</option>
                    <option value="variable">Ù…ØªØºÙŠØ±</option>
                </select>
                <input type="number" step="0.01" min="0" class="bulk-wage" style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; text-align: center;">
                <input type="number" step="0.01" min="0" class="bulk-amount" readonly style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px; font-weight: bold; background: #f1f5f9; color: #1e40af; text-align: center;">
                <button class="show-rates-btn" type="button" style="width: 100%; padding: 8px; background: linear-gradient(135deg, #8b5cf6, #6366f1); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 4px; transition: all 0.2s;">
                    <i class="fas fa-table"></i>
                </button>
                <button class="remove-row" style="width: 100%; padding: 8px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.2s;">Ã—</button>
                <div class="bulk-row-checkboxes" style="display: none;">
                    <input type="checkbox" class="row-ins-type" value="oldAge" checked>
                    <input type="checkbox" class="row-ins-type" value="reward" checked>
                    <input type="checkbox" class="row-ins-type" value="sickness">
                    <input type="checkbox" class="row-ins-type" value="unemployment" checked>
                    <input type="checkbox" class="row-ins-type" value="injury" checked>
                </div>
            `;
            
            row.addEventListener('mouseenter', function() {
                this.style.background = '#f0f9ff';
            });
            row.addEventListener('mouseleave', function() {
                this.style.background = 'white';
            });
            
            tbody.appendChild(row);
            
            const startInput = row.querySelector(".bulk-start");
            const endInput = row.querySelector(".bulk-end");
            const sectorSelect = row.querySelector(".bulk-sector");
            const wageTypeSelect = row.querySelector(".bulk-wage-type");
            const rowCheckboxes = row.querySelectorAll(".row-ins-type");
            const sicknessCheckbox = row.querySelector(".row-ins-type[value='sickness']");
            
            const toggleWageType = () => {
                const sector = sectorSelect.value;
                const specialSectors = ['owner', 'expat', 'irregular'];
                
                // Ø¶Ø¨Ø· ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ¦Ø©
                if (sicknessCheckbox) {
                    if (sector === 'owner') {
                        // Ù„ÙØ¦Ø© Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„: ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶ ØºÙŠØ± Ù…Ø­Ø¯Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                        sicknessCheckbox.checked = false;
                    } else {
                        // Ù„Ù„ÙØ¦Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰: ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶ Ù…Ø­Ø¯Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                        sicknessCheckbox.checked = true;
                    }
                }
                
                // Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± "Ù…ÙˆØ­Ø¯" Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                if (!wageTypeSelect.querySelector('option[value="unified"]')) {
                    const unifiedOption = document.createElement('option');
                    unifiedOption.value = 'unified';
                    unifiedOption.textContent = 'Ù…ÙˆØ­Ø¯';
                    wageTypeSelect.appendChild(unifiedOption);
                }
                
                // ØªØ¹Ø·ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø± Ù„Ù„ÙØ¦Ø§Øª Ø§Ù„Ø®Ø§ØµØ© (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø®ÙØ§Ø¦Ù‡)
                if (specialSectors.includes(sector)) {
                    wageTypeSelect.disabled = true;
                    wageTypeSelect.style.opacity = "0.5";
                    wageTypeSelect.style.cursor = "not-allowed";
                    wageTypeSelect.style.background = "#f1f5f9";
                    wageTypeSelect.value = "unified";
                    return;
                }
                
                // ØªØ¹Ø·ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø± Ù„Ù„Ø³Ù†ÙˆØ§Øª Ù…Ù† 2020 ÙˆÙ…Ø§ Ø¨Ø¹Ø¯ (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø®ÙØ§Ø¦Ù‡)
                const startVal = startInput.value;
                if (startVal) {
                    const year = parseInt(startVal.split("-")[0]);
                    if (year >= 2020) {
                        wageTypeSelect.disabled = true;
                        wageTypeSelect.style.opacity = "0.5";
                        wageTypeSelect.style.cursor = "not-allowed";
                        wageTypeSelect.style.background = "#f1f5f9";
                        wageTypeSelect.value = "unified";
                    } else {
                        wageTypeSelect.disabled = false;
                        wageTypeSelect.style.opacity = "1";
                        wageTypeSelect.style.cursor = "pointer";
                        wageTypeSelect.style.background = "white";
                        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ø£Ø³Ø§Ø³ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ­Ø¯
                        if (wageTypeSelect.value === "unified") {
                            wageTypeSelect.value = "basic";
                        }
                    }
                }
            };

            const inputs = row.querySelectorAll("input, select");
            inputs.forEach(inp => {
                inp.addEventListener("input", () => { 
                    calculateRowAmount(row); 
                    if (inp === startInput || inp === sectorSelect) toggleWageType();
                });
                inp.addEventListener("change", () => { 
                    calculateRowAmount(row); 
                });
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ù€ checkboxes Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„ØµÙ
            rowCheckboxes.forEach(cb => {
                cb.addEventListener("change", () => {
                    calculateRowAmount(row);
                });
            });
            
            const removeBtn = row.querySelector(".remove-row");
            removeBtn.onclick = () => { 
                row.remove();
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªØ¨Ù‚ ØµÙÙˆÙ
                const tbody = document.getElementById("bulkTableBody");
                if (tbody && tbody.children.length === 0) {
                    const tableWrapper = container.querySelector('.bulk-table-wrapper');
                    if (tableWrapper) tableWrapper.remove();
                }
            };
            removeBtn.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 4px 12px rgba(220, 38, 38, 0.4)';
            });
            removeBtn.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = 'none';
            });
            
            const ratesBtn = row.querySelector(".show-rates-btn");
            ratesBtn.onclick = () => {
                showRatesDetail(row);
            };
            ratesBtn.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 4px 12px rgba(139, 92, 246, 0.4)';
            });
            ratesBtn.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = 'none';
            });
            
            toggleWageType();
        }

        function fillBulk() {
            const oldValues = {};
            document.querySelectorAll("#tbody tr").forEach(tr => { oldValues[tr.dataset.date] = parseFloat(tr.querySelector(".sub").value) || 0; });
            const rows = document.querySelectorAll("#bulkRows .bulk-row");
            let valid = true;
            let errorMsg = "";

            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ
            const rowsData = [];
            for (let row of rows) {
                const start = row.querySelector(".bulk-start").value;
                const end = row.querySelector(".bulk-end").value;
                const wage = parseFloat(row.querySelector(".bulk-wage").value);
                const amount = parseFloat(row.querySelector(".bulk-amount").value) || 0;
                const sector = row.querySelector(".bulk-sector").value;
                const wageType = row.querySelector(".bulk-wage-type").value;
                
                // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (!start || !end) { 
                    showConflictWarning("<strong style='font-size: 18px; color: #dc2626;'>âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!</strong><br><br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.<br><br>ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©."); 
                    return; 
                }
                
                // âœ… Ø¶Ø§Ø¨Ø· 3: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ±Ùƒ Ù‚ÙŠÙ…Ø© Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙØ§Ø±ØºØ©
                if (isNaN(wage) || wage === null || wage === undefined) {
                    showConflictWarning("<strong style='font-size: 18px; color: #dc2626;'>âŒ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø·Ù„ÙˆØ¨!</strong><br><br>Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ±Ùƒ Ø­Ù‚Ù„ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙØ§Ø±ØºØ§Ù‹.<br><br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ.");
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…ÙˆØ¬Ø¨
                if (wage < 0) {
                    showConflictWarning(`<strong style='font-size: 18px; color: #dc2626;'>âŒ Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©!</strong><br><br>Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø³Ø§Ù„Ø¨Ø§Ù‹!<br><br>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©: <strong>${wage}</strong><br><br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ù…ÙˆØ¬Ø¨Ø©.`);
                    return;
                }
                
                if (amount <= 0) { 
                    showConflictWarning("Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±.<br><br>ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø£Ùˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± <strong>Ø§Ù„Ù†Ø³Ø¨</strong> Ù„ØªØ­Ø¯ÙŠØ¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª."); 
                    return; 
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„ÙŠØ³ Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                if (start > end) { 
                    showConflictWarning(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©!<br><br>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: <strong>${start}</strong><br>Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: <strong>${end}</strong><br><br>ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®.`); 
                    return; 
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¯Ø¯ Ù‚Ø¨Ù„ 2020 ØªÙ†ØªÙ‡ÙŠ Ù‚Ø¨Ù„ 2020
                const startYear = parseInt(start.split("-")[0]);
                const endYear = parseInt(end.split("-")[0]);
                if (startYear < 2020 && end >= "2020-01") { 
                    showConflictWarning("Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ù‚Ø¨Ù„ ÙŠÙ†Ø§ÙŠØ± 2020 ÙŠØ¬Ø¨ Ø£Ù† ØªÙ†ØªÙ‡ÙŠ Ù‚Ø¨Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®.<br><br>Ø§Ù„Ø³Ø¨Ø¨: Ø§Ø®ØªÙ„Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ 2020.<br><br>ÙŠØ±Ø¬Ù‰ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø¯Ø© Ø¥Ù„Ù‰ ÙØªØ±ØªÙŠÙ† Ù…Ù†ÙØµÙ„ØªÙŠÙ†:<br>â€¢ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ØªÙ†ØªÙ‡ÙŠ ÙÙŠ 2019-12<br>â€¢ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ØªØ¨Ø¯Ø£ Ù…Ù† 2020-01"); 
                    return; 
                }
                
                rowsData.push({ start, end, amount, sector, wageType, isPre2020: startYear < 2020 });
            }

            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø¨Ù„ Ø¹Ø±Ø¶Ù‡Ø§
            const errors = [];
            
            // âœ… Ø¶Ø§Ø¨Ø· 1: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„ØµÙÙˆÙ ÙƒÙ…Ø§ Ø£Ø¯Ø®Ù„Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            for (let i = 0; i < rowsData.length - 1; i++) {
                const current = rowsData[i];
                const next = rowsData[i + 1];
                
                const currentEndParts = current.end.split('-');
                const currentEndYear = parseInt(currentEndParts[0]);
                const currentEndMonth = parseInt(currentEndParts[1]);
                
                let expectedNextMonth = currentEndMonth + 1;
                let expectedNextYear = currentEndYear;
                if (expectedNextMonth > 12) {
                    expectedNextMonth = 1;
                    expectedNextYear++;
                }
                
                const expectedNextStart = `${expectedNextYear}-${String(expectedNextMonth).padStart(2, '0')}`;
                
                if (next.start < expectedNextStart) {
                    // Ø§Ø³ØªØ«Ù†Ø§Ø¡ 1: Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù…Ø³Ù…ÙˆØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© ÙˆÙ†ÙˆØ¹ Ø£Ø¬Ø± Ù…Ø®ØªÙ„Ù Ù‚Ø¨Ù„ 2020
                    const isSamePeriod = current.start === next.start && current.end === next.end;
                    const isSameSector = current.sector === next.sector;
                    const isDifferentWageType = current.wageType !== next.wageType;
                    const isBothPre2020 = current.isPre2020 && next.isPre2020;
                    
                    const isAllowedDuplicate = isSamePeriod && isSameSector && isDifferentWageType && isBothPre2020;
                    
                    // Ø§Ø³ØªØ«Ù†Ø§Ø¡ 2: Ø§Ù„Ù…ØªØºÙŠØ± ÙƒØ¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ù‚Ø¨Ù„ 2020)
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ù„ÙŠ Ù…ØªØºÙŠØ± ÙˆØ§Ù„ØµÙ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£Ø³Ø§Ø³ÙŠ (Ø£Ùˆ Ø§Ù„Ø¹ÙƒØ³)
                    const isBasicAndVariable = (current.wageType === 'basic' && next.wageType === 'variable') ||
                                              (current.wageType === 'variable' && next.wageType === 'basic');
                    const nextIsWithinCurrent = next.start >= current.start && next.end <= current.end;
                    
                    const isVariablePartOfBasic = isSameSector && isDifferentWageType && isBothPre2020 && 
                                                 isBasicAndVariable && nextIsWithinCurrent;
                    
                    if (!isAllowedDuplicate && !isVariablePartOfBasic) {
                        errors.push({
                            type: 'ØªØ±ØªÙŠØ¨ Ø²Ù…Ù†ÙŠ',
                            message: `<strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ (Ø§Ù„ØµÙ ${i + 1} â†’ ${i + 2}):</strong><br>
                                Ø§Ù„ØµÙ ${i + 1}: ${current.start} â†’ ${current.end} (${getSectorName(current.sector)} - ${current.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'})<br>
                                Ø§Ù„ØµÙ ${i + 2}: ${next.start} â†’ ${next.end} (${getSectorName(next.sector)} - ${next.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'})<br>
                                <strong style="color: #dc2626;">Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¨Ø¯Ø£ Ø§Ù„ØµÙ ${i + 2} ÙÙŠ <strong>${expectedNextStart}</strong> Ø£Ùˆ Ø¨Ø¹Ø¯Ù‡.`
                        });
                    }
                }
            }
            
            // âœ… Ø¶Ø§Ø¨Ø· 2 Ùˆ 4 Ùˆ 5: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¶Ø§Ø±Ø¨ ÙˆØ§Ù„ØªÙƒØ±Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„ÙØªØ±Ø§Øª
            // Ø¬Ù…Ø¹ ÙƒÙ„ Ø§Ù„ÙØªØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø© Ù„Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© Ù‚Ø¨Ù„ 2020 Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªØºÙŠØ±
            const basicPeriodsBySector = {}; // { sector: [{start, end, ...}] }
            
            for (let i = 0; i < rowsData.length; i++) {
                const r = rowsData[i];
                if (r.isPre2020 && r.wageType === 'basic') {
                    if (!basicPeriodsBySector[r.sector]) {
                        basicPeriodsBySector[r.sector] = [];
                    }
                    basicPeriodsBySector[r.sector].push(r);
                }
            }
            
            for (let i = 0; i < rowsData.length; i++) {
                for (let j = i + 1; j < rowsData.length; j++) {
                    const r1 = rowsData[i];
                    const r2 = rowsData[j];
                    
                    const hasOverlap = !(r1.end < r2.start || r2.end < r1.start);
                    
                    if (hasOverlap) {
                        // âœ… Ø¶Ø§Ø¨Ø· 2: ÙØ¦Ø§Øª Ù…Ø®ØªÙ„ÙØ©
                        if (r1.sector !== r2.sector) {
                            errors.push({
                                type: 'ØªØ¶Ø§Ø±Ø¨ ÙØ¦Ø§Øª',
                                message: `<strong>âŒ ØªØ¶Ø§Ø±Ø¨ ÙÙŠ ÙØ¦Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</strong><br>
                                    Ø§Ù„ÙØªØ±Ø©: ${r1.start} â†’ ${r1.end}<br>
                                    â€¢ ${getSectorName(r1.sector)} (${r1.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'})<br>
                                    â€¢ ${getSectorName(r2.sector)} (${r2.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'})<br>
                                    <strong style="color: #dc2626;">Ø§Ù„Ø³Ø¨Ø¨:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ÙØ¦ØªÙŠÙ† Ù…Ø®ØªÙ„ÙØªÙŠÙ† ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø©.`
                            });
                        }
                        // âœ… Ø¶Ø§Ø¨Ø· 5: Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© ÙˆÙ†ÙØ³ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±
                        else if (r1.wageType === r2.wageType) {
                            errors.push({
                                type: 'ØªÙƒØ±Ø§Ø±',
                                message: `<strong>âŒ ØªÙƒØ±Ø§Ø± ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­:</strong><br>
                                    Ø§Ù„ÙØªØ±Ø©: ${r1.start} â†’ ${r1.end}<br>
                                    Ø§Ù„ÙØ¦Ø©: ${getSectorName(r1.sector)}<br>
                                    Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±: ${r1.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'}<br>
                                    <strong style="color: #dc2626;">Ø§Ù„Ø³Ø¨Ø¨:</strong> Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù…Ø¯Ø®Ù„Ø© Ù…Ø±ØªÙŠÙ† Ø¨Ù†ÙØ³ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.`
                            });
                        }
                        // âœ… Ø¶Ø§Ø¨Ø· 4: Ø£Ø³Ø§Ø³ÙŠ + Ù…ØªØºÙŠØ±
                        else {
                            // Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© ÙˆÙ†ÙˆØ¹ Ø£Ø¬Ø± Ù…Ø®ØªÙ„Ù (Ø£Ø³Ø§Ø³ÙŠ + Ù…ØªØºÙŠØ±)
                            
                            // Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙØªØ±Ø§Øª Ù‚Ø¨Ù„ 2020
                            if (!r1.isPre2020 || !r2.isPre2020) {
                                errors.push({
                                    type: 'Ù†ÙˆØ¹ Ø£Ø¬Ø±',
                                    message: `<strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±:</strong><br>
                                        Ø§Ù„ÙØªØ±Ø©: ${r1.start} â†’ ${r1.end}<br>
                                        Ø§Ù„ÙØ¦Ø©: ${getSectorName(r1.sector)}<br>
                                        Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¬Ø±: ${r1.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'} + ${r2.wageType === 'basic' ? 'Ø£Ø³Ø§Ø³ÙŠ' : 'Ù…ØªØºÙŠØ±'}<br>
                                        <strong style="color: #dc2626;">Ø§Ù„Ø³Ø¨Ø¨:</strong> Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ø§Ø³ÙŠ ÙˆÙ…ØªØºÙŠØ± Ù„Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù…Ø³Ù…ÙˆØ­ ÙÙ‚Ø· Ù‚Ø¨Ù„ 2020.`
                                });
                            }
                            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØªØ±Ø§Øª Ù‚Ø¨Ù„ 2020 ÙˆÙ†ÙØ³ Ø§Ù„ÙØ¦Ø© ÙˆØ£Ø¬Ø± Ù…Ø®ØªÙ„Ù = Ù…Ø³Ù…ÙˆØ­ (Ø³ÙŠØªÙ… ÙØ­Øµ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù„Ø§Ø­Ù‚Ø§Ù‹)
                        }
                    }
                }
            }
            
            // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            for (let i = 0; i < rowsData.length; i++) {
                const variableRow = rowsData[i];
                
                // ÙÙ‚Ø· Ù„Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± Ù‚Ø¨Ù„ 2020
                if (variableRow.isPre2020 && variableRow.wageType === 'variable') {
                    const sector = variableRow.sector;
                    const basicPeriods = basicPeriodsBySector[sector] || [];
                    
                    if (basicPeriods.length === 0) {
                        // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¬Ø± Ø£Ø³Ø§Ø³ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© - Ù„Ø§ Ù…Ø´ÙƒÙ„Ø©
                        continue;
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ÙØªØ±Ø© Ø§Ù„Ù…ØªØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø£Ø­Ø¯ ÙØªØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                    let isWithinBasicPeriod = false;
                    let problematicBasic = null;
                    
                    for (const basicRow of basicPeriods) {
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¯Ø§Ø®Ù„
                        const hasOverlap = !(variableRow.end < basicRow.start || basicRow.end < variableRow.start);
                        
                        if (hasOverlap) {
                            // Ù‡Ù†Ø§Ùƒ ØªØ¯Ø§Ø®Ù„ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                            const variableStartsBeforeBasic = variableRow.start < basicRow.start;
                            const variableEndsAfterBasic = variableRow.end > basicRow.end;
                            
                            if (!variableStartsBeforeBasic && !variableEndsAfterBasic) {
                                // Ø§Ù„Ù…ØªØºÙŠØ± Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ØªÙ…Ø§Ù…Ø§Ù‹
                                isWithinBasicPeriod = true;
                                break;
                            } else {
                                // Ø§Ù„Ù…ØªØºÙŠØ± ÙŠØªØ¬Ø§ÙˆØ² Ø­Ø¯ÙˆØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                                problematicBasic = {
                                    basic: basicRow,
                                    startsBefore: variableStartsBeforeBasic,
                                    endsAfter: variableEndsAfterBasic
                                };
                            }
                        }
                    }
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ¯Ø§Ø®Ù„ ÙˆÙ„ÙƒÙ† Ø§Ù„Ù…ØªØºÙŠØ± ÙŠØªØ¬Ø§ÙˆØ² Ø¬Ù…ÙŠØ¹ ÙØªØ±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
                    if (problematicBasic && !isWithinBasicPeriod) {
                        errors.push({
                            type: 'ØªØ¬Ø§ÙˆØ² Ø­Ø¯ÙˆØ¯',
                            message: `<strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ±:</strong><br>
                                Ø§Ù„ÙØ¦Ø©: ${getSectorName(sector)}<br>
                                â€¢ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ: ${problematicBasic.basic.start} â†’ ${problematicBasic.basic.end}<br>
                                â€¢ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ±: ${variableRow.start} â†’ ${variableRow.end}<br>
                                <strong style="color: #dc2626;">Ø§Ù„Ø³Ø¨Ø¨:</strong> ÙØªØ±Ø© Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ ÙØªØ±Ø© Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø£Ùˆ Ù…Ø³Ø§ÙˆÙŠØ© Ù„Ù‡Ø§).<br>
                                ${problematicBasic.startsBefore ? 'âš ï¸ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠØ¨Ø¯Ø£ Ù‚Ø¨Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (' + variableRow.start + ' < ' + problematicBasic.basic.start + ')<br>' : ''}
                                ${problematicBasic.endsAfter ? 'âš ï¸ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (' + variableRow.end + ' > ' + problematicBasic.basic.end + ')<br>' : ''}
                                ğŸ’¡ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† ÙØªØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø£Ùˆ Ù…Ø³Ø§ÙˆÙŠØ§Ù‹ Ù„Ù‡Ø§ØŒ Ù„ÙƒÙ† Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ²Ù‡Ø§.`
                        });
                    }
                }
            }
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
            if (errors.length > 0) {
                let errorHTML = `<strong style="font-size: 20px; color: #991b1b;">ğŸš« ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${errors.length} Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©:</strong><br><br>`;
                errorHTML += `<div style="text-align: right; background: #fee; padding: 15px; border-radius: 8px; border-right: 4px solid #dc2626;">`;
                
                errors.forEach((error, index) => {
                    errorHTML += `<div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 6px;">`;
                    errorHTML += `<strong style="color: #1e40af;">${index + 1}. ${error.type}:</strong><br>`;
                    errorHTML += error.message;
                    errorHTML += `</div>`;
                });
                
                errorHTML += `</div><br><br>`;
                errorHTML += `<strong style="font-size: 16px; color: #059669;">ğŸ“‹ Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„:</strong><br>`;
                errorHTML += `<div style="text-align: right; background: #f0fdf4; padding: 12px; border-radius: 6px; font-size: 14px; line-height: 1.8;">`;
                errorHTML += `âœ… <strong>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ:</strong> ÙƒÙ„ ÙØªØ±Ø© ØªÙƒÙˆÙ† Ù„Ø§Ø­Ù‚Ø© Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ø¨Ø§Ø´Ø±Ø©<br>`;
                errorHTML += `âœ… <strong>Ø¹Ø¯Ù… ØªØ¯Ø§Ø®Ù„ Ø§Ù„ÙØ¦Ø§Øª:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù„ÙØ¦ØªÙŠÙ† Ù…Ø®ØªÙ„ÙØªÙŠÙ†<br>`;
                errorHTML += `âœ… <strong>Ø§Ù„Ø£Ø¬Ø± Ù…Ø·Ù„ÙˆØ¨:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ±Ùƒ Ø­Ù‚Ù„ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙØ§Ø±ØºØ§Ù‹<br>`;
                errorHTML += `âœ… <strong>Ø¯Ù…Ø¬ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + Ø§Ù„Ù…ØªØºÙŠØ± (Ù‚Ø¨Ù„ 2020):</strong><br>`;
                errorHTML += `&nbsp;&nbsp;&nbsp;&nbsp;â€¢ Ù…Ø³Ù…ÙˆØ­ Ù„Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© (Ø³ÙŠØªÙ… Ø¬Ù…Ø¹ Ù‚ÙŠÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ)<br>`;
                errorHTML += `&nbsp;&nbsp;&nbsp;&nbsp;â€¢ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† ÙØªØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø£Ùˆ Ù…Ø³Ø§ÙˆÙŠØ§Ù‹ Ù„Ù‡Ø§<br>`;
                errorHTML += `&nbsp;&nbsp;&nbsp;&nbsp;â€¢ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…ØªØºÙŠØ± ÙŠØ¬Ø¨ Ø£Ù„Ø§ ÙŠØªØ¬Ø§ÙˆØ² Ø­Ø¯ÙˆØ¯ ÙØªØ±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ<br>`;
                errorHTML += `âœ… <strong>Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±:</strong> Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¯Ø®Ø§Ù„ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù„Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© Ø¨Ù†ÙØ³ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±`;
                errorHTML += `</div>`;
                
                showConflictWarning(errorHTML);
                return;
            }

            pushUndo("Ø¥Ø¯Ø±Ø§Ø¬ Ø¬Ù…Ø§Ø¹ÙŠ", () => {
                document.querySelectorAll("#tbody tr").forEach(tr => {
                    const current = oldValues[tr.dataset.date];
                    tr.querySelector(".sub").value = current.toFixed(2);
                });
                applyAutoFillAmounts(); updateTotals(); debouncedSave();
            });

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø¯Ù…Ø¬ Ù„Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ù…ØªØºÙŠØ±
            const monthlyData = {}; // { 'YYYY-MM': { basic: amount, variable: amount, unified: amount, detailedData: {} } }
            
            rows.forEach((row, idx) => {
                const rowData = rowsData[idx];
                const { start, end, amount } = rowData;
                let wageType = rowData.wageType;
                const sector = rowData.sector;
                const wage = parseFloat(row.querySelector(".bulk-wage").value);
                
                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                const checkedTypes = {};
                row.querySelectorAll('.row-ins-type').forEach(cb => {
                    checkedTypes[cb.value] = cb.checked;
                });
                
                // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª
                let discountRates = {};
                if (row.dataset.discountRates) {
                    try {
                        discountRates = JSON.parse(row.dataset.discountRates);
                    } catch (e) {}
                }
                
                const [startY, startM] = start.split('-').map(Number);
                const [endY, endM] = end.split('-').map(Number);
                let currentDate = new Date(startY, startM - 1, 1);
                const endDate = new Date(endY, endM - 1, 1);
                
                // Ù„Ù„ÙØªØ±Ø§Øª Ø¨Ø¹Ø¯ 2020ØŒ ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… unified Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† basic/variable
                const isPre2020 = startY < 2020;
                const specialSectors = ['owner', 'expat', 'irregular'];
                
                // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
                if (!isPre2020 || specialSectors.includes(sector)) {
                    wageType = 'unified'; // Ø¨Ø¹Ø¯ 2020 Ø£Ùˆ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø®Ø§ØµØ© = Ù…ÙˆØ­Ø¯
                }
                
                // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø© ÙÙŠ Ø­Ù‚Ù„ "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" Ù‡ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„
                // ÙŠØ¬Ø¨ ÙˆØ¶Ø¹Ù‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ ÙƒÙ„ Ø´Ù‡Ø± Ù…Ù† Ø§Ù„Ù…Ø¯Ø©
                while (currentDate <= endDate) {
                    const yyyymm = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');
                    
                    if (!monthlyData[yyyymm]) {
                        monthlyData[yyyymm] = { basic: 0, variable: 0, unified: 0, detailedData: null };
                    }
                    
                    // Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (amount Ù‡Ùˆ Ù‚ÙŠÙ…Ø© Ø´Ù‡Ø±ÙŠØ© Ù…Ø­Ø³ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ø£Ø¬Ø± ÙˆØ§Ù„Ù†Ø³Ø¨)
                    monthlyData[yyyymm][wageType] += amount;
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Ø³ÙŠØªÙ… Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙˆÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ø°Ø§ ØªÙƒØ±Ø±Øª)
                    monthlyData[yyyymm].detailedData = {
                        sector,
                        wageType,
                        wage,
                        checkedTypes,
                        discountRates
                    };
                    
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            });
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø¨Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
            Object.keys(monthlyData).forEach(yyyymm => {
                const tr = document.querySelector(`[data-date="${yyyymm}"]`);
                if (tr) {
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: Ø¬Ù…Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + Ø§Ù„Ù…ØªØºÙŠØ± + Ø§Ù„Ù…ÙˆØ­Ø¯
                    const total = monthlyData[yyyymm].basic + monthlyData[yyyymm].variable + monthlyData[yyyymm].unified;
                    tr.querySelector(".sub").value = total.toFixed(2);
                    
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙÙŠ data attribute
                    if (monthlyData[yyyymm].detailedData) {
                        tr.dataset.detailedData = JSON.stringify(monthlyData[yyyymm].detailedData);
                    }
                } else {
                    console.warn(`Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ù„Ù„Ø´Ù‡Ø±: ${yyyymm}`);
                }
            });
            
            applyAutoFillAmounts(); updateTotals(); debouncedSave();
            closeBulkModal();
            showToast("ØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ“");
        }
        
        function getSectorName(sector) {
            const names = {
                gov: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ",
                public: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ø§Ù…",
                private: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ",
                owner: "Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„",
                expat: "Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„Ø®Ø§Ø±Ø¬",
                irregular: "Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©"
            };
            return names[sector] || sector;
        }

        function openBulkRateModal() {
            const container = document.getElementById("bulkRateRows");
            container.innerHTML = "";
            // Ø¥Ø¶Ø§ÙØ© ØµÙ ÙˆØ§Ø­Ø¯ Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
            addBulkRateRow();
            document.getElementById("bulkRateModal").style.display = "flex";
        }

        function addBulkRateRow() {
            const container = document.getElementById("bulkRateRows");
            const row = document.createElement("div");
            row.className = "bulk-rate-row";
            row.innerHTML = `
    <input type="month" class="bulk-rate-start" placeholder="Ù…Ù† ØªØ§Ø±ÙŠØ®" required>
    <input type="month" class="bulk-rate-end" placeholder="Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®" required>
    <input type="number" step="0.01" min="0" class="bulk-rate-value" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© %" required>
    <button class="remove-row" title="Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ">Ã—</button>
  `;
            container.appendChild(row);
            row.querySelector(".remove-row").onclick = () => {
                if (container.children.length > 1) {
                    row.remove();
                } else {
                    showToast("ÙŠØ¬Ø¨ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨ØµÙ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
                }
            };
        }

        function fillBulkRate() {
            const oldValues = {};
            document.querySelectorAll("#tbody tr").forEach(tr => { oldValues[tr.dataset.date] = parseFloat(tr.querySelector(".rate").value) || 0; });
            const rows = document.querySelectorAll("#bulkRateRows .bulk-rate-row");
            
            if (rows.length === 0) {
                showConflictWarning("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯Ø¯ Ù…ÙØ¯Ø®Ù„Ø©!<br><br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
                return;
            }
            
            // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙÙˆÙ
            const periodsData = [];
            for (let row of rows) {
                const start = row.querySelector(".bulk-rate-start").value;
                const end = row.querySelector(".bulk-rate-end").value;
                const rate = parseFloat(row.querySelector(".bulk-rate-value").value);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (!start || !end) {
                    showConflictWarning("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø®Ù„Ø©.<br><br>ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.");
                    return;
                }
                
                if (isNaN(rate) || rate <= 0) {
                    showConflictWarning(`Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±!<br><br>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø©: <strong>${rate || 'ÙØ§Ø±ØºØ©'}</strong><br><br>ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© ÙˆÙ…ÙˆØ¬Ø¨Ø©.`);
                    return;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„ÙŠØ³ Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                if (start > end) {
                    showConflictWarning(`ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©!<br><br>Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: <strong>${start}</strong><br>Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: <strong>${end}</strong><br><br>ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®.`);
                    return;
                }
                
                periodsData.push({ start, end, rate });
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØªØ±Ø§Øª Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            periodsData.sort((a, b) => a.start.localeCompare(b.start));
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙØªØ±Ø§Øª
            for (let i = 0; i < periodsData.length - 1; i++) {
                const current = periodsData[i];
                const next = periodsData[i + 1];
                
                if (current.end >= next.start) {
                    showConflictWarning(`
                        <strong style="font-size: 18px; color: #7f1d1d;">ØªØ¯Ø§Ø®Ù„ ÙÙŠ ÙØªØ±Ø§Øª Ø§Ù„ÙØ§Ø¦Ø¯Ø©!</strong><br><br>
                        ØªÙˆØ¬Ø¯ ÙØªØ±Ø§Øª Ù…ØªØ¯Ø§Ø®Ù„Ø© ÙÙŠ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®:<br><br>
                        
                        ğŸ“‹ <strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</strong><br>
                        â€¢ Ù…Ù†: ${current.start}<br>
                        â€¢ Ø¥Ù„Ù‰: <strong style="color: #dc2626;">${current.end}</strong><br>
                        â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ${current.rate.toFixed(2)}%<br><br>
                        
                        ğŸ“‹ <strong>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©:</strong><br>
                        â€¢ Ù…Ù†: <strong style="color: #dc2626;">${next.start}</strong><br>
                        â€¢ Ø¥Ù„Ù‰: ${next.end}<br>
                        â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø©: ${next.rate.toFixed(2)}%<br><br>
                        
                        âš ï¸ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ØªÙ†ØªÙ‡ÙŠ ÙÙŠ <strong>${current.end}</strong><br>
                        Ù„ÙƒÙ† Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªØ¨Ø¯Ø£ ÙÙŠ <strong>${next.start}</strong><br><br>
                        
                        ğŸ’¡ Ø§Ù„Ø­Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† ÙƒÙ„ ÙØªØ±Ø© ØªØ¨Ø¯Ø£ <strong>Ø¨Ø¹Ø¯</strong> Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.
                    `);
                    return;
                }
            }
            
            // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹
            pushUndo("Ø¥Ø¯Ø±Ø§Ø¬ Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„ÙÙˆØ§Ø¦Ø¯", () => {
                document.querySelectorAll("#tbody tr").forEach(tr => {
                    const current = oldValues[tr.dataset.date];
                    tr.querySelector(".rate").value = current.toFixed(2);
                });
                applyAutoFillAmounts(); updateTotals(); debouncedSave();
            });
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            periodsData.forEach(period => {
                const [startY, startM] = period.start.split('-').map(Number);
                const [endY, endM] = period.end.split('-').map(Number);
                let currentDate = new Date(startY, startM - 1, 1);
                const endDate = new Date(endY, endM - 1, 1);
                
                while (currentDate <= endDate) {
                    const yyyymm = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');
                    const tr = document.querySelector(`[data-date="${yyyymm}"]`);
                    if (tr) tr.querySelector(".rate").value = period.rate.toFixed(2);
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
            });
            
            applyAutoFillAmounts(); updateTotals(); debouncedSave();
            closeBulkRateModal();
            showToast("ØªÙ… ØªØ¹Ø¨Ø¦Ø© Ù†Ø³Ø¨ Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ“");
        }

        function closeBulkModal() { document.getElementById("bulkModal").style.display = "none"; }
        function closeBulkRateModal() { document.getElementById("bulkRateModal").style.display = "none"; }
        function closeRatesDetailModal() { document.getElementById("ratesDetailModal").style.display = "none"; }

        function showRatesDetail(row) {
            const start = row.querySelector(".bulk-start").value;
            const sector = row.querySelector(".bulk-sector").value;
            const wageType = row.querySelector(".bulk-wage-type").value;
            
            if (!start) {
                showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹");
                return;
            }

            const year = parseInt(start.split("-")[0]);
            const isPre2020 = year < 2020;
            const periodRates = isPre2020 ? RATES.pre2020 : RATES.post2020;
            
            // Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø®Ø§ØµØ© (owner, expat, irregular) ØªØ³ØªØ®Ø¯Ù… unified Ø¯Ø§Ø¦Ù…Ø§Ù‹
            const specialSectors = ['owner', 'expat', 'irregular'];
            const rates = specialSectors.includes(sector) ? periodRates[sector]['unified'] : 
                         (isPre2020 ? (periodRates[sector][wageType] || periodRates[sector]['basic']) : periodRates[sector]['unified']);

            const sectorNames = {
                gov: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ",
                public: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ø§Ù…",
                private: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ",
                owner: "Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„",
                expat: "Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„Ø®Ø§Ø±Ø¬",
                irregular: "Ø§Ù„Ø¹Ù…Ø§Ù„Ø© Ø§Ù„ØºÙŠØ± Ù…Ù†ØªØ¸Ù…Ø©"
            };

            const wageTypeNames = {
                basic: "Ø£Ø³Ø§Ø³ÙŠ",
                variable: "Ù…ØªØºÙŠØ±"
            };

            const typeLabels = {
                oldAge: "ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø´ÙŠØ®ÙˆØ®Ø© ÙˆØ§Ù„Ø¹Ø¬Ø² ÙˆØ§Ù„ÙˆÙØ§Ø©",
                reward: "ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©",
                sickness: "ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶",
                unemployment: "ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù„Ø©",
                injury: "ØªØ£Ù…ÙŠÙ† Ø¥ØµØ§Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„"
            };

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ
            const selectedTypes = {};
            row.querySelectorAll('.row-ins-type').forEach(cb => {
                // Ù„ÙØ¦Ø© Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ØŒ ØªØ£Ù…ÙŠÙ† Ø§Ù„Ù…Ø±Ø¶ ÙŠÙƒÙˆÙ† ØºÙŠØ± Ù…Ø­Ø¯Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
                if (sector === 'owner' && cb.value === 'sickness') {
                    selectedTypes[cb.value] = cb.checked; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                } else {
                    selectedTypes[cb.value] = cb.checked;
                }
            });

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ¦Ø©
            let hasEmployer = false;
            let hasEmployee = false;
            let applicableTypes = []; // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø© ÙØ¹Ù„ÙŠØ§Ù‹

            Object.keys(typeLabels).forEach(type => {
                if (rates[type]) {
                    const employer = rates[type].employer || 0;
                    const employee = rates[type].employee || 0;
                    const total = employer + employee;
                    
                    // ÙÙ‚Ø· Ø£Ø¶Ù Ø§Ù„Ù†ÙˆØ¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù‡ Ù†Ø³Ø¨Ø© ÙØ¹Ù„ÙŠØ© (Ù…Ø¤Ø«Ø±)
                    if (total > 0) {
                        applicableTypes.push(type);
                        if (employer > 0) hasEmployer = true;
                        if (employee > 0) hasEmployee = true;
                    }
                }
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØ®ÙÙŠØ¶Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© (ÙÙ‚Ø· Ø¨Ø¹Ø¯ 2020 ÙˆØ§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø«Ø©)
            const hasDiscounts = !isPre2020 && ['gov', 'public', 'private'].includes(sector);
            const sectorDiscounts = hasDiscounts ? DISCOUNTS[sector] : [];

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„ØµÙ (Ø¥Ù† ÙˆØ¬Ø¯Øª)
            const selectedDiscounts = {};
            if (row.dataset.discounts) {
                try {
                    const savedDiscounts = JSON.parse(row.dataset.discounts);
                    savedDiscounts.forEach(id => { selectedDiscounts[id] = true; });
                } catch (e) {}
            }

            let html = `
                <div class="rates-info-box">
                    <p><strong>Ø§Ù„ÙØ¦Ø©:</strong> ${sectorNames[sector]}</p>
                    ${isPre2020 ? `<p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø£Ø¬Ø±:</strong> ${wageTypeNames[wageType]}</p>` : ''}
                    <p><strong>Ø§Ù„ÙØªØ±Ø©:</strong> ${isPre2020 ? 'Ù‚Ø¨Ù„ 1/1/2020' : 'Ø§Ø¹ØªØ¨Ø§Ø±Ø§Ù‹ Ù…Ù† 1/1/2020'}</p>
                </div>
            `;

            // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª (ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØ¦Ø© Ù…Ø³ØªÙ‡Ø¯ÙØ©)
            if (hasDiscounts && sectorDiscounts.length > 0) {
                html += `
                <div class="discounts-section">
                    <div class="discounts-title">
                        <i class="fas fa-percent"></i>
                        <span>Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</span>
                    </div>
                    <table class="discounts-table">
                        <thead>
                            <tr>
                                <th style="width: 60px;">ØªØ·Ø¨ÙŠÙ‚</th>
                                <th>Ù†ÙˆØ¹ Ø§Ù„ØªØ®ÙÙŠØ¶</th>
                                <th style="width: 100px;">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ®ÙÙŠØ¶</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                sectorDiscounts.forEach(discount => {
                    // Ø¥Ø®ÙØ§Ø¡ ØªØ®ÙÙŠØ¶Ø§Øª ØªØ¹ÙˆÙŠØ¶ Ø§Ù„Ø£Ø¬Ø± ÙˆÙ…ØµØ§Ø±ÙŠÙ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ ÙˆØ§Ù„Ø¹Ø§Ù… ÙÙ‚Ø·
                    const hideForGovPublic = (sector === 'gov' || sector === 'public') && 
                                            (discount.id === 'gov_sickness_compensation' || 
                                             discount.id === 'gov_injury_compensation' ||
                                             discount.id === 'public_sickness_compensation' ||
                                             discount.id === 'public_injury_compensation');
                    
                    if (!hideForGovPublic) {
                        const isChecked = selectedDiscounts[discount.id] || false;
                        html += `
                            <tr>
                                <td>
                                    <input type="checkbox" class="discount-checkbox" 
                                           value="${discount.id}" 
                                           data-rate="${discount.rate}" 
                                           data-type="${discount.type}"
                                           ${isChecked ? 'checked' : ''}>
                                </td>
                                <td class="discount-name">${discount.name}</td>
                                <td class="discount-rate">${discount.rate.toFixed(2)}%</td>
                            </tr>
                        `;
                    }
                });

                html += `
                        </tbody>
                    </table>
                </div>
                `;
            }

            html += `
                <table class="rates-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">ØªØ­Ø¯ÙŠØ¯</th>
                            <th>Ù†ÙˆØ¹ Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                            ${hasEmployer ? '<th>Ù†Ø³Ø¨Ø© ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„</th>' : ''}
                            ${hasEmployee ? '<th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ù„</th>' : ''}
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            let totalEmployer = 0;
            let totalEmployee = 0;
            let totalSelected = 0;

            // Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©
            let totalDiscounts = { sickness: 0, injury: 0 };
            if (hasDiscounts) {
                sectorDiscounts.forEach(discount => {
                    if (selectedDiscounts[discount.id]) {
                        totalDiscounts[discount.type] += discount.rate;
                    }
                });
            }

            applicableTypes.forEach(type => {
                let employer = rates[type].employer || 0;
                let employee = rates[type].employee || 0;
                let originalTotal = employer + employee;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶ Ù…ÙˆØ²Ø¹Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ø³Ø¨Ø©
                let discountApplied = 0;
                let employerAfterDiscount = employer;
                let employeeAfterDiscount = employee;
                let totalAfterDiscount = originalTotal;
                
                if (totalDiscounts[type] && totalDiscounts[type] > 0 && originalTotal > 0) {
                    discountApplied = totalDiscounts[type];
                    totalAfterDiscount = Math.max(0, originalTotal - discountApplied);
                    
                    // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªØ®ÙÙŠØ¶ Ø¨Ù†ÙØ³ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£ØµÙ„ÙŠØ©
                    const employerRatio = employer / originalTotal;
                    const employeeRatio = employee / originalTotal;
                    
                    employerAfterDiscount = employer - (discountApplied * employerRatio);
                    employeeAfterDiscount = employee - (discountApplied * employeeRatio);
                    
                    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ø³Ø§Ù„Ø¨
                    employerAfterDiscount = Math.max(0, employerAfterDiscount);
                    employeeAfterDiscount = Math.max(0, employeeAfterDiscount);
                }
                
                const isSelected = selectedTypes[type];
                
                if (isSelected) {
                    totalEmployer += employerAfterDiscount;
                    totalEmployee += employeeAfterDiscount;
                    totalSelected += totalAfterDiscount;
                }

                html += `
                    <tr class="${isSelected ? 'rate-selected' : ''}" data-type="${type}">
                        <td style="text-align: center;">
                            <input type="checkbox" class="modal-ins-type" value="${type}" ${isSelected ? 'checked' : ''}>
                        </td>
                        <td class="type-name">
                            ${typeLabels[type]}
                            ${discountApplied > 0 ? `<br><small style="color:#dc2626;">(ØªØ®ÙÙŠØ¶: ${discountApplied.toFixed(2)}%)</small>` : ''}
                        </td>
                        ${hasEmployer ? `<td class="rate-value" style="${discountApplied > 0 ? 'color:#dc2626;' : ''}">
                            ${employerAfterDiscount.toFixed(2)}%
                            ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${employer.toFixed(2)}%)</small>` : ''}
                        </td>` : ''}
                        ${hasEmployee ? `<td class="rate-value" style="${discountApplied > 0 ? 'color:#dc2626;' : ''}">
                            ${employeeAfterDiscount.toFixed(2)}%
                            ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${employee.toFixed(2)}%)</small>` : ''}
                        </td>` : ''}
                        <td class="rate-value" style="${discountApplied > 0 ? 'color:#dc2626; font-weight:bold;' : ''}">
                            ${totalAfterDiscount.toFixed(2)}%
                            ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${originalTotal.toFixed(2)}%)</small>` : ''}
                        </td>
                    </tr>
                `;
            });

            html += `
                        <tr class="total-row">
                            <td>â€”</td>
                            <td class="type-name">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯</td>
                            ${hasEmployer ? `<td class="rate-value" id="totalEmployer">${totalEmployer.toFixed(2)}%</td>` : ''}
                            ${hasEmployee ? `<td class="rate-value" id="totalEmployee">${totalEmployee.toFixed(2)}%</td>` : ''}
                            <td class="rate-value" id="totalSelected">${totalSelected.toFixed(2)}%</td>
                        </tr>
                    </tbody>
                </table>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="apply-rates-btn" style="background: linear-gradient(135deg, #22c55e, #16a34a); color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3); transition: all 0.3s;">
                        <i class="fas fa-check"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
                    </button>
                </div>
            `;

            document.getElementById("ratesDetailBody").innerHTML = html;
            
            // Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„Ù€ checkboxes
            const modal = document.getElementById("ratesDetailModal");
            modal.querySelectorAll('.modal-ins-type').forEach(cb => {
                cb.addEventListener('change', function() {
                    updateModalTotals(modal, rates, totalDiscounts);
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ row checkbox
                    const rowCheckbox = row.querySelector(`.row-ins-type[value="${this.value}"]`);
                    if (rowCheckbox) {
                        rowCheckbox.checked = this.checked;
                    }
                });
            });

            // Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ù„ØªØ®ÙÙŠØ¶Ø§Øª
            modal.querySelectorAll('.discount-checkbox').forEach(cb => {
                cb.addEventListener('change', function() {
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª
                    const newDiscounts = { sickness: 0, injury: 0 };
                    modal.querySelectorAll('.discount-checkbox:checked').forEach(dcb => {
                        const type = dcb.dataset.type;
                        const rate = parseFloat(dcb.dataset.rate);
                        newDiscounts[type] += rate;
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« totalDiscounts
                    Object.keys(newDiscounts).forEach(key => {
                        totalDiscounts[key] = newDiscounts[key];
                    });
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                    updateRatesTableWithDiscounts(modal, rates, totalDiscounts, hasEmployer, hasEmployee, typeLabels, applicableTypes);
                    updateModalTotals(modal, rates, totalDiscounts);
                });
            });

            // Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            modal.querySelector('.apply-rates-btn').addEventListener('click', function() {
                // Ù†Ø³Ø® Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù…Ù† Modal Ø¥Ù„Ù‰ Row
                modal.querySelectorAll('.modal-ins-type').forEach(cb => {
                    const rowCheckbox = row.querySelector(`.row-ins-type[value="${cb.value}"]`);
                    if (rowCheckbox) {
                        rowCheckbox.checked = cb.checked;
                    }
                });
                
                // Ø­ÙØ¸ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙ
                const selectedDiscountIds = [];
                modal.querySelectorAll('.discount-checkbox:checked').forEach(cb => {
                    selectedDiscountIds.push(cb.value);
                });
                row.dataset.discounts = JSON.stringify(selectedDiscountIds);
                
                // Ø­ÙØ¸ Ù‚ÙŠÙ… Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨
                row.dataset.discountRates = JSON.stringify(totalDiscounts);
                
                calculateRowAmount(row);
                closeRatesDetailModal();
                showToast("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­ âœ“");
            });

            modal.style.display = "flex";
        }

        function updateRatesTableWithDiscounts(modal, rates, discounts, hasEmployer, hasEmployee, typeLabels, applicableTypes) {
            // ØªØ­Ø¯ÙŠØ« ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ®ÙÙŠØ¶Ø§Øª
            applicableTypes.forEach(type => {
                const tr = modal.querySelector(`tr[data-type="${type}"]`);
                if (!tr) return;
                
                let employer = rates[type].employer || 0;
                let employee = rates[type].employee || 0;
                const originalTotal = employer + employee;
                
                let discountApplied = 0;
                let employerAfterDiscount = employer;
                let employeeAfterDiscount = employee;
                let totalAfterDiscount = originalTotal;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶
                if (discounts && discounts[type] && discounts[type] > 0 && originalTotal > 0) {
                    discountApplied = discounts[type];
                    totalAfterDiscount = Math.max(0, originalTotal - discountApplied);
                    
                    const employerRatio = employer / originalTotal;
                    const employeeRatio = employee / originalTotal;
                    
                    employerAfterDiscount = Math.max(0, employer - (discountApplied * employerRatio));
                    employeeAfterDiscount = Math.max(0, employee - (discountApplied * employeeRatio));
                }
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø®Ù„Ø§ÙŠØ§
                const cells = tr.querySelectorAll('td');
                let cellIndex = 2; // Ø¨Ø¹Ø¯ checkbox Ùˆ type-name
                
                if (hasEmployer) {
                    cells[cellIndex].innerHTML = `
                        ${employerAfterDiscount.toFixed(2)}%
                        ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${employer.toFixed(2)}%)</small>` : ''}
                    `;
                    cells[cellIndex].style.color = discountApplied > 0 ? '#dc2626' : '';
                    cellIndex++;
                }
                
                if (hasEmployee) {
                    cells[cellIndex].innerHTML = `
                        ${employeeAfterDiscount.toFixed(2)}%
                        ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${employee.toFixed(2)}%)</small>` : ''}
                    `;
                    cells[cellIndex].style.color = discountApplied > 0 ? '#dc2626' : '';
                    cellIndex++;
                }
                
                // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                cells[cellIndex].innerHTML = `
                    ${totalAfterDiscount.toFixed(2)}%
                    ${discountApplied > 0 ? `<br><small style="color:#6b7280;">(${originalTotal.toFixed(2)}%)</small>` : ''}
                `;
                cells[cellIndex].style.color = discountApplied > 0 ? '#dc2626' : '';
                cells[cellIndex].style.fontWeight = discountApplied > 0 ? 'bold' : '';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„ØªØ£Ù…ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ®ÙÙŠØ¶
                const typeNameCell = tr.querySelector('.type-name');
                if (typeNameCell) {
                    typeNameCell.innerHTML = `
                        ${typeLabels[type]}
                        ${discountApplied > 0 ? `<br><small style="color:#dc2626;">(ØªØ®ÙÙŠØ¶: ${discountApplied.toFixed(2)}%)</small>` : ''}
                    `;
                }
            });
        }

        function updateModalTotals(modal, rates, discounts) {
            let totalEmployer = 0;
            let totalEmployee = 0;
            let totalSelected = 0;

            modal.querySelectorAll('.modal-ins-type').forEach(cb => {
                const tr = cb.closest('tr');
                const type = cb.value;
                
                if (cb.checked && rates[type]) {
                    let employer = rates[type].employer || 0;
                    let employee = rates[type].employee || 0;
                    const originalTotal = employer + employee;
                    let typeTotal = originalTotal;
                    
                    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®ÙÙŠØ¶ Ù…ÙˆØ²Ø¹Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø§Ù…Ù„ ÙˆØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„
                    if (discounts && discounts[type] && discounts[type] > 0 && originalTotal > 0) {
                        const discountAmount = discounts[type];
                        typeTotal = Math.max(0, originalTotal - discountAmount);
                        
                        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„ØªØ®ÙÙŠØ¶ Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ø³Ø¨Ø©
                        const employerRatio = employer / originalTotal;
                        const employeeRatio = employee / originalTotal;
                        
                        employer = Math.max(0, employer - (discountAmount * employerRatio));
                        employee = Math.max(0, employee - (discountAmount * employeeRatio));
                    }
                    
                    totalEmployer += employer;
                    totalEmployee += employee;
                    totalSelected += typeTotal;
                    tr.classList.add('rate-selected');
                } else {
                    tr.classList.remove('rate-selected');
                }
            });

            const totalEmployerEl = modal.querySelector('#totalEmployer');
            const totalEmployeeEl = modal.querySelector('#totalEmployee');
            const totalSelectedEl = modal.querySelector('#totalSelected');
            
            if (totalEmployerEl) totalEmployerEl.textContent = totalEmployer.toFixed(2) + '%';
            if (totalEmployeeEl) totalEmployeeEl.textContent = totalEmployee.toFixed(2) + '%';
            if (totalSelectedEl) totalSelectedEl.textContent = totalSelected.toFixed(2) + '%';
        }

        function showConflictWarning(message) {
            const overlay = document.createElement('div');
            overlay.className = 'conflict-overlay';
            
            const warning = document.createElement('div');
            warning.className = 'conflict-warning';
            warning.innerHTML = `
                <div style="padding: 30px 40px 20px; overflow-y: auto; flex: 1;">
                    <div class="conflict-warning-icon">âš ï¸</div>
                    <div class="conflict-warning-title">ØªØ­Ø°ÙŠØ±: ØªØ¶Ø§Ø±Ø¨ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
                    <div class="conflict-warning-message">${message}</div>
                </div>
                <button class="conflict-warning-btn">ÙÙ‡Ù…ØªØŒ Ø³Ø£Ù‚ÙˆÙ… Ø¨Ø§Ù„ØªØµØ­ÙŠØ­</button>
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(warning);
            
            const closeWarning = () => {
                overlay.remove();
                warning.remove();
            };
            
            warning.querySelector('.conflict-warning-btn').onclick = closeWarning;
            overlay.onclick = closeWarning;
        }

        function showToast(msg) {
            const t = document.getElementById("toast");
            t.textContent = msg;
            t.style.display = "block";
            t.style.opacity = "1";
            setTimeout(() => t.style.opacity = "0", 1800);
            setTimeout(() => t.style.display = "none", 2100);
        }

        function enableDragAndDrop() {
            const menu = document.getElementById("dropdownMenu");
            let dragged = null;
            menu.addEventListener("dragstart", e => { if (e.target.tagName === "BUTTON") { dragged = e.target; e.target.classList.add("dragging"); } });
            menu.addEventListener("dragend", e => { if (e.target.tagName === "BUTTON") { e.target.classList.remove("dragging"); debouncedSave(); } });
            menu.addEventListener("dragover", e => e.preventDefault());
            menu.addEventListener("drop", e => {
                e.preventDefault();
                if (dragged && e.target.tagName === "BUTTON" && dragged !== e.target) {
                    const allButtons = Array.from(menu.querySelectorAll("button"));
                    const fromIndex = allButtons.indexOf(dragged);
                    const toIndex = allButtons.indexOf(e.target);
                    if (fromIndex < toIndex) e.target.after(dragged); else e.target.before(dragged);
                }
            });
        }

        function restoreButtonOrder() {
            const savedOrder = JSON.parse(localStorage.getItem(ORDER_KEY) || "[]");
            if (savedOrder.length === 0) return;
            const menu = document.getElementById("dropdownMenu");
            savedOrder.forEach(id => { const btn = document.getElementById(id); if (btn) menu.appendChild(btn); });
        }

        document.addEventListener("DOMContentLoaded", async () => {
            await loadPassword();
            const savedHistory = localStorage.getItem(HISTORY_KEY);
            if (savedHistory) undoStack = JSON.parse(savedHistory);
            buildRows();
            const menuToggle = document.getElementById("menuToggle");
            const dropdownMenu = document.getElementById("dropdownMenu");
            menuToggle.onclick = () => dropdownMenu.classList.toggle("show");
            document.addEventListener("click", e => { if (!menuToggle.contains(e.target) && !dropdownMenu.contains(e.target)) dropdownMenu.classList.remove("show"); });
            document.getElementById("updateBtn").onclick = () => { applyAutoFillAmounts(); updateTotals(); debouncedSave(); showToast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"); pushUndo("ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ", buildRows); };
            document.getElementById("toggleLockBtn").onclick = toggleLock;
            document.getElementById("changePassBtn").onclick = changePassword;
            document.getElementById("clearSubsBtn").onclick = () => {
                if (confirm("ØªÙØ±ÙŠØº Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§ØªØŸ")) {
                    const oldValues = {};
                    const oldCheckboxes = {};
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹
                    document.querySelectorAll(".sub,.amount,.payment").forEach(i => oldValues[i] = i.value);
                    document.querySelectorAll(".after16").forEach(cb => oldCheckboxes[cb] = cb.checked);
                    
                    // ØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.querySelectorAll(".sub,.amount,.payment").forEach(i => i.value = "");
                    document.querySelectorAll(".after16").forEach(cb => cb.checked = false);
                    
                    pushUndo("ØªÙØ±ÙŠØº Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª", () => { 
                        Object.keys(oldValues).forEach(input => input.value = oldValues[input]);
                        Object.keys(oldCheckboxes).forEach(cb => cb.checked = oldCheckboxes[cb]);
                        applyAutoFillAmounts(); updateTotals(); debouncedSave(); 
                    });
                    applyAutoFillAmounts(); updateTotals(); debouncedSave();
                }
            };
            document.getElementById("exportPDFBtn").onclick = exportPDF;
            document.getElementById("exportJSONBtn").onclick = exportJSON;
            document.getElementById("importJSONBtn").onclick = importJSON;
            document.getElementById("bulkInsertBtn").onclick = openBulkModal;
            document.getElementById("bulkRateInsertBtn").onclick = openBulkRateModal;
            document.getElementById("addBulkRow").onclick = () => addBulkRow();
            document.getElementById("add10BulkRows").onclick = () => { for (let i = 0; i < 10; i++) addBulkRow(); };
            document.getElementById("bulkFill").onclick = fillBulk;
            document.getElementById("bulkCancel").onclick = closeBulkModal;
            document.getElementById("addBulkRateRow").onclick = addBulkRateRow;
            document.getElementById("bulkRateFill").onclick = fillBulkRate;
            document.getElementById("bulkRateCancel").onclick = closeBulkRateModal;
            document.getElementById("bulkModal").onclick = e => { if (e.target === document.getElementById("bulkModal")) closeBulkModal(); };
            document.getElementById("bulkRateModal").onclick = e => { if (e.target === document.getElementById("bulkRateModal")) closeBulkRateModal(); };
            document.getElementById("ratesDetailModal").onclick = e => { if (e.target === document.getElementById("ratesDetailModal")) closeRatesDetailModal(); };
            document.getElementById("applyFilter").onclick = applyFilter;
            document.getElementById("clearFilter").onclick = applyFilterClear;
            document.getElementById("undoBtn").onclick = undoLast;
            
            // ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            function showDistributionModal() {
                calculateDistribution();
                document.getElementById("distributionModal").style.display = "flex";
            }
            
            function closeDistributionModal() {
                document.getElementById("distributionModal").style.display = "none";
            }
            
            function calculateDistribution() {
                const distribution = {
                    oldAge: { prev: 0, curr: 0 },
                    reward: { prev: 0, curr: 0 },
                    sickness: { prev: 0, curr: 0 },
                    injury: { prev: 0, curr: 0 },
                    unemployment: { prev: 0, curr: 0 }
                };
                
                const rows = document.querySelectorAll("#tbody tr");
                rows.forEach(row => {
                    const dateCell = row.cells[0].textContent;
                    const subsInput = row.cells[1].querySelector('.sub');
                    const subsValue = parseFloat(subsInput.value) || 0;
                    
                    if (!dateCell || subsValue === 0) return;
                    
                    const [year, month] = dateCell.split("-").map(Number);
                    const fiscalYear = month >= 7 ? year : year - 1;
                    const isCurrent = fiscalYear >= new Date().getFullYear() - (new Date().getMonth() + 1 >= 7 ? 0 : 1);
                    
                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù„Ù„ØµÙ
                    const storedData = getStoredRowData(dateCell);
                    if (!storedData) return;
                    
                    const { sector, wageType, wage, checkedTypes, discountRates } = storedData;
                    const isPre2020 = year < 2020;
                    const periodRates = isPre2020 ? RATES.pre2020 : RATES.post2020;
                    
                    const specialSectors = ['owner', 'expat', 'irregular'];
                    const rates = specialSectors.includes(sector) ? periodRates[sector]['unified'] : 
                                 (isPre2020 ? (periodRates[sector][wageType] || periodRates[sector]['basic']) : periodRates[sector]['unified']);
                    
                    // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
                    let totalRate = 0;
                    Object.keys(checkedTypes).forEach(type => {
                        if (checkedTypes[type] && rates[type]) {
                            let typeRate = (rates[type].employer || 0) + (rates[type].employee || 0);
                            if (discountRates && discountRates[type] && discountRates[type] > 0) {
                                typeRate = Math.max(0, typeRate - discountRates[type]);
                            }
                            totalRate += typeRate;
                        }
                    });
                    
                    if (totalRate === 0) return;
                    
                    // ØªÙˆØ²ÙŠØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ù„Ù‰ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ù‡Ø§
                    Object.keys(checkedTypes).forEach(type => {
                        if (checkedTypes[type] && rates[type]) {
                            let typeRate = (rates[type].employer || 0) + (rates[type].employee || 0);
                            
                            if (discountRates && discountRates[type] && discountRates[type] > 0) {
                                typeRate = Math.max(0, typeRate - discountRates[type]);
                            }
                            
                            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                            const typePercentage = typeRate / totalRate;
                            const typeAmount = subsValue * typePercentage;
                            
                            if (isCurrent) {
                                distribution[type].curr += typeAmount;
                            } else {
                                distribution[type].prev += typeAmount;
                            }
                        }
                    });
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                Object.keys(distribution).forEach(type => {
                    const prev = distribution[type].prev;
                    const curr = distribution[type].curr;
                    const total = prev + curr;
                    
                    document.getElementById(`dist-${type}-prev`).textContent = prev.toFixed(2);
                    document.getElementById(`dist-${type}-curr`).textContent = curr.toFixed(2);
                    document.getElementById(`dist-${type}-total`).textContent = total.toFixed(2);
                });
                
                // Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ù…Ù† Ø§Ù„Ù…Ù„Ø®Øµ
                const prevInterest = parseFloat(document.getElementById("prevInterest").textContent) || 0;
                const currInterest = parseFloat(document.getElementById("currInterest").textContent) || 0;
                
                document.getElementById("dist-interest-prev").textContent = prevInterest.toFixed(2);
                document.getElementById("dist-interest-curr").textContent = currInterest.toFixed(2);
                document.getElementById("dist-interest-total").textContent = (prevInterest + currInterest).toFixed(2);
                
                // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                const grandPrev = Object.values(distribution).reduce((sum, type) => sum + type.prev, 0) + prevInterest;
                const grandCurr = Object.values(distribution).reduce((sum, type) => sum + type.curr, 0) + currInterest;
                
                document.getElementById("dist-grand-prev").textContent = grandPrev.toFixed(2);
                document.getElementById("dist-grand-curr").textContent = grandCurr.toFixed(2);
                document.getElementById("dist-grand-total").textContent = (grandPrev + grandCurr).toFixed(2);
            }
            
            function getStoredRowData(date) {
                const tr = document.querySelector(`[data-date="${date}"]`);
                if (!tr || !tr.dataset.detailedData) return null;
                
                try {
                    return JSON.parse(tr.dataset.detailedData);
                } catch (e) {
                    return null;
                }
            }
            
            function getSectorName(sector) {
                const names = {
                    gov: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠ",
                    public: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¹Ø§Ù…",
                    private: "Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ",
                    owner: "Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„",
                    expat: "Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ø§Ù„Ø®Ø§Ø±Ø¬",
                    irregular: "Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©"
                };
                return names[sector] || sector;
            }
            
            function exportDistributionPDF() {
                const element = document.querySelector("#distributionModal .modal-content");
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
                const buttonsContainer = element.querySelector('div[style*="display: flex"]');
                buttonsContainer.style.display = 'none';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙÙˆÙ Ø°Ø§Øª Ø§Ù„Ù‚ÙŠÙ…Ø© ØµÙØ± Ù…Ø¤Ù‚ØªØ§Ù‹
                const rows = document.querySelectorAll("#distributionTableBody tr");
                const hiddenRows = [];
                rows.forEach((row, index) => {
                    // Ù„Ø§ Ù†Ø®ÙÙŠ ØµÙ Ø§Ù„ÙÙˆØ§Ø¦Ø¯ Ø£Ùˆ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø¢Ø®Ø± ØµÙÙŠÙ†)
                    if (index < rows.length - 2) {
                        // Ù‚Ø±Ø§Ø¡Ø© Ù‚ÙŠÙ… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø«Ù„Ø§Ø«Ø©: Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                        const prevValue = parseFloat(row.cells[1].textContent) || 0;
                        const currValue = parseFloat(row.cells[2].textContent) || 0;
                        const totalValue = parseFloat(row.cells[3].textContent) || 0;
                        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØµÙ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… ØµÙØ±
                        if (prevValue === 0 && currValue === 0 && totalValue === 0) {
                            row.style.display = 'none';
                            hiddenRows.push(row);
                        }
                    }
                });
                
                const opt = {
                    margin: 10,
                    filename: 'ØªÙˆØ²ÙŠØ¹_Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: false,
                        allowTaint: true,
                        logging: false
                    },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                
                html2pdf().set(opt).from(element).save().then(() => {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„ØµÙÙˆÙ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    buttonsContainer.style.display = 'flex';
                    hiddenRows.forEach(row => {
                        row.style.display = '';
                    });
                });
            }
            
            document.getElementById("showDistributionBtn").onclick = showDistributionModal;
            document.getElementById("closeDistribution").onclick = closeDistributionModal;
            document.getElementById("exportDistributionPDF").onclick = exportDistributionPDF;

            // ======== Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ ========
            const TRANSPORT_WORKERS_KEY = "transport_workers_data_v1";
            let transportWorkersData = [];
            let isTransportTableUnlocked = false;

            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„
            const defaultTransportData = [
                {start:"01/10/1980",end:"30/06/1984",minSub:0,tabaaWage:0,tabaaValue:30,third:0,thirdValue:30,second:0,secondValue:40,first:0,firstValue:50},
                {start:"01/07/1984",end:"30/09/1992",minSub:0,tabaaWage:0,tabaaValue:35,third:0,thirdValue:35,second:0,secondValue:40,first:0,firstValue:50},
                {start:"01/10/1992",end:"30/06/1996",minSub:0,tabaaWage:0,tabaaValue:40,third:0,thirdValue:50,second:0,secondValue:65,first:0,firstValue:75},
                {start:"01/07/1996",end:"31/01/1998",minSub:0,tabaaWage:0,tabaaValue:60,third:0,thirdValue:75,second:0,secondValue:100,first:0,firstValue:120},
                {start:"01/02/1998",end:"30/06/2001",minSub:0,tabaaWage:0,tabaaValue:65,third:0,thirdValue:80,second:0,secondValue:105,first:0,firstValue:125},
                {start:"01/07/2001",end:"30/06/2002",minSub:84,tabaaWage:84,tabaaValue:8.4,third:104,thirdValue:10.4,second:124,secondValue:12.4,first:144,firstValue:14.4},
                {start:"01/07/2002",end:"30/06/2003",minSub:87.5,tabaaWage:87.5,tabaaValue:8.75,third:107.5,thirdValue:10.75,second:127.5,secondValue:12.75,first:147.5,firstValue:14.75},
                {start:"01/07/2003",end:"30/06/2004",minSub:91,tabaaWage:91,tabaaValue:9.1,third:111,thirdValue:11.1,second:131,secondValue:13.1,first:151,firstValue:15.1},
                {start:"01/07/2004",end:"30/06/2005",minSub:94.5,tabaaWage:94.5,tabaaValue:9.45,third:114.5,thirdValue:11.45,second:134.5,secondValue:13.45,first:154.5,firstValue:15.45},
                {start:"01/07/2005",end:"30/06/2006",minSub:98,tabaaWage:98,tabaaValue:9.8,third:118,thirdValue:11.8,second:138,secondValue:13.8,first:158,firstValue:15.8},
                {start:"01/07/2006",end:"30/06/2007",minSub:101.5,tabaaWage:101.5,tabaaValue:10.15,third:121.5,thirdValue:12.15,second:141.5,secondValue:14.15,first:161.5,firstValue:16.15},
                {start:"01/07/2007",end:"30/06/2008",minSub:105,tabaaWage:105,tabaaValue:10.5,third:125,thirdValue:12.5,second:145,secondValue:14.5,first:165,firstValue:16.5},
                {start:"01/07/2008",end:"30/06/2009",minSub:108.5,tabaaWage:108.5,tabaaValue:10.85,third:128.5,thirdValue:12.85,second:148.5,secondValue:14.85,first:168.5,firstValue:16.85},
                {start:"01/07/2009",end:"30/06/2010",minSub:112,tabaaWage:112,tabaaValue:11.2,third:132,thirdValue:13.2,second:152,secondValue:15.2,first:172,firstValue:17.2},
                {start:"01/07/2010",end:"30/06/2011",minSub:119,tabaaWage:119,tabaaValue:11.9,third:139,thirdValue:13.9,second:159,secondValue:15.9,first:179,firstValue:17.9},
                {start:"01/07/2011",end:"30/06/2012",minSub:122.5,tabaaWage:122.5,tabaaValue:12.25,third:142.5,thirdValue:14.25,second:162.5,secondValue:16.25,first:182.5,firstValue:18.25},
                {start:"01/07/2012",end:"30/04/2013",minSub:127.75,tabaaWage:127.75,tabaaValue:12.78,third:147.75,thirdValue:14.78,second:167.75,secondValue:16.78,first:187.75,firstValue:18.78},
                {start:"01/05/2013",end:"30/06/2014",minSub:138.25,tabaaWage:138.25,tabaaValue:13.83,third:158.25,thirdValue:15.83,second:178.25,secondValue:17.83,first:198.25,firstValue:19.83},
                {start:"01/07/2014",end:"30/06/2015",minSub:141.75,tabaaWage:141.75,tabaaValue:14.18,third:161.75,thirdValue:16.18,second:181.75,secondValue:18.18,first:201.75,firstValue:20.18},
                {start:"01/07/2015",end:"30/06/2016",minSub:160,tabaaWage:160,tabaaValue:16,third:180,thirdValue:18,second:200,secondValue:20,first:220,firstValue:22},
                {start:"01/07/2016",end:"30/06/2017",minSub:400,tabaaWage:400,tabaaValue:40,third:420,thirdValue:42,second:440,secondValue:44,first:460,firstValue:46},
                {start:"01/07/2017",end:"30/06/2018",minSub:500,tabaaWage:500,tabaaValue:50,third:520,thirdValue:52,second:540,secondValue:54,first:560,firstValue:56},
                {start:"01/07/2018",end:"30/04/2019",minSub:625,tabaaWage:625,tabaaValue:62.5,third:645,thirdValue:64.5,second:665,secondValue:66.5,first:685,firstValue:68.5},
                {start:"01/05/2019",end:"30/06/2019",minSub:625,tabaaWage:625,tabaaValue:62.5,third:645,thirdValue:64.5,second:665,secondValue:66.5,first:685,firstValue:68.5},
                {start:"01/07/2019",end:"31/12/2019",minSub:781.25,tabaaWage:781.25,tabaaValue:78.13,third:801.25,thirdValue:80.13,second:821.25,secondValue:82.13,first:841.25,firstValue:84.13},
                {start:"01/01/2020",end:"31/12/2020",minSub:1000,tabaaWage:1000,tabaaValue:100,third:1050,thirdValue:105,second:1100,secondValue:110,first:1150,firstValue:115},
                {start:"01/01/2021",end:"31/12/2021",minSub:1200,tabaaWage:1200,tabaaValue:120,third:1260,thirdValue:126,second:1320,secondValue:132,first:1380,firstValue:138},
                {start:"01/01/2022",end:"31/12/2022",minSub:1400,tabaaWage:1400,tabaaValue:140,third:1470,thirdValue:147,second:1540,secondValue:154,first:1610,firstValue:161},
                {start:"01/01/2023",end:"31/12/2023",minSub:1700,tabaaWage:1700,tabaaValue:170,third:1790,thirdValue:179,second:1870,secondValue:187,first:1960,firstValue:196},
                {start:"01/01/2024",end:"31/12/2024",minSub:2000,tabaaWage:2000,tabaaValue:200,third:2100,thirdValue:210,second:2200,secondValue:220,first:2300,firstValue:230},
                {start:"01/01/2025",end:"31/12/2025",minSub:2300,tabaaWage:2300,tabaaValue:230,third:2420,thirdValue:242,second:2530,secondValue:253,first:2650,firstValue:265},
                {start:"01/01/2026",end:"31/12/2026",minSub:2700,tabaaWage:2700,tabaaValue:270,third:2840,thirdValue:284,second:2970,secondValue:297,first:3110,firstValue:311}
            ];

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
            function loadTransportData() {
                const saved = localStorage.getItem(TRANSPORT_WORKERS_KEY);
                if (saved) {
                    try {
                        transportWorkersData = JSON.parse(saved);
                    } catch (e) {
                        transportWorkersData = [...defaultTransportData];
                    }
                } else {
                    transportWorkersData = [...defaultTransportData];
                }
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
            function saveTransportData() {
                localStorage.setItem(TRANSPORT_WORKERS_KEY, JSON.stringify(transportWorkersData));
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function renderTransportTable() {
                const tbody = document.getElementById("transportWorkersTableBody");
                tbody.innerHTML = "";
                
                transportWorkersData.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    const bgColor = index % 2 === 0 ? "#fce7f3" : "#fff1f2";
                    tr.style.background = bgColor;
                    tr.style.transition = "all 0.3s";
                    tr.addEventListener('mouseenter', function() { this.style.background = "#fbcfe8"; });
                    tr.addEventListener('mouseleave', function() { this.style.background = bgColor; });
                    
                    const cells = [
                        row.start, row.end, row.minSub,
                        row.tabaaWage, row.tabaaValue,
                        row.third, row.thirdValue,
                        row.second, row.secondValue,
                        row.first, row.firstValue
                    ];
                    
                    cells.forEach((value, cellIndex) => {
                        const td = document.createElement("td");
                        td.style.cssText = "padding: 14px; border: 1px solid #f9a8d4; text-align: center; font-size: 14px;";
                        
                        if (isTransportTableUnlocked) {
                            if (cellIndex < 2) {
                                // Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
                                const input = document.createElement("input");
                                input.type = "text";
                                input.value = value;
                                input.style.cssText = "width: 100%; padding: 8px; border: 2px solid #f472b6; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 600;";
                                input.onchange = () => {
                                    if (cellIndex === 0) row.start = input.value;
                                    else row.end = input.value;
                                    saveTransportData();
                                };
                                td.appendChild(input);
                            } else {
                                // Ø­Ù‚ÙˆÙ„ Ø±Ù‚Ù…ÙŠØ©
                                const input = document.createElement("input");
                                input.type = "number";
                                input.value = value;
                                input.step = "0.01";
                                input.style.cssText = "width: 100%; padding: 8px; border: 2px solid #f472b6; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 600;";
                                input.onchange = () => {
                                    const keys = ["minSub", "tabaaWage", "tabaaValue", "third", "thirdValue", "second", "secondValue", "first", "firstValue"];
                                    row[keys[cellIndex - 2]] = parseFloat(input.value) || 0;
                                    saveTransportData();
                                };
                                td.appendChild(input);
                            }
                        } else {
                            td.textContent = value;
                            td.style.color = "#831843";
                            td.style.fontWeight = "700";
                            td.style.fontSize = "14px";
                        }
                        
                        tr.appendChild(td);
                    });
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    if (isTransportTableUnlocked) {
                        const actionsTd = document.createElement("td");
                        actionsTd.style.cssText = "padding: 12px; border: 1px solid #e2e8f0; text-align: center;";
                        actionsTd.className = "actions-column";
                        
                        const deleteBtn = document.createElement("button");
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.style.cssText = "padding: 8px 12px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;";
                        deleteBtn.onclick = () => {
                            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
                                // Ø§Ø³ØªØ®Ø¯Ù… indexOf Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©
                                const actualIndex = transportWorkersData.indexOf(row);
                                if (actualIndex > -1) {
                                    transportWorkersData.splice(actualIndex, 1);
                                    saveTransportData();
                                    renderTransportTable();
                                }
                            }
                        };
                        
                        actionsTd.appendChild(deleteBtn);
                        tr.appendChild(actionsTd);
                    }
                    
                    tbody.appendChild(tr);
                });
            }

            // ÙØªØ­ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function openTransportModal() {
                loadTransportData();
                renderTransportTable();
                document.getElementById("transportWorkersModal").style.display = "flex";
                closeDropdown();
            }

            // Ø¥ØºÙ„Ø§Ù‚ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function closeTransportModal() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                if (isTransportTableUnlocked) {
                    saveTransportData();
                }
                document.getElementById("transportWorkersModal").style.display = "none";
                isTransportTableUnlocked = false;
                document.getElementById("unlockTransportTableBtn").style.display = "flex";
                document.getElementById("lockTransportTableBtn").style.display = "none";
                document.getElementById("addTransportRowBtn").style.display = "none";
                document.querySelectorAll(".actions-column").forEach(col => col.style.display = "none");
            }

            // ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            async function unlockTransportTable() {
                const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:");
                if (!pass) return;
                if (await verifyPassword(pass)) {
                    isTransportTableUnlocked = true;
                    document.getElementById("unlockTransportTableBtn").style.display = "none";
                    document.getElementById("lockTransportTableBtn").style.display = "flex";
                    document.getElementById("addTransportRowBtn").style.display = "flex";
                    document.querySelectorAll(".actions-column").forEach(col => col.style.display = "table-cell");
                    renderTransportTable();
                }
            }

            // Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            function lockTransportTable() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙÙ„
                saveTransportData();
                isTransportTableUnlocked = false;
                document.getElementById("unlockTransportTableBtn").style.display = "flex";
                document.getElementById("lockTransportTableBtn").style.display = "none";
                document.getElementById("addTransportRowBtn").style.display = "none";
                document.querySelectorAll(".actions-column").forEach(col => col.style.display = "none");
                renderTransportTable();
            }

            // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            function addTransportRow() {
                const newRow = {
                    start: "01/01/2027",
                    end: "31/12/2027",
                    minSub: 0,
                    tabaaWage: 0,
                    tabaaValue: 0,
                    third: 0,
                    thirdValue: 0,
                    second: 0,
                    secondValue: 0,
                    first: 0,
                    firstValue: 0
                };
                transportWorkersData.push(newRow);
                saveTransportData();
                renderTransportTable();
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById("transportWorkersBtn").onclick = openTransportModal;
            document.getElementById("closeTransportModal").onclick = closeTransportModal;
            document.getElementById("unlockTransportTableBtn").onclick = unlockTransportTable;
            document.getElementById("lockTransportTableBtn").onclick = lockTransportTable;
            document.getElementById("addTransportRowBtn").onclick = addTransportRow;

            // ======== Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª ========
            const CONTRACTORS_WORKERS_KEY = "contractors_workers_data_v1";
            let contractorsWorkersData = [];
            let isContractorsTableUnlocked = false;

            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª
            const defaultContractorsData = [
                {start:"01/07/2001",end:"30/06/2002",minSub:84,limitedWage:84,limitedValue:8.4,mediumWage:114,mediumValue:11.4,skilledWage:144,skilledValue:14.4},
                {start:"01/07/2002",end:"30/06/2003",minSub:87.5,limitedWage:87.5,limitedValue:8.75,mediumWage:117.5,mediumValue:11.75,skilledWage:147.5,skilledValue:14.75},
                {start:"01/07/2003",end:"30/06/2004",minSub:91,limitedWage:91,limitedValue:9.1,mediumWage:121,mediumValue:12.1,skilledWage:151,skilledValue:15.1},
                {start:"01/07/2004",end:"30/06/2005",minSub:94.5,limitedWage:94.5,limitedValue:9.45,mediumWage:124.5,mediumValue:12.45,skilledWage:154.5,skilledValue:15.45},
                {start:"01/07/2005",end:"30/06/2006",minSub:98,limitedWage:98,limitedValue:9.8,mediumWage:128,mediumValue:12.8,skilledWage:158,skilledValue:15.8},
                {start:"01/07/2006",end:"30/06/2007",minSub:101.5,limitedWage:101.5,limitedValue:10.15,mediumWage:131.5,mediumValue:13.15,skilledWage:161.5,skilledValue:16.15},
                {start:"01/07/2007",end:"30/06/2008",minSub:105,limitedWage:105,limitedValue:10.5,mediumWage:135,mediumValue:13.5,skilledWage:165,skilledValue:16.5},
                {start:"01/07/2008",end:"30/06/2009",minSub:108.5,limitedWage:108.5,limitedValue:10.85,mediumWage:138.5,mediumValue:13.85,skilledWage:168.5,skilledValue:16.85},
                {start:"01/07/2009",end:"30/06/2010",minSub:112,limitedWage:112,limitedValue:11.2,mediumWage:142,mediumValue:14.2,skilledWage:172,skilledValue:17.2},
                {start:"01/07/2010",end:"30/06/2011",minSub:119,limitedWage:119,limitedValue:11.9,mediumWage:149,mediumValue:14.9,skilledWage:179,skilledValue:17.9},
                {start:"01/07/2011",end:"30/06/2012",minSub:122.5,limitedWage:122.5,limitedValue:12.25,mediumWage:152.5,mediumValue:15.25,skilledWage:182.5,skilledValue:18.25},
                {start:"01/07/2012",end:"30/04/2013",minSub:127.75,limitedWage:127.75,limitedValue:12.78,mediumWage:157.75,mediumValue:15.78,skilledWage:187.75,skilledValue:18.78},
                {start:"01/05/2013",end:"30/06/2014",minSub:138.25,limitedWage:138.25,limitedValue:13.83,mediumWage:168.25,mediumValue:16.83,skilledWage:198.25,skilledValue:19.83},
                {start:"01/07/2014",end:"30/06/2015",minSub:141.75,limitedWage:141.75,limitedValue:14.18,mediumWage:171.75,mediumValue:17.18,skilledWage:201.75,skilledValue:20.18},
                {start:"01/07/2015",end:"30/06/2016",minSub:160,limitedWage:160,limitedValue:16,mediumWage:190,mediumValue:19,skilledWage:220,skilledValue:22},
                {start:"01/07/2016",end:"30/06/2017",minSub:400,limitedWage:400,limitedValue:40,mediumWage:430,mediumValue:43,skilledWage:460,skilledValue:46},
                {start:"01/07/2017",end:"30/06/2018",minSub:500,limitedWage:500,limitedValue:50,mediumWage:530,mediumValue:53,skilledWage:560,skilledValue:56},
                {start:"01/07/2018",end:"30/04/2019",minSub:625,limitedWage:625,limitedValue:62.5,mediumWage:655,mediumValue:65.5,skilledWage:685,skilledValue:68.5},
                {start:"01/05/2019",end:"30/06/2019",minSub:625,limitedWage:625,limitedValue:68.75,mediumWage:655,mediumValue:72.05,skilledWage:685,skilledValue:75.35},
                {start:"01/07/2019",end:"31/12/2019",minSub:781.25,limitedWage:781.25,limitedValue:85.94,mediumWage:811.25,mediumValue:89.24,skilledWage:841.25,skilledValue:92.54},
                {start:"01/01/2020",end:"31/12/2020",minSub:1000,limitedWage:1000,limitedValue:110,mediumWage:1050,mediumValue:115.5,skilledWage:1100,skilledValue:121},
                {start:"01/01/2021",end:"31/12/2021",minSub:1200,limitedWage:1200,limitedValue:132,mediumWage:1260,mediumValue:138.6,skilledWage:1320,skilledValue:145.2},
                {start:"01/01/2022",end:"31/12/2022",minSub:1400,limitedWage:1400,limitedValue:154,mediumWage:1470,mediumValue:161.7,skilledWage:1540,skilledValue:169.4},
                {start:"01/01/2023",end:"31/12/2023",minSub:1700,limitedWage:1700,limitedValue:187,mediumWage:1790,mediumValue:196.9,skilledWage:1870,skilledValue:205.7},
                {start:"01/01/2024",end:"31/12/2024",minSub:2000,limitedWage:2000,limitedValue:220,mediumWage:2100,mediumValue:231,skilledWage:2200,skilledValue:242},
                {start:"01/01/2025",end:"31/12/2025",minSub:2300,limitedWage:2300,limitedValue:253,mediumWage:2410,mediumValue:265.1,skilledWage:2530,skilledValue:278.3},
                {start:"01/01/2026",end:"31/12/2026",minSub:2700,limitedWage:2700,limitedValue:297,mediumWage:2840,mediumValue:312.4,skilledWage:2970,skilledValue:326.7}
            ];

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
            function loadContractorsData() {
                const saved = localStorage.getItem(CONTRACTORS_WORKERS_KEY);
                if (saved) {
                    try {
                        contractorsWorkersData = JSON.parse(saved);
                    } catch (e) {
                        contractorsWorkersData = [...defaultContractorsData];
                    }
                } else {
                    contractorsWorkersData = [...defaultContractorsData];
                }
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
            function saveContractorsData() {
                localStorage.setItem(CONTRACTORS_WORKERS_KEY, JSON.stringify(contractorsWorkersData));
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function renderContractorsTable() {
                const tbody = document.getElementById("contractorsWorkersTableBody");
                tbody.innerHTML = "";
                
                contractorsWorkersData.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    const bgColor = index % 2 === 0 ? "#f3e8ff" : "#faf5ff";
                    tr.style.background = bgColor;
                    tr.style.transition = "all 0.3s";
                    tr.addEventListener('mouseenter', function() { this.style.background = "#e9d5ff"; });
                    tr.addEventListener('mouseleave', function() { this.style.background = bgColor; });
                    
                    const cells = [
                        row.start, row.end, row.minSub,
                        row.limitedWage, row.limitedValue,
                        row.mediumWage, row.mediumValue,
                        row.skilledWage, row.skilledValue
                    ];
                    
                    cells.forEach((value, cellIndex) => {
                        const td = document.createElement("td");
                        td.style.cssText = "padding: 14px; border: 1px solid #d8b4fe; text-align: center; font-size: 14px;";
                        
                        if (isContractorsTableUnlocked) {
                            if (cellIndex < 2) {
                                // Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
                                const input = document.createElement("input");
                                input.type = "text";
                                input.value = value;
                                input.style.cssText = "width: 100%; padding: 8px; border: 2px solid #c084fc; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 600;";
                                input.onchange = () => {
                                    if (cellIndex === 0) row.start = input.value;
                                    else row.end = input.value;
                                    saveContractorsData();
                                };
                                td.appendChild(input);
                            } else {
                                // Ø­Ù‚ÙˆÙ„ Ø±Ù‚Ù…ÙŠØ©
                                const input = document.createElement("input");
                                input.type = "number";
                                input.value = value;
                                input.step = "0.01";
                                input.style.cssText = "width: 100%; padding: 8px; border: 2px solid #c084fc; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 600;";
                                input.onchange = () => {
                                    const keys = ["minSub", "limitedWage", "limitedValue", "mediumWage", "mediumValue", "skilledWage", "skilledValue"];
                                    row[keys[cellIndex - 2]] = parseFloat(input.value) || 0;
                                    saveContractorsData();
                                };
                                td.appendChild(input);
                            }
                        } else {
                            td.textContent = value;
                            td.style.color = "#581c87";
                            td.style.fontWeight = "700";
                            td.style.fontSize = "14px";
                        }
                        
                        tr.appendChild(td);
                    });
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    if (isContractorsTableUnlocked) {
                        const actionsTd = document.createElement("td");
                        actionsTd.style.cssText = "padding: 12px; border: 1px solid #e2e8f0; text-align: center;";
                        actionsTd.className = "contractors-actions-column";
                        
                        const deleteBtn = document.createElement("button");
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.style.cssText = "padding: 8px 12px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;";
                        deleteBtn.onclick = () => {
                            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
                                // Ø§Ø³ØªØ®Ø¯Ù… indexOf Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©
                                const actualIndex = contractorsWorkersData.indexOf(row);
                                if (actualIndex > -1) {
                                    contractorsWorkersData.splice(actualIndex, 1);
                                    saveContractorsData();
                                    renderContractorsTable();
                                }
                            }
                        };
                        
                        actionsTd.appendChild(deleteBtn);
                        tr.appendChild(actionsTd);
                    }
                    
                    tbody.appendChild(tr);
                });
            }

            // ÙØªØ­ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function openContractorsModal() {
                loadContractorsData();
                renderContractorsTable();
                document.getElementById("contractorsWorkersModal").style.display = "flex";
                closeDropdown();
            }

            // Ø¥ØºÙ„Ø§Ù‚ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function closeContractorsModal() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                if (isContractorsTableUnlocked) {
                    saveContractorsData();
                }
                document.getElementById("contractorsWorkersModal").style.display = "none";
                isContractorsTableUnlocked = false;
                document.getElementById("unlockContractorsTableBtn").style.display = "flex";
                document.getElementById("lockContractorsTableBtn").style.display = "none";
                document.getElementById("addContractorsRowBtn").style.display = "none";
                document.querySelectorAll(".contractors-actions-column").forEach(col => col.style.display = "none");
            }

            // ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            async function unlockContractorsTable() {
                const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:");
                if (!pass) return;
                if (await verifyPassword(pass)) {
                    isContractorsTableUnlocked = true;
                    document.getElementById("unlockContractorsTableBtn").style.display = "none";
                    document.getElementById("lockContractorsTableBtn").style.display = "flex";
                    document.getElementById("addContractorsRowBtn").style.display = "flex";
                    document.querySelectorAll(".contractors-actions-column").forEach(col => col.style.display = "table-cell");
                    renderContractorsTable();
                }
            }

            // Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            function lockContractorsTable() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙÙ„
                saveContractorsData();
                isContractorsTableUnlocked = false;
                document.getElementById("unlockContractorsTableBtn").style.display = "flex";
                document.getElementById("lockContractorsTableBtn").style.display = "none";
                document.getElementById("addContractorsRowBtn").style.display = "none";
                document.querySelectorAll(".contractors-actions-column").forEach(col => col.style.display = "none");
                renderContractorsTable();
            }

            // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            function addContractorsRow() {
                const newRow = {
                    start: "01/01/2027",
                    end: "31/12/2027",
                    minSub: 0,
                    limitedWage: 0,
                    limitedValue: 0,
                    mediumWage: 0,
                    mediumValue: 0,
                    skilledWage: 0,
                    skilledValue: 0
                };
                contractorsWorkersData.push(newRow);
                saveContractorsData();
                renderContractorsTable();
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById("contractorsWorkersBtn").onclick = openContractorsModal;
            document.getElementById("closeContractorsModal").onclick = closeContractorsModal;
            document.getElementById("unlockContractorsTableBtn").onclick = unlockContractorsTable;
            document.getElementById("lockContractorsTableBtn").onclick = lockContractorsTable;
            document.getElementById("addContractorsRowBtn").onclick = addContractorsRow;

            // ======== Ø¬Ø¯ÙˆÙ„ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø£Ø°ÙˆÙ† ÙˆØ³Ù†Ø¯Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†Ø© ========
            const treasuryYieldData = [
                {no:1, month:"2020/01/01", bondsNotes:"14.18%", bonds:"14.40%"},
                {no:2, month:"2020/02/01", bondsNotes:"13.95%", bonds:"14.00%"},
                {no:3, month:"2020/03/01", bondsNotes:"13.86%", bonds:"13.72%"},
                {no:4, month:"2020/04/01", bondsNotes:"12.75%", bonds:"12.44%"},
                {no:5, month:"2020/05/01", bondsNotes:"12.85%", bonds:"12.53%"},
                {no:6, month:"2020/06/01", bondsNotes:"13.02%", bonds:"12.70%"},
                {no:7, month:"2020/07/01", bondsNotes:"13.86%", bonds:"13.48%"},
                {no:8, month:"2020/08/01", bondsNotes:"14.06%", bonds:"13.69%"},
                {no:9, month:"2020/09/01", bondsNotes:"13.93%", bonds:"13.53%"},
                {no:10, month:"2020/10/01", bondsNotes:"13.88%", bonds:"13.40%"},
                {no:11, month:"2020/11/01", bondsNotes:"13.82%", bonds:"13.36%"},
                {no:12, month:"2020/12/01", bondsNotes:"13.40%", bonds:"12.88%"},
                {no:13, month:"2021/01/01", bondsNotes:"13.38%", bonds:"12.83%"},
                {no:14, month:"2021/02/01", bondsNotes:"13.59%", bonds:"13.08%"},
                {no:15, month:"2021/03/01", bondsNotes:"13.71%", bonds:"13.26%"},
                {no:16, month:"2021/04/01", bondsNotes:"13.82%", bonds:"13.31%"},
                {no:17, month:"2021/05/01", bondsNotes:"13.83%", bonds:"13.31%"},
                {no:18, month:"2021/06/01", bondsNotes:"13.79%", bonds:"13.27%"},
                {no:19, month:"2021/07/01", bondsNotes:"13.73%", bonds:"13.24%"},
                {no:20, month:"2021/08/01", bondsNotes:"13.62%", bonds:"13.03%"},
                {no:21, month:"2021/09/01", bondsNotes:"13.41%", bonds:"12.69%"},
                {no:22, month:"2021/10/01", bondsNotes:"13.43%", bonds:"12.70%"},
                {no:23, month:"2021/11/01", bondsNotes:"13.50%", bonds:"12.83%"},
                {no:24, month:"2021/12/01", bondsNotes:"13.40%", bonds:"12.64%"},
                {no:25, month:"2022/01/01", bondsNotes:"13.25%", bonds:"12.40%"},
                {no:26, month:"2022/02/01", bondsNotes:"13.25%", bonds:"12.40%"},
                {no:27, month:"2022/03/01", bondsNotes:"13.14%", bonds:"12.48%"},
                {no:28, month:"2022/04/01", bondsNotes:"13.38%", bonds:"13.11%"},
                {no:29, month:"2022/05/01", bondsNotes:"13.88%", bonds:"13.61%"},
                {no:30, month:"2022/06/01", bondsNotes:"14.58%", bonds:"14.61%"},
                {no:31, month:"2022/07/01", bondsNotes:"15.34%", bonds:"15.45%"},
                {no:32, month:"2022/08/01", bondsNotes:"15.96%", bonds:"16.12%"},
                {no:33, month:"2022/09/01", bondsNotes:"16.41%", bonds:"16.39%"},
                {no:34, month:"2022/10/01", bondsNotes:"16.94%", bonds:"16.93%"},
                {no:35, month:"2022/11/01", bondsNotes:"17.77%", bonds:"17.98%"},
                {no:36, month:"2022/12/01", bondsNotes:"18.45%", bonds:"18.57%"},
                {no:37, month:"2023/01/01", bondsNotes:"20.67%", bonds:"20.70%"},
                {no:38, month:"2023/02/01", bondsNotes:"21.54%", bonds:"21.65%"},
                {no:39, month:"2023/03/01", bondsNotes:"22.04%", bonds:"22.09%"},
                {no:40, month:"2023/04/01", bondsNotes:"22.63%", bonds:"22.75%"},
                {no:41, month:"2023/05/01", bondsNotes:"23.01%", bonds:"23.41%"},
                {no:42, month:"2023/06/01", bondsNotes:"23.76%", bonds:"23.76%"},
                {no:43, month:"2023/07/01", bondsNotes:"23.78%", bonds:"23.87%"},
                {no:44, month:"2023/08/01", bondsNotes:"24.46%", bonds:"24.58%"},
                {no:45, month:"2023/09/01", bondsNotes:"25.23%", bonds:"25.38%"},
                {no:46, month:"2023/10/01", bondsNotes:"25.90%", bonds:"25.90%"},
                {no:47, month:"2023/11/01", bondsNotes:"25.89%", bonds:"26.16%"},
                {no:48, month:"2023/12/01", bondsNotes:"26.37%", bonds:"26.37%"},
                {no:49, month:"2024/01/01", bondsNotes:"26.77%", bonds:"26.77%"},
                {no:50, month:"2024/02/01", bondsNotes:"27.96%", bonds:"27.96%"},
                {no:51, month:"2024/03/01", bondsNotes:"28.83%", bonds:"29.20%"},
                {no:52, month:"2024/04/01", bondsNotes:"25.72%", bonds:"25.82%"},
                {no:53, month:"2024/05/01", bondsNotes:"25.73%", bonds:"25.97%"},
                {no:54, month:"2024/06/01", bondsNotes:"25.49%", bonds:"25.90%"},
                {no:55, month:"2024/07/01", bondsNotes:"25.99%", bonds:"26.42%"},
                {no:56, month:"2024/08/01", bondsNotes:"27.14%", bonds:"27.48%"},
                {no:57, month:"2024/09/01", bondsNotes:"27.35%", bonds:"28.02%"},
                {no:58, month:"2024/10/01", bondsNotes:"27.09%", bonds:"28.15%"},
                {no:59, month:"2024/11/01", bondsNotes:"27.59%", bonds:"28.77%"},
                {no:60, month:"2024/12/01", bondsNotes:"27.82%", bonds:"29.11%"},
                {no:61, month:"2025/01/01", bondsNotes:"25.32%", bonds:"26.50%"},
                {no:62, month:"2025/02/01", bondsNotes:"25.29%", bonds:"26.77%"},
                {no:63, month:"2025/03/01", bondsNotes:"25.38%", bonds:"27.06%"},
                {no:64, month:"2025/04/01", bondsNotes:"25.01%", bonds:"26.46%"},
                {no:65, month:"2025/05/01", bondsNotes:"24.69%", bonds:"26.67%"},
                {no:66, month:"2025/06/01", bondsNotes:"25.01%", bonds:"27.02%"},
                {no:67, month:"2025/07/01", bondsNotes:"25.32%", bonds:"26.92%"},
                {no:68, month:"2025/08/01", bondsNotes:"25.67%", bonds:"27.43%"},
                {no:69, month:"2025/09/01", bondsNotes:"24.74%", bonds:"26.48%"},
                {no:70, month:"2025/10/01", bondsNotes:"24.53%", bonds:"26.25%"},
                {no:71, month:"2025/11/01", bondsNotes:"24.41%", bonds:"26.16%"}
            ];

            function renderTreasuryYieldTable() {
                const tbody = document.getElementById("treasuryYieldTableBody");
                tbody.innerHTML = "";
                
                treasuryYieldData.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    tr.style.background = index % 2 === 0 ? "#f0fdf4" : "#ffffff";
                    tr.innerHTML = `
                        <td style="padding: 12px; border: 1px solid #86efac; text-align: center; font-weight: 600; color: #166534;">${row.no}</td>
                        <td style="padding: 12px; border: 1px solid #86efac; text-align: center; font-weight: 600; color: #166534;">${row.month}</td>
                        <td style="padding: 12px; border: 1px solid #86efac; text-align: center; font-weight: 700; color: #15803d;">${row.bondsNotes}</td>
                        <td style="padding: 12px; border: 1px solid #86efac; text-align: center; font-weight: 700; color: #15803d;">${row.bonds}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            function openTreasuryYieldModal() {
                renderTreasuryYieldTable();
                document.getElementById("treasuryYieldModal").style.display = "flex";
            }

            function closeTreasuryYieldModal() {
                document.getElementById("treasuryYieldModal").style.display = "none";
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById("treasuryYieldBtn").onclick = openTreasuryYieldModal;
            document.getElementById("closeTreasuryYieldModal").onclick = closeTreasuryYieldModal;

            // ======== Ø¬Ø¯ÙˆÙ„ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø© ========
            const IRREGULAR_WORKERS_KEY = "irregular_workers_data_v1";
            let irregularWorkersData = [];
            let isIrregularTableUnlocked = false;

            // Ù…ØªØºÙŠØ±Ø§Øª Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            const WAGE_LIMITS_KEY = 'wage_limits_data_v1';
            let wageLimitsData = [];
            let isWageLimitsTableUnlocked = false;

            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            const defaultWageLimitsData = [
                {date:"01/01/2020", minWage:1000, maxWage:7000},
                {date:"01/01/2021", minWage:1200, maxWage:8100},
                {date:"01/01/2022", minWage:1400, maxWage:9400},
                {date:"01/01/2023", minWage:1700, maxWage:10900},
                {date:"01/01/2024", minWage:2000, maxWage:12600},
                {date:"01/01/2025", minWage:2300, maxWage:14500},
                {date:"01/01/2016", minWage:2700, maxWage:16700}
            ];

            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©
            const defaultIrregularData = [
                {start:"01/01/1976", end:"30/06/1980", value:0.1},
                {start:"01/07/1980", end:"30/06/1993", value:0.3},
                {start:"01/07/1993", end:"30/06/2016", value:1},
                {start:"01/07/2016", end:"30/06/2017", value:28},
                {start:"01/07/2017", end:"30/06/2018", value:35},
                {start:"01/07/2018", end:"30/06/2019", value:43.75},
                {start:"01/07/2019", end:"31/12/2019", value:54.69},
                {start:"01/01/2020", end:"31/12/2020", value:90},
                {start:"01/01/2021", end:"31/12/2021", value:108},
                {start:"01/01/2022", end:"31/12/2022", value:126},
                {start:"01/01/2023", end:"31/12/2023", value:153},
                {start:"01/01/2024", end:"31/12/2024", value:180},
                {start:"01/01/2025", end:"31/12/2025", value:207},
                {start:"01/01/2026", end:"31/12/2026", value:243}
            ];

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
            function loadIrregularData() {
                const saved = localStorage.getItem(IRREGULAR_WORKERS_KEY);
                if (saved) {
                    try {
                        irregularWorkersData = JSON.parse(saved);
                        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø£Ùˆ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„ØµØ­ÙŠØ­Ø©
                        if (irregularWorkersData.length > 0) {
                            const firstRow = irregularWorkersData[0];
                            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ… (ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ date) Ø£Ùˆ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ start/end
                            if (firstRow.date !== undefined || firstRow.start === undefined || firstRow.end === undefined) {
                                // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø£Ùˆ ØºÙŠØ± ØµØ­ÙŠØ­Ø© - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                                irregularWorkersData = JSON.parse(JSON.stringify(defaultIrregularData));
                                saveIrregularData(); // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                            }
                        }
                    } catch (e) {
                        irregularWorkersData = JSON.parse(JSON.stringify(defaultIrregularData));
                    }
                } else {
                    irregularWorkersData = JSON.parse(JSON.stringify(defaultIrregularData));
                }
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
            function saveIrregularData() {
                localStorage.setItem(IRREGULAR_WORKERS_KEY, JSON.stringify(irregularWorkersData));
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function renderIrregularTable() {
                const tbody = document.getElementById("irregularWorkersTableBody");
                tbody.innerHTML = "";
                
                irregularWorkersData.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    const bgColor = index % 2 === 0 ? "#ffedd5" : "#fff7ed";
                    tr.style.background = bgColor;
                    tr.style.transition = "all 0.3s";
                    tr.addEventListener('mouseenter', function() { this.style.background = "#fed7aa"; });
                    tr.addEventListener('mouseleave', function() { this.style.background = bgColor; });
                    
                    // Ø¹Ù…ÙˆØ¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                    const startTd = document.createElement("td");
                    startTd.style.cssText = "padding: 16px; border: 1px solid #fdba74; text-align: center; font-size: 15px;";
                    
                    if (isIrregularTableUnlocked) {
                        const input = document.createElement("input");
                        input.type = "text";
                        input.value = row.start;
                        input.style.cssText = "width: 100%; padding: 10px; border: 2px solid #fb923c; border-radius: 8px; text-align: center; font-size: 14px; font-weight: 600;";
                        input.onchange = () => {
                            row.start = input.value;
                            saveIrregularData();
                        };
                        startTd.appendChild(input);
                    } else {
                        startTd.textContent = row.start;
                        startTd.style.color = "#7c2d12";
                        startTd.style.fontWeight = "700";
                        startTd.style.fontSize = "15px";
                    }
                    tr.appendChild(startTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                    const endTd = document.createElement("td");
                    endTd.style.cssText = "padding: 16px; border: 1px solid #fdba74; text-align: center; font-size: 15px;";
                    
                    if (isIrregularTableUnlocked) {
                        const input = document.createElement("input");
                        input.type = "text";
                        input.value = row.end;
                        input.style.cssText = "width: 100%; padding: 10px; border: 2px solid #fb923c; border-radius: 8px; text-align: center; font-size: 14px; font-weight: 600;";
                        input.onchange = () => {
                            row.end = input.value;
                            saveIrregularData();
                        };
                        endTd.appendChild(input);
                    } else {
                        endTd.textContent = row.end;
                        endTd.style.color = "#7c2d12";
                        endTd.style.fontWeight = "700";
                        endTd.style.fontSize = "15px";
                    }
                    tr.appendChild(endTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø©
                    const valueTd = document.createElement("td");
                    valueTd.style.cssText = "padding: 16px; border: 1px solid #fdba74; text-align: center; font-size: 15px;";
                    
                    if (isIrregularTableUnlocked) {
                        const input = document.createElement("input");
                        input.type = "number";
                        input.value = row.value;
                        input.step = "0.01";
                        input.style.cssText = "width: 100%; padding: 10px; border: 2px solid #fb923c; border-radius: 8px; text-align: center; font-size: 14px; font-weight: 600;";
                        input.onchange = () => {
                            row.value = parseFloat(input.value) || 0;
                            saveIrregularData();
                        };
                        valueTd.appendChild(input);
                    } else {
                        valueTd.textContent = row.value;
                        valueTd.style.color = "#7c2d12";
                        valueTd.style.fontWeight = "700";
                        valueTd.style.fontSize = "15px";
                    }
                    tr.appendChild(valueTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    if (isIrregularTableUnlocked) {
                        const actionsTd = document.createElement("td");
                        actionsTd.style.cssText = "padding: 12px; border: 1px solid #e2e8f0; text-align: center;";
                        actionsTd.className = "irregular-actions-column";
                        
                        const deleteBtn = document.createElement("button");
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.style.cssText = "padding: 8px 12px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;";
                        deleteBtn.onclick = () => {
                            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
                                // Ø§Ø³ØªØ®Ø¯Ù… indexOf Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©
                                const actualIndex = irregularWorkersData.indexOf(row);
                                if (actualIndex > -1) {
                                    irregularWorkersData.splice(actualIndex, 1);
                                    saveIrregularData();
                                    renderIrregularTable();
                                }
                            }
                        };
                        
                        actionsTd.appendChild(deleteBtn);
                        tr.appendChild(actionsTd);
                    }
                    
                    tbody.appendChild(tr);
                });
            }

            // ÙØªØ­ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function openIrregularModal() {
                loadIrregularData();
                renderIrregularTable();
                document.getElementById("irregularWorkersModal").style.display = "flex";
                closeDropdown();
            }

            // Ø¥ØºÙ„Ø§Ù‚ Modal Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function closeIrregularModal() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                if (isIrregularTableUnlocked) {
                    saveIrregularData();
                }
                document.getElementById("irregularWorkersModal").style.display = "none";
                isIrregularTableUnlocked = false;
                document.getElementById("unlockIrregularTableBtn").style.display = "flex";
                document.getElementById("lockIrregularTableBtn").style.display = "none";
                document.getElementById("addIrregularRowBtn").style.display = "none";
                document.querySelectorAll(".irregular-actions-column").forEach(col => col.style.display = "none");
            }

            // ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            async function unlockIrregularTable() {
                const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:");
                if (!pass) return;
                if (await verifyPassword(pass)) {
                    isIrregularTableUnlocked = true;
                    document.getElementById("unlockIrregularTableBtn").style.display = "none";
                    document.getElementById("lockIrregularTableBtn").style.display = "flex";
                    document.getElementById("addIrregularRowBtn").style.display = "flex";
                    document.querySelectorAll(".irregular-actions-column").forEach(col => col.style.display = "table-cell");
                    renderIrregularTable();
                }
            }

            // Ù‚ÙÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            function lockIrregularTable() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙÙ„
                saveIrregularData();
                isIrregularTableUnlocked = false;
                document.getElementById("unlockIrregularTableBtn").style.display = "flex";
                document.getElementById("lockIrregularTableBtn").style.display = "none";
                document.getElementById("addIrregularRowBtn").style.display = "none";
                document.querySelectorAll(".irregular-actions-column").forEach(col => col.style.display = "none");
                renderIrregularTable();
            }

            // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            function addIrregularRow() {
                const newRow = {
                    start: "01/01/2027",
                    end: "31/12/2027",
                    value: 0
                };
                irregularWorkersData.push(newRow);
                saveIrregularData();
                renderIrregularTable();
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById("irregularWorkersBtn").onclick = openIrregularModal;
            document.getElementById("closeIrregularModal").onclick = closeIrregularModal;
            document.getElementById("unlockIrregularTableBtn").onclick = unlockIrregularTable;
            document.getElementById("lockIrregularTableBtn").onclick = lockIrregularTable;
            document.getElementById("addIrregularRowBtn").onclick = addIrregularRow;

            // ======== Ø¬Ø¯ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ========

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
            function loadWageLimitsData() {
                const saved = localStorage.getItem(WAGE_LIMITS_KEY);
                if (saved) {
                    try {
                        wageLimitsData = JSON.parse(saved);
                    } catch (e) {
                        wageLimitsData = [...defaultWageLimitsData];
                    }
                } else {
                    wageLimitsData = [...defaultWageLimitsData];
                }
            }

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ localStorage
            function saveWageLimitsData() {
                localStorage.setItem(WAGE_LIMITS_KEY, JSON.stringify(wageLimitsData));
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            function renderWageLimitsTable() {
                const tbody = document.getElementById("wageLimitsTableBody");
                tbody.innerHTML = "";
                
                wageLimitsData.forEach((row, index) => {
                    const tr = document.createElement("tr");
                    const bgColor = index % 2 === 0 ? "#cffafe" : "#ecfeff";
                    tr.style.background = bgColor;
                    tr.style.transition = "all 0.3s";
                    tr.addEventListener('mouseenter', function() { this.style.background = "#a5f3fc"; });
                    tr.addEventListener('mouseleave', function() { this.style.background = bgColor; });
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ®
                    const dateTd = document.createElement("td");
                    dateTd.style.cssText = "padding: 14px; border: 1px solid #67e8f9; text-align: center;";
                    const dateInput = document.createElement("input");
                    dateInput.type = "text";
                    dateInput.value = row.date;
                    dateInput.disabled = !isWageLimitsTableUnlocked;
                    dateInput.style.cssText = `width: 100%; padding: 10px; border: ${isWageLimitsTableUnlocked ? '2px solid #22d3ee' : '1px solid #cbd5e1'}; border-radius: 8px; text-align: center; font-size: 14px; font-weight: ${isWageLimitsTableUnlocked ? '600' : '700'}; color: ${isWageLimitsTableUnlocked ? 'inherit' : '#164e63'}; background: ${isWageLimitsTableUnlocked ? 'white' : 'transparent'};`;
                    dateInput.addEventListener('change', function() {
                        row.date = this.value;
                        saveWageLimitsData();
                    });
                    dateTd.appendChild(dateInput);
                    tr.appendChild(dateTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
                    const minWageTd = document.createElement("td");
                    minWageTd.style.cssText = "padding: 14px; border: 1px solid #67e8f9; text-align: center;";
                    const minWageInput = document.createElement("input");
                    minWageInput.type = "number";
                    minWageInput.value = row.minWage;
                    minWageInput.disabled = !isWageLimitsTableUnlocked;
                    minWageInput.style.cssText = `width: 100%; padding: 10px; border: ${isWageLimitsTableUnlocked ? '2px solid #22d3ee' : '1px solid #cbd5e1'}; border-radius: 8px; text-align: center; font-size: 14px; font-weight: ${isWageLimitsTableUnlocked ? '600' : '700'}; color: ${isWageLimitsTableUnlocked ? 'inherit' : '#164e63'}; background: ${isWageLimitsTableUnlocked ? 'white' : 'transparent'};`;
                    minWageInput.addEventListener('change', function() {
                        row.minWage = parseFloat(this.value) || 0;
                        saveWageLimitsData();
                    });
                    minWageTd.appendChild(minWageInput);
                    tr.appendChild(minWageTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
                    const maxWageTd = document.createElement("td");
                    maxWageTd.style.cssText = "padding: 14px; border: 1px solid #67e8f9; text-align: center;";
                    const maxWageInput = document.createElement("input");
                    maxWageInput.type = "number";
                    maxWageInput.value = row.maxWage;
                    maxWageInput.disabled = !isWageLimitsTableUnlocked;
                    maxWageInput.style.cssText = `width: 100%; padding: 10px; border: ${isWageLimitsTableUnlocked ? '2px solid #22d3ee' : '1px solid #cbd5e1'}; border-radius: 8px; text-align: center; font-size: 14px; font-weight: ${isWageLimitsTableUnlocked ? '600' : '700'}; color: ${isWageLimitsTableUnlocked ? 'inherit' : '#164e63'}; background: ${isWageLimitsTableUnlocked ? 'white' : 'transparent'};`;
                    maxWageInput.addEventListener('change', function() {
                        row.maxWage = parseFloat(this.value) || 0;
                        saveWageLimitsData();
                    });
                    maxWageTd.appendChild(maxWageInput);
                    tr.appendChild(maxWageTd);
                    
                    // Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
                    if (isWageLimitsTableUnlocked) {
                        const actionsTd = document.createElement("td");
                        actionsTd.style.cssText = "padding: 14px; border: 1px solid #67e8f9; text-align: center;";
                        const deleteBtn = document.createElement("button");
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Ø­Ø°Ù';
                        deleteBtn.style.cssText = "padding: 8px 14px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px;";
                        deleteBtn.addEventListener('click', function() {
                            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
                                // Ø§Ø³ØªØ®Ø¯Ù… indexOf Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ©
                                const actualIndex = wageLimitsData.indexOf(row);
                                if (actualIndex > -1) {
                                    wageLimitsData.splice(actualIndex, 1);
                                    saveWageLimitsData();
                                    renderWageLimitsTable();
                                }
                            }
                        });
                        actionsTd.appendChild(deleteBtn);
                        tr.appendChild(actionsTd);
                    }
                    
                    tbody.appendChild(tr);
                });
            }

            // ÙØªØ­ Modal
            function openWageLimitsModal() {
                loadWageLimitsData();
                renderWageLimitsTable();
                document.getElementById("wageLimitsModal").style.display = "flex";
                closeDropdown();
            }

            // Ø¥ØºÙ„Ø§Ù‚ Modal
            function closeWageLimitsModal() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                if (isWageLimitsTableUnlocked) {
                    saveWageLimitsData();
                }
                document.getElementById("wageLimitsModal").style.display = "none";
                isWageLimitsTableUnlocked = false;
                document.getElementById("enableWageLimitsEdit").style.display = "flex";
                document.getElementById("disableWageLimitsEdit").style.display = "none";
                document.getElementById("addWageLimitRow").style.display = "none";
                document.getElementById("wageLimitsActionsHeader").style.display = "none";
            }

            // ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            async function enableWageLimitsEdit() {
                const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙØªØ­ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„:");
                if (!pass) return;
                if (await verifyPassword(pass)) {
                    isWageLimitsTableUnlocked = true;
                    document.getElementById("enableWageLimitsEdit").style.display = "none";
                    document.getElementById("disableWageLimitsEdit").style.display = "flex";
                    document.getElementById("addWageLimitRow").style.display = "block";
                    document.getElementById("wageLimitsActionsHeader").style.display = "table-cell";
                    renderWageLimitsTable();
                }
            }

            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            function disableWageLimitsEdit() {
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ù‚ÙÙ„
                saveWageLimitsData();
                isWageLimitsTableUnlocked = false;
                document.getElementById("enableWageLimitsEdit").style.display = "flex";
                document.getElementById("disableWageLimitsEdit").style.display = "none";
                document.getElementById("addWageLimitRow").style.display = "none";
                document.getElementById("wageLimitsActionsHeader").style.display = "none";
                renderWageLimitsTable();
            }

            // Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¬Ø¯ÙŠØ¯
            function addWageLimitRowFunc() {
                const newRow = {
                    date: "01/01/2027",
                    minWage: 0,
                    maxWage: 0
                };
                wageLimitsData.push(newRow);
                saveWageLimitsData();
                renderWageLimitsTable();
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById("wageLimitsBtn").onclick = openWageLimitsModal;
            document.getElementById("closeWageLimitsModal").onclick = closeWageLimitsModal;
            document.getElementById("enableWageLimitsEdit").onclick = enableWageLimitsEdit;
            document.getElementById("disableWageLimitsEdit").onclick = disableWageLimitsEdit;
            document.getElementById("addWageLimitRow").onclick = addWageLimitRowFunc;

            // ======== Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ© ========
            let presumptiveRows = [];
            let presumptiveRowIdCounter = 0;

            // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† YYYY-MM (Ø´Ù‡Ø±/Ø³Ù†Ø©) Ø£Ùˆ DD/MM/YYYY Ø¥Ù„Ù‰ Date
            function parseDate(dateStr) {
                if (!dateStr) return null;
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© YYYY-MM (Ù…Ù† input type="month")
                if (dateStr.includes('-') && dateStr.split('-').length === 2) {
                    const [year, month] = dateStr.split('-');
                    return new Date(parseInt(year), parseInt(month) - 1, 1);
                }
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¨ØµÙŠØºØ© DD/MM/YYYY (Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„)
                const parts = dateStr.split('/');
                if (parts.length !== 3) return null;
                return new Date(parts[2], parts[1] - 1, parts[0]);
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¢Ø®Ø± ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø´Ù‡Ø±
            function getLastDayOfMonth(year, month) {
                return new Date(year, month + 1, 0);
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¯Ø±Ø¬Ø©
            function getSubscriptionValue(workerType, skillLevel, periodStart, periodEnd) {
                let startDate = parseDate(periodStart);
                let endDate = parseDate(periodEnd);
                
                if (!startDate || !endDate) return 0;
                
                // ØªØ­ÙˆÙŠÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø¥Ù„Ù‰ Ø¢Ø®Ø± ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø´Ù‡Ø±
                if (periodEnd.includes('-') && periodEnd.split('-').length === 2) {
                    endDate = getLastDayOfMonth(endDate.getFullYear(), endDate.getMonth());
                }
                
                if (!startDate || !endDate) return 0;

                let tableData = [];
                let valueKey = '';

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆÙ…ÙØªØ§Ø­ Ø§Ù„Ù‚ÙŠÙ…Ø©
                if (workerType === 'transport') {
                    loadTransportData();
                    tableData = transportWorkersData;
                    
                    if (skillLevel === 'tabaa') valueKey = 'tabaaValue';
                    else if (skillLevel === 'third') valueKey = 'thirdValue';
                    else if (skillLevel === 'second') valueKey = 'secondValue';
                    else if (skillLevel === 'first') valueKey = 'firstValue';
                    
                } else if (workerType === 'contractors') {
                    loadContractorsData();
                    tableData = contractorsWorkersData;
                    
                    if (skillLevel === 'limited') valueKey = 'limitedValue';
                    else if (skillLevel === 'medium') valueKey = 'mediumValue';
                    else if (skillLevel === 'skilled') valueKey = 'skilledValue';
                    
                } else if (workerType === 'irregular') {
                    loadIrregularData();
                    tableData = irregularWorkersData;
                    valueKey = 'value';
                }

                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ø´Ù‡Ø±ÙŠ)
                let totalValue = 0;
                
                for (let row of tableData) {
                    const rowStart = parseDate(row.start);
                    const rowEnd = parseDate(row.end);
                    
                    if (!rowStart) continue;
                    
                    // Ù„Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ©
                    if (workerType === 'irregular' && !rowEnd) continue;

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø¨ÙŠÙ† Ø§Ù„ÙØªØ±Ø§Øª
                    const overlapStart = new Date(Math.max(startDate.getTime(), rowStart.getTime()));
                    const overlapEnd = new Date(Math.min(endDate.getTime(), rowEnd ? rowEnd.getTime() : rowStart.getTime()));
                    
                    if (overlapStart <= overlapEnd) {
                        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ± ÙÙŠ Ø§Ù„ØªØ¯Ø§Ø®Ù„
                        const startYear = overlapStart.getFullYear();
                        const startMonth = overlapStart.getMonth();
                        const endYear = overlapEnd.getFullYear();
                        const endMonth = overlapEnd.getMonth();
                        
                        // Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ± = (Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© - Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¨Ø¯Ø§Ø¦ÙŠØ©) Ã— 12 + (Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ - Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¨Ø¯Ø§Ø¦ÙŠ) + 1
                        const months = (endYear - startYear) * 12 + (endMonth - startMonth) + 1;
                        const value = parseFloat(row[valueKey]) || 0;
                        
                        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ± (Ø§Ù„Ù‚ÙŠÙ…Ø© Ø´Ù‡Ø±ÙŠØ©)
                        totalValue += value * months;
                    }
                }

                return totalValue;
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ØµÙ Ø¬Ø¯ÙŠØ¯
            function createPresumptiveRow() {
                const rowId = presumptiveRowIdCounter++;
                const row = {
                    id: rowId,
                    start: '',
                    end: '',
                    workerType: 'transport',
                    skillLevel: 'tabaa',
                    value: 0
                };
                presumptiveRows.push(row);
                renderPresumptiveRow(row);
                return row;
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„ØµÙ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
            function getRowColor(workerType, skillLevel) {
                const colors = {
                    transport: {
                        tabaa: '#fef3c7',      // Ø£ØµÙØ± ÙØ§ØªØ­
                        third: '#fed7aa',       // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­
                        second: '#fecaca',      // Ø£Ø­Ù…Ø± ÙØ§ØªØ­
                        first: '#fca5a5'        // Ø£Ø­Ù…Ø± Ø£ÙØªØ­
                    },
                    contractors: {
                        limited: '#dbeafe',     // Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­
                        medium: '#bfdbfe',      // Ø£Ø²Ø±Ù‚ Ù…ØªÙˆØ³Ø·
                        skilled: '#93c5fd'      // Ø£Ø²Ø±Ù‚ Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹
                    },
                    irregular: {
                        default: '#d1fae5'      // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
                    }
                };
                
                return colors[workerType]?.[skillLevel] || '#f3f4f6';
            }
    
            // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØµÙ
            function renderPresumptiveRow(row) {
                const container = document.getElementById('presumptiveRowsContainer');
                
                const tr = document.createElement('tr');
                tr.id = `presumptive-row-${row.id}`;
                tr.style.backgroundColor = getRowColor(row.workerType, row.skillLevel);
                tr.style.transition = 'all 0.3s ease';
                
                tr.innerHTML = `
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <input type="month" 
                               class="presumptive-start" data-row-id="${row.id}"
                               value="${row.start}"
                               style="width: 100%; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; text-align: center; background: rgba(255,255,255,0.7);">
                    </td>
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <input type="month" 
                               class="presumptive-end" data-row-id="${row.id}"
                               value="${row.end}"
                               style="width: 100%; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; text-align: center; background: rgba(255,255,255,0.7);">
                    </td>
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <select class="presumptive-worker-type" data-row-id="${row.id}"
                                style="width: 100%; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; background: rgba(255,255,255,0.7);">
                            <option value="transport" ${row.workerType === 'transport' ? 'selected' : ''}>Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ</option>
                            <option value="contractors" ${row.workerType === 'contractors' ? 'selected' : ''}>Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª</option>
                            <option value="irregular" ${row.workerType === 'irregular' ? 'selected' : ''}>Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©</option>
                        </select>
                    </td>
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <select class="presumptive-skill-level" data-row-id="${row.id}"
                                style="width: 100%; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; background: rgba(255,255,255,0.7);">
                        </select>
                    </td>
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <input type="text" readonly 
                               class="presumptive-value" data-row-id="${row.id}"
                               value="${row.value.toFixed(2)}"
                               style="width: 100%; padding: 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; text-align: center; background: rgba(255,255,255,0.9); font-weight: bold; color: #059669;">
                    </td>
                    <td style="padding: 8px; border: 1px solid #e5e7eb; text-align: center;">
                        <div style="display: flex; gap: 4px; justify-content: center;">
                            <button class="presumptive-show-details" data-row-id="${row.id}"
                                    style="flex: 1; padding: 6px 8px; background: linear-gradient(135deg, #0891b2, #06b6d4); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; white-space: nowrap;">
                                <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                            </button>
                            <button class="presumptive-delete" data-row-id="${row.id}"
                                    style="flex: 1; padding: 6px 8px; background: linear-gradient(135deg, #dc2626, #ef4444); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 11px; white-space: nowrap;">
                                <i class="fas fa-trash"></i> Ø­Ø°Ù
                            </button>
                        </div>
                    </td>
                `;
                
                container.appendChild(tr);
                
                // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
                updateSkillLevelOptions(row.id, row.workerType, row.skillLevel);
                
                // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                attachPresumptiveRowEvents(row.id);
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
            function updateSkillLevelOptions(rowId, workerType, selectedSkill) {
                const skillSelect = document.querySelector(`.presumptive-skill-level[data-row-id="${rowId}"]`);
                
                let options = '';
                if (workerType === 'transport') {
                    options = `
                        <option value="tabaa" ${selectedSkill === 'tabaa' ? 'selected' : ''}>ØªØ¨Ø§Ø¹</option>
                        <option value="third" ${selectedSkill === 'third' ? 'selected' : ''}>Ø±Ø®ØµØ© Ø¯Ø±Ø¬Ø© Ø«Ø§Ù„Ø«Ø©</option>
                        <option value="second" ${selectedSkill === 'second' ? 'selected' : ''}>Ø±Ø®ØµØ© Ø¯Ø±Ø¬Ø© Ø«Ø§Ù†ÙŠØ©</option>
                        <option value="first" ${selectedSkill === 'first' ? 'selected' : ''}>Ø±Ø®ØµØ© Ø¯Ø±Ø¬Ø© Ø£ÙˆÙ„Ù‰</option>
                    `;
                } else if (workerType === 'contractors') {
                    options = `
                        <option value="limited" ${selectedSkill === 'limited' ? 'selected' : ''}>Ø¹Ø§Ù…Ù„ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</option>
                        <option value="medium" ${selectedSkill === 'medium' ? 'selected' : ''}>Ø¹Ø§Ù…Ù„ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</option>
                        <option value="skilled" ${selectedSkill === 'skilled' ? 'selected' : ''}>Ø¹Ø§Ù…Ù„ Ù…Ø§Ù‡Ø±</option>
                    `;
                } else if (workerType === 'irregular') {
                    options = `<option value="default" selected>Ø§ÙØªØ±Ø§Ø¶ÙŠ</option>`;
                }
                
                skillSelect.innerHTML = options;
                
                // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„ØµÙ
                updateRowColor(rowId, workerType, selectedSkill);
            }
            
            // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„ØµÙ
            function updateRowColor(rowId, workerType, skillLevel) {
                const row = document.getElementById(`presumptive-row-${rowId}`);
                if (row) {
                    row.style.backgroundColor = getRowColor(workerType, skillLevel);
                }
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø§Ù„ØµÙ
            function attachPresumptiveRowEvents(rowId) {
                const row = presumptiveRows.find(r => r.id === rowId);
                if (!row) return;

                // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©
                document.querySelector(`.presumptive-start[data-row-id="${rowId}"]`).addEventListener('input', function(e) {
                    row.start = e.target.value;
                    calculatePresumptiveRowValue(rowId);
                    validateAndHighlightErrors();
                });

                // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©
                document.querySelector(`.presumptive-end[data-row-id="${rowId}"]`).addEventListener('input', function(e) {
                    row.end = e.target.value;
                    calculatePresumptiveRowValue(rowId);
                    validateAndHighlightErrors();
                });

                // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø©
                document.querySelector(`.presumptive-worker-type[data-row-id="${rowId}"]`).addEventListener('change', function(e) {
                    row.workerType = e.target.value;
                    row.skillLevel = row.workerType === 'transport' ? 'tabaa' : (row.workerType === 'contractors' ? 'limited' : 'default');
                    updateSkillLevelOptions(rowId, row.workerType, row.skillLevel);
                    calculatePresumptiveRowValue(rowId);
                    validateAndHighlightErrors();
                });

                // Ø­Ø¯Ø« ØªØºÙŠÙŠØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
                document.querySelector(`.presumptive-skill-level[data-row-id="${rowId}"]`).addEventListener('change', function(e) {
                    row.skillLevel = e.target.value;
                    updateRowColor(rowId, row.workerType, row.skillLevel);
                    calculatePresumptiveRowValue(rowId);
                    validateAndHighlightErrors();
                });

                // Ø­Ø¯Ø« Ø§Ù„Ø­Ø°Ù
                document.querySelector(`.presumptive-delete[data-row-id="${rowId}"]`).addEventListener('click', function() {
                    deletePresumptiveRow(rowId);
                    validateAndHighlightErrors();
                });

                // Ø­Ø¯Ø« Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                document.querySelector(`.presumptive-show-details[data-row-id="${rowId}"]`).addEventListener('click', function() {
                    showPresumptiveDetails(rowId);
                });
            }
            
            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØªÙ…ÙŠÙŠØ²Ù‡Ø§ Ø¨ØµØ±ÙŠØ§Ù‹
            function validateAndHighlightErrors() {
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
                presumptiveRows.forEach(row => {
                    const tr = document.getElementById(`presumptive-row-${row.id}`);
                    if (tr) {
                        tr.style.outline = 'none';
                        tr.style.boxShadow = 'none';
                    }
                });
                
                const errors = validatePresumptivePeriods();
                
                const errorsContainer = document.getElementById('presumptiveErrorsContainer');
                const errorsList = document.getElementById('presumptiveErrorsList');
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø£Ø®Ø·Ø§Ø¡ØŒ Ù†Ø¹Ø±Ø¶Ù‡Ø§ ÙˆÙ†Ù…ÙŠÙ‘Ø² Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©
                if (errors.length > 0) {
                    errorsContainer.style.display = 'block';
                    errorsList.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙÙˆÙ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                    errors.forEach(error => {
                        if (error.includes('Ø§Ù„ØµÙ')) {
                            const match = error.match(/Ø§Ù„ØµÙ (\d+)/);
                            if (match) {
                                const rowIndex = parseInt(match[1]) - 1;
                                if (presumptiveRows[rowIndex]) {
                                    const tr = document.getElementById(`presumptive-row-${presumptiveRows[rowIndex].id}`);
                                    if (tr) {
                                        tr.style.outline = '3px solid #ef4444';
                                        tr.style.outlineOffset = '-3px';
                                    }
                                }
                            }
                        } else if (error.includes('Ø§Ù„ÙØªØ±Ø©') || error.includes('ØªØ¯Ø§Ø®Ù„')) {
                            // ØªÙ…ÙŠÙŠØ² Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„
                            presumptiveRows.forEach(row => {
                                const tr = document.getElementById(`presumptive-row-${row.id}`);
                                if (tr && (error.includes(formatDateForDisplay(row.start)) || error.includes(row.start))) {
                                    tr.style.outline = '3px solid #f59e0b';
                                    tr.style.outlineOffset = '-3px';
                                }
                            });
                        }
                    });
                } else {
                    errorsContainer.style.display = 'none';
                    errorsList.innerHTML = '';
                }
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ… Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙÙˆÙ
                presumptiveRows.forEach(row => {
                    calculatePresumptiveRowValue(row.id);
                });
                
                return errors;
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙÙŠ Modal
            function showPresumptiveDetails(rowId) {
                const row = presumptiveRows.find(r => r.id === rowId);
                if (!row || !row.start || !row.end) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø¯Ø§ÙŠØ© ÙˆÙ†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
                    return;
                }

                let startDate = parseDate(row.start);
                let endDate = parseDate(row.end);
                
                if (!startDate || !endDate) {
                    alert('ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ­ÙŠØ­');
                    return;
                }
                
                // ØªØ­ÙˆÙŠÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø¥Ù„Ù‰ Ø¢Ø®Ø± ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø´Ù‡Ø±
                if (row.end.includes('-') && row.end.split('-').length === 2) {
                    endDate = getLastDayOfMonth(endDate.getFullYear(), endDate.getMonth());
                }

                let tableData = [];
                let valueKey = '';
                let wageKey = '';
                let tableName = '';

                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ ÙˆÙ…ÙØ§ØªÙŠØ­ Ø§Ù„Ù‚ÙŠÙ…Ø©
                if (row.workerType === 'transport') {
                    loadTransportData();
                    tableData = transportWorkersData;
                    tableName = 'Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ';
                    
                    if (row.skillLevel === 'tabaa') {
                        valueKey = 'tabaaValue';
                        wageKey = 'tabaaWage';
                    } else if (row.skillLevel === 'third') {
                        valueKey = 'thirdValue';
                        wageKey = 'third';
                    } else if (row.skillLevel === 'second') {
                        valueKey = 'secondValue';
                        wageKey = 'second';
                    } else if (row.skillLevel === 'first') {
                        valueKey = 'firstValue';
                        wageKey = 'first';
                    }
                    
                } else if (row.workerType === 'contractors') {
                    loadContractorsData();
                    tableData = contractorsWorkersData;
                    tableName = 'Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª';
                    
                    if (row.skillLevel === 'limited') {
                        valueKey = 'limitedValue';
                        wageKey = 'limitedWage';
                    } else if (row.skillLevel === 'medium') {
                        valueKey = 'mediumValue';
                        wageKey = 'mediumWage';
                    } else if (row.skillLevel === 'skilled') {
                        valueKey = 'skilledValue';
                        wageKey = 'skilledWage';
                    }
                    
                } else if (row.workerType === 'irregular') {
                    loadIrregularData();
                    tableData = irregularWorkersData;
                    tableName = 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©';
                    valueKey = 'value';
                    wageKey = 'value';
                }

                // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¯Ø§Ø®Ù„Ø©
                let detailsHTML = `
                    <h4 style="color: #0891b2; margin-bottom: 15px; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-table"></i> ${tableName} - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
                    </h4>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); table-layout: fixed;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #0891b2, #06b6d4); color: white;">
                                    <th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: 18%;">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                                    <th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: 18%;">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                                    ${row.workerType !== 'irregular' ? '<th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: 16%;">Ø£Ø¬Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>' : ''}
                                    <th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: ${row.workerType !== 'irregular' ? '16%' : '22%'};">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                                    <th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: ${row.workerType !== 'irregular' ? '16%' : '22%'};">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ±</th>
                                    <th style="padding: 12px; border: 1px solid #67e8f9; text-align: center; font-size: 13px; width: ${row.workerType !== 'irregular' ? '16%' : '20%'};">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                let grandTotal = 0;
                let rowIndex = 0;

                for (let tableRow of tableData) {
                    const rowStart = parseDate(tableRow.start);
                    const rowEnd = parseDate(tableRow.end);
                    
                    if (!rowStart) continue;
                    
                    // Ù„Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©: ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ©
                    if (row.workerType === 'irregular' && !rowEnd) continue;

                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¯Ø§Ø®Ù„
                    const overlapStart = new Date(Math.max(startDate.getTime(), rowStart.getTime()));
                    const overlapEnd = new Date(Math.min(endDate.getTime(), rowEnd ? rowEnd.getTime() : rowStart.getTime()));
                    
                    if (overlapStart <= overlapEnd) {
                        // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ù‡ÙˆØ±
                        const startYear = overlapStart.getFullYear();
                        const startMonth = overlapStart.getMonth();
                        const endYear = overlapEnd.getFullYear();
                        const endMonth = overlapEnd.getMonth();
                        const months = (endYear - startYear) * 12 + (endMonth - startMonth) + 1;
                        
                        const wage = parseFloat(tableRow[wageKey]) || 0;
                        const value = parseFloat(tableRow[valueKey]) || 0;
                        const total = value * months;
                        grandTotal += total;

                        const bgColor = rowIndex % 2 === 0 ? '#f0f9ff' : 'white';
                        
                        detailsHTML += `
                            <tr style="background: ${bgColor};">
                                <td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px;">${tableRow.start}</td>
                                <td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px;">${tableRow.end}</td>
                                ${row.workerType !== 'irregular' ? `<td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px; font-weight: 600;">${wage.toFixed(2)}</td>` : ''}
                                <td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px; font-weight: 600; color: #0891b2;">${value.toFixed(2)}</td>
                                <td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px; font-weight: 700;">${months}</td>
                                <td style="padding: 10px; border: 1px solid #e0f2fe; text-align: center; font-size: 13px; font-weight: 700; color: #059669;">${total.toFixed(2)}</td>
                            </tr>
                        `;
                        
                        rowIndex++;
                    }
                }

                if (rowIndex === 0) {
                    detailsHTML += `
                        <tr>
                            <td colspan="${row.workerType !== 'irregular' ? '6' : '5'}" style="padding: 20px; text-align: center; color: #64748b; font-size: 14px;">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ·Ø§Ø¨Ù‚Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                            </td>
                        </tr>
                    `;
                } else {
                    detailsHTML += `
                        <tr style="background: linear-gradient(135deg, #dcfce7, #86efac); font-weight: bold;">
                            <td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 14px; color: #065f46;"></td>
                            <td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 14px; color: #065f46;"></td>
                            ${row.workerType !== 'irregular' ? '<td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 14px; color: #065f46;"></td>' : ''}
                            <td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 14px; color: #065f46;"></td>
                            <td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 14px; color: #065f46; font-weight: 700;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</td>
                            <td style="padding: 12px; border: 1px solid #4ade80; text-align: center; font-size: 15px; color: #065f46; font-weight: 700;">${grandTotal.toFixed(2)}</td>
                        </tr>
                    `;
                }

                detailsHTML += `
                            </tbody>
                        </table>
                    </div>
                `;

                // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø®Øµ
                const skillLabel = document.querySelector(`.presumptive-skill-level[data-row-id="${rowId}"] option:checked`).textContent;
                const summaryHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-calendar-alt" style="font-size: 20px; color: #0891b2;"></i>
                            <div>
                                <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">Ø§Ù„ÙØªØ±Ø©</div>
                                <div style="font-weight: bold; color: #0f172a;">${formatDateForDisplay(row.start)} - ${formatDateForDisplay(row.end)}</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-users" style="font-size: 20px; color: #0891b2;"></i>
                            <div>
                                <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</div>
                                <div style="font-weight: bold; color: #0f172a;">${getWorkerTypeLabel(row.workerType)}</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-award" style="font-size: 20px; color: #0891b2;"></i>
                            <div>
                                <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</div>
                                <div style="font-weight: bold; color: #0f172a;">${skillLabel}</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-coins" style="font-size: 20px; color: #059669;"></i>
                            <div>
                                <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                                <div style="font-weight: bold; color: #059669; font-size: 18px;">${grandTotal.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                `;

                // ØªØ­Ø¯ÙŠØ« Modal
                document.getElementById('detailsModalTitle').textContent = tableName + ' - ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨';
                document.getElementById('detailsModalSummary').innerHTML = summaryHTML;
                document.getElementById('detailsModalContent').innerHTML = detailsHTML;
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±
                window.currentDetailsData = {
                    tableName: tableName,
                    summary: summaryHTML,
                    tableHTML: detailsHTML,
                    grandTotal: grandTotal
                };
                
                // ÙØªØ­ Modal
                document.getElementById('presumptiveDetailsModal').style.display = 'flex';
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø¥ØºÙ„Ø§Ù‚ Modal Ø§Ù„ØªÙØ§ØµÙŠÙ„
            window.closePresumptiveDetailsModal = function() {
                console.log('Closing details modal');
                const modal = document.getElementById('presumptiveDetailsModal');
                if (modal) {
                    modal.style.display = 'none';
                    console.log('Modal closed successfully');
                } else {
                    console.error('Modal not found!');
                }
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± ØªÙØ§ØµÙŠÙ„ Modal Ø¥Ù„Ù‰ PDF
            window.exportDetailsModalToPDF = function() {
                console.log('Exporting details to PDF');
                if (!window.currentDetailsData) {
                    alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                    return;
                }

                const element = document.createElement('div');
                element.style.cssText = 'direction: rtl; font-family: Arial; padding: 30px;';
                
                element.innerHTML = `
                    <h2 style="text-align: center; color: #0891b2; margin-bottom: 20px;">${window.currentDetailsData.tableName}</h2>
                    <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                        ${window.currentDetailsData.summary}
                    </div>
                    ${window.currentDetailsData.tableHTML}
                `;

                const opt = {
                    margin: 10,
                    filename: 'ØªÙØ§ØµÙŠÙ„_Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª_Ø§Ù„Ø­ÙƒÙ…ÙŠØ©.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: false, allowTaint: true, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
                };

                html2pdf().set(opt).from(element).save();
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù„ØµÙ Ù…Ø¹ÙŠÙ†
            function calculatePresumptiveRowValue(rowId) {
                const row = presumptiveRows.find(r => r.id === rowId);
                if (!row) return;

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØµÙ
                const errors = validatePresumptivePeriods();
                let hasError = false;
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø®Ø·Ø§Ø¡ ØªØ®Øµ Ù‡Ø°Ø§ Ø§Ù„ØµÙ
                const rowIndex = presumptiveRows.findIndex(r => r.id === rowId);
                errors.forEach(error => {
                    if (error.includes(`Ø§Ù„ØµÙ ${rowIndex + 1}`) || 
                        error.includes(row.start) || 
                        error.includes(formatDateForDisplay(row.start))) {
                        hasError = true;
                    }
                });

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£ØŒ Ù„Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø©
                let value = 0;
                if (!hasError && row.start && row.end && row.workerType && row.skillLevel) {
                    value = getSubscriptionValue(row.workerType, row.skillLevel, row.start, row.end);
                }
                
                row.value = value;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                const valueInput = document.querySelector(`.presumptive-value[data-row-id="${rowId}"]`);
                if (valueInput) {
                    valueInput.value = value.toFixed(2);
                    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø®Ø·Ø£
                    if (hasError) {
                        valueInput.style.background = '#fee2e2';
                        valueInput.style.color = '#dc2626';
                    } else {
                        valueInput.style.background = '#f1f5f9';
                        valueInput.style.color = '#059669';
                    }
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
                updatePresumptiveTotal();
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø­Ø°Ù ØµÙ
            function deletePresumptiveRow(rowId) {
                presumptiveRows = presumptiveRows.filter(r => r.id !== rowId);
                const rowElement = document.getElementById(`presumptive-row-${rowId}`);
                if (rowElement) {
                    rowElement.remove();
                }
                updatePresumptiveTotal();
                validateAndHighlightErrors();
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            function updatePresumptiveTotal() {
                const total = presumptiveRows.reduce((sum, row) => sum + row.value, 0);
                document.getElementById('presumptiveTotalSubs').textContent = total.toFixed(2);
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ§Ù„ØªØ¯Ø§Ø®Ù„
            function validatePresumptivePeriods() {
                const errors = [];
                
                if (presumptiveRows.length === 0) {
                    return errors;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                for (let i = 0; i < presumptiveRows.length; i++) {
                    const row = presumptiveRows[i];
                    if (!row.start || !row.end || !row.workerType || !row.skillLevel) {
                        errors.push(`âŒ Ø§Ù„ØµÙ ${i + 1}: ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©`);
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                    const startDate = parseDate(row.start);
                    const endDate = parseDate(row.end);
                    if (startDate && endDate && startDate > endDate) {
                        errors.push(`âŒ Ø§Ù„ØµÙ ${i + 1}: ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©`);
                    }
                }
                
                if (errors.length > 0) {
                    return errors;
                }
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙˆÙ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                const sortedRows = [...presumptiveRows].map((row, index) => ({...row, originalIndex: index}))
                    .sort((a, b) => {
                        const dateA = parseDate(a.start);
                        const dateB = parseDate(b.start);
                        return dateA - dateB;
                    });

                // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ: ÙƒÙ„ ÙØªØ±Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨Ø¹Ø¯ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªÙ…Ø§Ù…Ø§Ù‹ (Ø¨Ø¯ÙˆÙ† ØªØ¯Ø§Ø®Ù„)
                for (let i = 0; i < sortedRows.length - 1; i++) {
                    const currentRow = sortedRows[i];
                    const nextRow = sortedRows[i + 1];
                    
                    const currentStart = parseDate(currentRow.start);
                    const currentEnd = parseDate(currentRow.end);
                    const nextStart = parseDate(nextRow.start);
                    const nextEnd = parseDate(nextRow.end);
                    
                    // ØªØ­ÙˆÙŠÙ„ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø± Ø¥Ù„Ù‰ Ø¢Ø®Ø± ÙŠÙˆÙ…
                    const currentEndDate = getLastDayOfMonth(currentEnd.getFullYear(), currentEnd.getMonth());
                    const nextStartDate = nextStart;
                    
                    // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    if (nextStartDate <= currentEndDate) {
                        errors.push(`âŒ Ø§Ù„ÙØªØ±Ø© ${i + 2} (${formatDateForDisplay(nextRow.start)} - ${formatDateForDisplay(nextRow.end)}) ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© ${i + 1} (${formatDateForDisplay(currentRow.start)} - ${formatDateForDisplay(currentRow.end)})`);
                    }
                }

                // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø¨ÙŠÙ† ÙØ¦Ø§Øª Ù…Ø®ØªÙ„ÙØ©
                for (let i = 0; i < presumptiveRows.length; i++) {
                    for (let j = i + 1; j < presumptiveRows.length; j++) {
                        const row1 = presumptiveRows[i];
                        const row2 = presumptiveRows[j];
                        
                        // Ø§Ù„ØªØ­Ù‚Ù‚ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙØ¦Ø§Øª Ù…Ø®ØªÙ„ÙØ©
                        if (row1.workerType !== row2.workerType) {
                            const start1 = parseDate(row1.start);
                            const end1 = getLastDayOfMonth(parseDate(row1.end).getFullYear(), parseDate(row1.end).getMonth());
                            const start2 = parseDate(row2.start);
                            const end2 = getLastDayOfMonth(parseDate(row2.end).getFullYear(), parseDate(row2.end).getMonth());
                            
                            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¯Ø§Ø®Ù„: Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø£ÙŠ ØªÙ‚Ø§Ø·Ø¹ Ø¨ÙŠÙ† Ø§Ù„ÙØªØ±ØªÙŠÙ†ØŸ
                            const hasOverlap = (start1 <= end2 && start2 <= end1);
                            
                            if (hasOverlap) {
                                errors.push(`âŒ ØªØ¯Ø§Ø®Ù„ ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­: Ø§Ù„ÙØªØ±Ø© (${formatDateForDisplay(row1.start)} - ${formatDateForDisplay(row1.end)}) Ù…Ù† ÙØ¦Ø© "${getWorkerTypeLabel(row1.workerType)}" ØªØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„ÙØªØ±Ø© (${formatDateForDisplay(row2.start)} - ${formatDateForDisplay(row2.end)}) Ù…Ù† ÙØ¦Ø© "${getWorkerTypeLabel(row2.workerType)}"`);
                            }
                        }
                    }
                }

                return errors;
            }

            // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø©
            function getWorkerTypeLabel(type) {
                if (type === 'transport') return 'Ø¹Ù…Ø§Ù„ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙŠ';
                if (type === 'contractors') return 'Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª';
                if (type === 'irregular') return 'Ø§Ù„Ø¹Ù…Ø§Ù„Ø© ØºÙŠØ± Ø§Ù„Ù…Ù†ØªØ¸Ù…Ø©';
                return type;
            }

            // Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ©
            function openPresumptiveModal() {
                presumptiveRows = [];
                presumptiveRowIdCounter = 0;
                document.getElementById('presumptiveRowsContainer').innerHTML = '';
                createPresumptiveRow();
                document.getElementById('presumptiveSubsModal').style.display = 'flex';
                updatePresumptiveTotal();
                closeDropdown();
            }

            // Ø¯Ø§Ù„Ø© Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            function closePresumptiveModal() {
                document.getElementById('presumptiveSubsModal').style.display = 'none';
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ù„Ø¹Ø±Ø¶ (Ù…Ù† YYYY-MM Ø¥Ù„Ù‰ Ø´Ù‡Ø±/Ø³Ù†Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ)
            function formatDateForDisplay(dateStr) {
                if (!dateStr) return '';
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨ØµÙŠØºØ© YYYY-MM
                if (dateStr.includes('-') && dateStr.split('-').length === 2) {
                    const [year, month] = dateStr.split('-');
                    const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 
                                   'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
                    return `${months[parseInt(month) - 1]} ${year}`;
                }
                
                return dateStr;
            }

            // Ø¯Ø§Ù„Ø© Ù„ØªØµØ¯ÙŠØ± PDF
            function exportPresumptivePDF() {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const errors = validatePresumptivePeriods();
                if (errors.length > 0) {
                    alert('ÙŠÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:\n\n' + errors.join('\n'));
                    return;
                }

                const element = document.createElement('div');
                element.style.cssText = 'direction: rtl; font-family: Arial; padding: 30px;';
                
                let html = `
                    <h2 style="text-align: center; color: #2563eb; margin-bottom: 30px;">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ø­ÙƒÙ…ÙŠØ©</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: #e0e7ff;">
                                <th style="border: 1px solid #000; padding: 10px;">Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                                <th style="border: 1px solid #000; padding: 10px;">Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø©</th>
                                <th style="border: 1px solid #000; padding: 10px;">Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ø§Ù„Ø©</th>
                                <th style="border: 1px solid #000; padding: 10px;">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</th>
                                <th style="border: 1px solid #000; padding: 10px;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                presumptiveRows.forEach(row => {
                    const skillLabel = document.querySelector(`.presumptive-skill-level[data-row-id="${row.id}"] option:checked`).textContent;
                    html += `
                        <tr>
                            <td style="border: 1px solid #000; padding: 8px; text-align: center;">${formatDateForDisplay(row.start)}</td>
                            <td style="border: 1px solid #000; padding: 8px; text-align: center;">${formatDateForDisplay(row.end)}</td>
                            <td style="border: 1px solid #000; padding: 8px; text-align: center;">${getWorkerTypeLabel(row.workerType)}</td>
                            <td style="border: 1px solid #000; padding: 8px; text-align: center;">${skillLabel}</td>
                            <td style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: bold;">${row.value.toFixed(2)}</td>
                        </tr>
                    `;
                });
                
                const total = presumptiveRows.reduce((sum, row) => sum + row.value, 0);
                html += `
                        </tbody>
                    </table>
                    <div style="background: #dcfce7; padding: 15px; border-radius: 8px; text-align: center;">
                        <strong style="font-size: 18px;">Ø¬Ù…Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©: ${total.toFixed(2)}</strong>
                    </div>
                `;
                
                element.innerHTML = html;

                const opt = {
                    margin: 10,
                    filename: 'Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª_Ø§Ù„Ø­ÙƒÙ…ÙŠØ©.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: false, allowTaint: true, letterRendering: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(element).save();
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById('presumptiveSubsBtn').onclick = openPresumptiveModal;
            document.getElementById('closePresumptiveModal').onclick = closePresumptiveModal;
            document.getElementById('addPresumptiveRowBtn').onclick = createPresumptiveRow;
            document.getElementById('exportPresumptivePDF').onclick = exportPresumptivePDF;
            
            const updateFilterInputTypes = function () {
                const filterType = document.getElementById("filterType");
                const isYear = filterType.value === "year";
                const input1 = document.getElementById("filterDate1");
                const input2 = document.getElementById("filterDate2");
                input1.type = isYear ? "number" : "month";
                input2.type = isYear ? "number" : "month";
                input1.placeholder = isYear ? "Ø§Ù„Ø³Ù†Ø© (Ù…Ø«Ø§Ù„: 2025)" : "Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø©";
                input2.placeholder = isYear ? "Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©" : "Ø§Ù„Ø´Ù‡Ø± ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©";
                // Ù…Ø³Ø­ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ± Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                input1.value = "";
                input2.value = "";
                // Ù…Ø³Ø­ Ø§Ù„ÙÙ„ØªØ±Ø©
                applyFilterClear();
            };
            
            document.getElementById("filterType").onchange = updateFilterInputTypes;
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ØµØ­ÙŠØ­ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            updateFilterInputTypes();
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            ["filterType", "filterCondition", "filterDate1", "filterDate2"].forEach(id => { 
                const element = document.getElementById(id);
                element.addEventListener('change', applyFilter);
                element.addEventListener('input', applyFilter);
            });
            document.addEventListener("keydown", e => {
                if (e.key === "F4") repeatValueDown();
                if (e.key === "F8") {
                    e.preventDefault(); // Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­
                    document.getElementById("clearSubsBtn").click();
                }
                if (e.key === "Escape") { closeBulkModal(); closeBulkRateModal(); closeRatesDetailModal(); dropdownMenu.classList.remove("show"); }
            });
            enableDragAndDrop();

            // Ø¬Ø¹Ù„ Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ ÙÙ‚Ø·
            function makeFABDraggable() {
                const menuToggle = document.querySelector('.menu-toggle');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù†Ø§ Ø¹Ù„Ù‰ Ø´Ø§Ø´Ø© Ù‡Ø§ØªÙ (480px Ø£Ùˆ Ø£Ù‚Ù„)
                if (window.innerWidth <= 480) {
                    let isDragging = false;
                    let currentX;
                    let currentY;
                    let initialX;
                    let initialY;
                    let xOffset = 0;
                    let yOffset = 0;

                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ù‚Ø¯Ø§Ù…Ù‰ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                    if (menuToggle.dragHandlers) {
                        menuToggle.removeEventListener('touchstart', menuToggle.dragHandlers.dragStart);
                        menuToggle.removeEventListener('touchend', menuToggle.dragHandlers.dragEnd);
                        menuToggle.removeEventListener('touchmove', menuToggle.dragHandlers.drag);
                        menuToggle.removeEventListener('mousedown', menuToggle.dragHandlers.dragStart);
                        menuToggle.removeEventListener('mouseup', menuToggle.dragHandlers.dragEnd);
                        menuToggle.removeEventListener('mousemove', menuToggle.dragHandlers.drag);
                    }

                    function dragStart(e) {
                        if (e.type === "touchstart") {
                            initialX = e.touches[0].clientX - xOffset;
                            initialY = e.touches[0].clientY - yOffset;
                        } else {
                            initialX = e.clientX - xOffset;
                            initialY = e.clientY - yOffset;
                        }

                        menuToggle.dragTimer = setTimeout(() => {
                            isDragging = true;
                            menuToggle.style.cursor = 'grabbing';
                        }, 150);
                    }

                    function dragEnd(e) {
                        clearTimeout(menuToggle.dragTimer);
                        
                        if (!isDragging) {
                            return;
                        }

                        initialX = currentX;
                        initialY = currentY;
                        isDragging = false;
                        menuToggle.style.cursor = 'grab';
                        
                        e.preventDefault();
                        e.stopPropagation();
                    }

                    function drag(e) {
                        if (!isDragging) return;

                        e.preventDefault();

                        if (e.type === "touchmove") {
                            currentX = e.touches[0].clientX - initialX;
                            currentY = e.touches[0].clientY - initialY;
                        } else {
                            currentX = e.clientX - initialX;
                            currentY = e.clientY - initialY;
                        }

                        xOffset = currentX;
                        yOffset = currentY;

                        const rect = menuToggle.getBoundingClientRect();
                        const maxX = window.innerWidth - rect.width - 10;
                        const maxY = window.innerHeight - rect.height - 10;
                        
                        const newX = Math.max(10, Math.min(currentX, maxX));
                        const newY = Math.max(10, Math.min(currentY, maxY));

                        setTranslate(newX, newY, menuToggle);
                    }

                    function setTranslate(xPos, yPos, el) {
                        el.style.transform = `translate(${xPos}px, ${yPos}px)`;
                    }

                    menuToggle.addEventListener('touchstart', dragStart, { passive: false });
                    menuToggle.addEventListener('touchend', dragEnd);
                    menuToggle.addEventListener('touchmove', drag, { passive: false });

                    menuToggle.addEventListener('mousedown', dragStart);
                    menuToggle.addEventListener('mouseup', dragEnd);
                    menuToggle.addEventListener('mousemove', drag);
                    
                    // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ Ù„Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
                    menuToggle.dragHandlers = { dragStart, dragEnd, drag };
                    
                    menuToggle.style.cursor = 'grab';
                } else {
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø± Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±
                    menuToggle.style.transform = '';
                    menuToggle.style.cursor = 'pointer';
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                    if (menuToggle.dragHandlers) {
                        menuToggle.removeEventListener('touchstart', menuToggle.dragHandlers.dragStart);
                        menuToggle.removeEventListener('touchend', menuToggle.dragHandlers.dragEnd);
                        menuToggle.removeEventListener('touchmove', menuToggle.dragHandlers.drag);
                        menuToggle.removeEventListener('mousedown', menuToggle.dragHandlers.dragStart);
                        menuToggle.removeEventListener('mouseup', menuToggle.dragHandlers.dragEnd);
                        menuToggle.removeEventListener('mousemove', menuToggle.dragHandlers.drag);
                        delete menuToggle.dragHandlers;
                    }
                }
            }

            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            makeFABDraggable();
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
            window.addEventListener('resize', () => {
                makeFABDraggable();
            });

            // Ù„Ù… ØªØ¹Ø¯ Ù‡Ù†Ø§Ùƒ Ø­Ø§Ø¬Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø£Ù† ÙƒÙ„ ØµÙ Ù„Ù‡ checkboxes Ø®Ø§ØµØ© Ø¨Ù‡
            
            // ØªØ³Ø¬ÙŠÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„
            console.log('Page loaded. Testing functions:');
            console.log('closePresumptiveDetailsModal:', typeof window.closePresumptiveDetailsModal);
            console.log('exportDetailsModalToPDF:', typeof window.exportDetailsModalToPDF);
            console.log('Modal element:', document.getElementById('presumptiveDetailsModal'));
        });
    </script>
</body>

</html>